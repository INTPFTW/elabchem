// From eLabChem
// Based on ChemDoodle Web Components 5.2.3
//
// http://web.chemdoodle.com
//
// Copyright 2009-2013 iChemLabs, LLC.  All rights reserved.
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// As a special exception to the GPL, any HTML file in a public website
// or any free web service which merely makes function calls to this
// code, and for that purpose includes it by reference, shall be deemed
// a separate work for copyright law purposes. If you modify this code,
// you may extend this exception to your version of the code, but you
// are not obligated to do so. If you do not wish to do so, delete this
// exception statement from your version.
//
// As an additional exception to the GPL, you may distribute this
// packed form of the code without the copy of the GPL license normally
// required, provided you include this license notice and a URL through
// which recipients can access the corresponding unpacked source code.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// Please contact iChemLabs <http://www.ichemlabs.com/contact-us> for
// alternate licensing options.
//
// With changes by Martin Peeks (martinp23@googlemail.com)
// http://github.com/martinp23/elabchem


var ChemDoodle=function(){"use strict";var e={};e.structures={};e.structures.d2={};e.structures.d3={};e.iChemLabs={};e.informatics={};e.io={};var t="5.2.3";e.getVersion=function(){return t};return e}();ChemDoodle.extensions=function(e,t,n){"use strict";var r={};r.stringStartsWith=function(e,t){return e.slice(0,t.length)===t};r.vec3AngleFrom=function(e,r){var i=t.length(e);var s=t.length(r);var o=t.dot(e,r);var u=o/i/s;return n.acos(u)};r.contextHashTo=function(t,n,r,i,s,o,u){var a=0;var f=(new e.Point(n,r)).distance(new e.Point(i,s));var l=false;var c=n;var h=r;var p=i-n;var d=s-r;while(a<f){if(l){if(a+u>f){t.moveTo(i,s);break}else{var v=u/f;c+=v*p;h+=v*d;t.moveTo(c,h);a+=u}}else{if(a+o>f){t.lineTo(i,s);break}else{var v=o/f;c+=v*p;h+=v*d;t.lineTo(c,h);a+=o}}l=!l}};r.contextRoundRect=function(e,t,n,r,i,s){e.beginPath();e.moveTo(t+s,n);e.lineTo(t+r-s,n);e.quadraticCurveTo(t+r,n,t+r,n+s);e.lineTo(t+r,n+i-s);e.quadraticCurveTo(t+r,n+i,t+r-s,n+i);e.lineTo(t+s,n+i);e.quadraticCurveTo(t,n+i,t,n+i-s);e.lineTo(t,n+s);e.quadraticCurveTo(t,n,t+s,n);e.closePath()};r.contextEllipse=function(e,t,n,r,i){var s=.5522848;var o=r/2*s;var u=i/2*s;var a=t+r;var f=n+i;var l=t+r/2;var c=n+i/2;e.beginPath();e.moveTo(t,c);e.bezierCurveTo(t,c-u,l-o,n,l,n);e.bezierCurveTo(l+o,n,a,c-u,a,c);e.bezierCurveTo(a,c+u,l+o,f,l,f);e.bezierCurveTo(l-o,f,t,c+u,t,c);e.closePath()};r.getFontString=function(e,t,n,r){var i=[];if(n){i.push("bold ")}if(r){i.push("italic ")}i.push(e+"px ");for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u.indexOf(" ")!==-1){u='"'+u+'"'}i.push((s!==0?",":"")+u)}return i.join("")};return r}(ChemDoodle.structures,vec3,Math);ChemDoodle.math=function(e,t,n){"use strict";var r={};var i={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};r.angleBetweenLargest=function(e){if(e.length===0){return{angle:0,largest:n.PI*2}}if(e.length===1){return{angle:e[0]+n.PI,largest:n.PI*2}}var t=0;var r=0;var i=-1;for(var s=0,o=e.length-1;s<o;s++){var u=e[s+1]-e[s];if(u>t){t=u;r=(e[s+1]+e[s])/2;i=s}}var a=e[0]+n.PI*2-e[e.length-1];if(a>t){r=e[0]-a/2;t=a;if(r<0){r+=n.PI*2}i=e.length-1}return{angle:r,largest:t}};r.isBetween=function(e,t,n){if(t>n){var r=t;t=n;n=r}return e>=t&&e<=n};r.getRGB=function(t,n){var r=[0,0,0];if(i[t.toLowerCase()]){t=i[t.toLowerCase()]}if(t.charAt(0)==="#"){if(t.length===4){t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)}return[parseInt(t.substring(1,3),16)/255*n,parseInt(t.substring(3,5),16)/255*n,parseInt(t.substring(5,7),16)/255*n]}else if(e.stringStartsWith(t,"rgb")){var s=t.replace(/rgb\(|\)/g,"").split(",");if(s.length!==3){return r}return[parseInt(s[0])/255*n,parseInt(s[1])/255*n,parseInt(s[2])/255*n]}return r};r.idx2color=function(e){var t=e.toString(16);for(var n=0,r=6-t.length;n<r;n++){t="0"+t}return"#"+t};r.distanceFromPointToLineInclusive=function(e,i,s){var o=i.distance(s);var u=i.angle(s);var a=n.PI/2-u;var f=i.angle(e)+a;var l=i.distance(e);var c=new t.Point(l*n.cos(f),-l*n.sin(f));if(r.isBetween(-c.y,0,o)){return n.abs(c.x)}return-1};r.calculateDistanceInterior=function(e,t,r){if(this.isBetween(t.x,r.x,r.x+r.w)&&this.isBetween(t.y,r.y,r.y+r.w)){return e.distance(t)}var i=[];i.push({x1:r.x,y1:r.y,x2:r.x+r.w,y2:r.y});i.push({x1:r.x,y1:r.y+r.h,x2:r.x+r.w,y2:r.y+r.h});i.push({x1:r.x,y1:r.y,x2:r.x,y2:r.y+r.h});i.push({x1:r.x+r.w,y1:r.y,x2:r.x+r.w,y2:r.y+r.h});var s=[];for(var o=0;o<4;o++){var u=i[o];var a=this.intersectLines(t.x,t.y,e.x,e.y,u.x1,u.y1,u.x2,u.y2);if(a){s.push(a)}}if(s.length===0){return 0}var f=0;for(var o=0,l=s.length;o<l;o++){var a=s[o];var c=e.x-a.x;var h=e.y-a.y;f=n.max(f,n.sqrt(c*c+h*h))}return f};r.intersectLines=function(e,t,n,r,i,s,o,u){n-=e;r-=t;o-=i;u-=s;var a=r*o-n*u;if(a===0){return false}var f=(u*(e-i)-o*(t-s))/a;var l=(r*(e-i)-n*(t-s))/a;if(l>=0&&l<=1&&f>=0&&f<=1){return{x:e+f*n,y:t+f*r}}else{return false}};r.hsl2rgb=function(e,t,n){var r=function(e,t,n){if(n<0){n+=1}else if(n>1){n-=1}if(n<1/6){return e+(t-e)*6*n}else if(n<1/2){return t}else if(n<2/3){return e+(t-e)*(2/3-n)*6}return e};var i,s,o;if(t===0){i=s=o=n}else{var u=n<.5?n*(1+t):n+t-n*t;var a=2*n-u;i=r(a,u,e+1/3);s=r(a,u,e);o=r(a,u,e-1/3)}return[i*255,s*255,o*255]};r.isPointInPoly=function(e,t){for(var n=false,r=-1,i=e.length,s=i-1;++r<i;s=r){(e[r].y<=t.y&&t.y<e[s].y||e[s].y<=t.y&&t.y<e[r].y)&&t.x<(e[s].x-e[r].x)*(t.y-e[r].y)/(e[s].y-e[r].y)+e[r].x&&(n=!n)}return n};r.clamp=function(e,t,n){return e<t?t:e>n?n:e};return r}(ChemDoodle.extensions,ChemDoodle.structures,Math);(function(e,t){"use strict";e.Bounds=function(){};var n=e.Bounds.prototype;n.minX=n.minY=n.minZ=Infinity;n.maxX=n.maxY=n.maxZ=-Infinity;n.expand=function(n,r,i,s){if(n instanceof e.Bounds){this.minX=t.min(this.minX,n.minX);this.minY=t.min(this.minY,n.minY);this.maxX=t.max(this.maxX,n.maxX);this.maxY=t.max(this.maxY,n.maxY);if(n.maxZ!==Infinity){this.minZ=t.min(this.minZ,n.minZ);this.maxZ=t.max(this.maxZ,n.maxZ)}}else{this.minX=t.min(this.minX,n);this.maxX=t.max(this.maxX,n);this.minY=t.min(this.minY,r);this.maxY=t.max(this.maxY,r);if(i!==undefined&&s!==undefined){this.minX=t.min(this.minX,i);this.maxX=t.max(this.maxX,i);this.minY=t.min(this.minY,s);this.maxY=t.max(this.maxY,s)}}};n.expand3D=function(e,n,r,i,s,o){this.minX=t.min(this.minX,e);this.maxX=t.max(this.maxX,e);this.minY=t.min(this.minY,n);this.maxY=t.max(this.maxY,n);this.minZ=t.min(this.minZ,r);this.maxZ=t.max(this.maxZ,r);if(i!==undefined&&s!==undefined&&o!==undefined){this.minX=t.min(this.minX,i);this.maxX=t.max(this.maxX,i);this.minY=t.min(this.minY,s);this.maxY=t.max(this.maxY,s);this.minZ=t.min(this.minZ,o);this.maxZ=t.max(this.maxZ,o)}}})(ChemDoodle.math,Math);(function(e){"use strict";function t(e){return e==0?0:e>0?1:-1}var n={subtract:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},dotProduct:function(e,t){return e.x*t.x+e.y*t.y},square:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},scale:function(e,t){return{x:e.x*t,y:e.y*t}}},r=64,i=Math.pow(2,-r-1);var s=function(e,t){var r=[],i=u(e,t),s=t.length-1,o=2*s-1,f=a(i,o,r,0),l=n.subtract(e,t[0]),c=n.square(l),p=0;for(var d=0;d<f;d++){l=n.subtract(e,h(t,s,r[d],null,null));var v=n.square(l);if(v<c){c=v;p=r[d]}}l=n.subtract(e,t[s]);v=n.square(l);if(v<c){c=v;p=1}return{location:p,distance:c}};var o=function(e,t){var n=s(e,t);return{point:h(t,t.length-1,n.location,null,null),location:n.location}};var u=function(e,t){var r=t.length-1,i=2*r-1,s=[],o=[],u=[],a=[],f=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]];for(var l=0;l<=r;l++)s[l]=n.subtract(t[l],e);for(var l=0;l<=r-1;l++){o[l]=n.subtract(t[l+1],t[l]);o[l]=n.scale(o[l],3)}for(var c=0;c<=r-1;c++){for(var h=0;h<=r;h++){if(!u[c])u[c]=[];u[c][h]=n.dotProduct(o[c],s[h])}}for(l=0;l<=i;l++){if(!a[l])a[l]=[];a[l].y=0;a[l].x=parseFloat(l)/i}var p=r,d=r-1;for(var v=0;v<=p+d;v++){var m=Math.max(0,v-d),g=Math.min(v,p);for(l=m;l<=g;l++){var y=v-l;a[l+y].y+=u[y][l]*f[y][l]}}return a};var a=function(e,t,n,i){var s=[],o=[],u,p,d=[],v=[];switch(f(e,t)){case 0:{return 0};case 1:{if(i>=r){n[0]=(e[0].x+e[t].x)/2;return 1}if(l(e,t)){n[0]=c(e,t);return 1}break}}h(e,t,.5,s,o);u=a(s,t,d,i+1);p=a(o,t,v,i+1);for(var m=0;m<u;m++)n[m]=d[m];for(var m=0;m<p;m++)n[m+u]=v[m];return u+p};var f=function(e,n){var r=0,i,s;i=s=t(e[0].y);for(var o=1;o<=n;o++){i=t(e[o].y);if(i!=s)r++;s=i}return r};var l=function(e,t){var n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y;a=e[0].y-e[t].y;f=e[t].x-e[0].x;l=e[0].x*e[t].y-e[t].x*e[0].y;var b=0,w=0;for(var E=1;E<t;E++){var S=a*e[E].x+f*e[E].y+l;if(S>b)b=S;else if(S<w)w=S}p=0;d=1;v=0;m=a;g=f;y=l-b;c=p*g-m*d;h=1/c;r=(d*y-g*v)*h;m=a;g=f;y=l-w;c=p*g-m*d;h=1/c;s=(d*y-g*v)*h;o=Math.min(r,s);u=Math.max(r,s);n=u-o;return n<i?1:0};var c=function(e,t){var n=1,r=0,i=e[t].x-e[0].x,s=e[t].y-e[0].y,o=e[0].x-0,u=e[0].y-0,a=i*r-s*n,f=1/a,l=(i*u-s*o)*f;return 0+n*l};var h=function(e,t,n,r,i){var s=[[]];for(var o=0;o<=t;o++)s[0][o]=e[o];for(var u=1;u<=t;u++){for(var o=0;o<=t-u;o++){if(!s[u])s[u]=[];if(!s[u][o])s[u][o]={};s[u][o].x=(1-n)*s[u-1][o].x+n*s[u-1][o+1].x;s[u][o].y=(1-n)*s[u-1][o].y+n*s[u-1][o+1].y}}if(r!=null)for(o=0;o<=t;o++)r[o]=s[o][0];if(i!=null)for(o=0;o<=t;o++)i[o]=s[t-o][o];return s[t][0]};var p={};var d=function(e){var t=p[e];if(!t){t=[];var n=function(){return function(t){return Math.pow(t,e)}},r=function(){return function(t){return Math.pow(1-t,e)}},i=function(e){return function(t){return e}},s=function(){return function(e){return e}},o=function(){return function(e){return 1-e}},u=function(e){return function(t){var n=1;for(var r=0;r<e.length;r++)n=n*e[r](t);return n}};t.push(new n);for(var a=1;a<e;a++){var f=[new i(e)];for(var l=0;l<e-a;l++)f.push(new s);for(var l=0;l<a;l++)f.push(new o);t.push(new u(f))}t.push(new r);p[e]=t}return t};var v=function(e,t){var n=d(e.length-1),r=0,i=0;for(var s=0;s<e.length;s++){r=r+e[s].x*n[s](t);i=i+e[s].y*n[s](t)}return{x:r,y:i}};var m=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};var g=function(e,t,n){var r=v(e,t),i=0,s=t,o=n>0?1:-1,u=null;while(i<Math.abs(n)){s+=.005*o;u=v(e,s);i+=m(u,r);r=u}return{point:u,location:s}};var y=function(e){var t=v(e,0),n=0,r=0,i=1,s=null;while(r<1){r+=.005*i;s=v(e,r);n+=m(s,t);t=s}return n};var b=function(e,t,n){return g(e,t,n).point};var w=function(e,t,n){return g(e,t,n).location};var E=function(e,t){var n=v(e,t),r=v(e.slice(0,e.length-1),t),i=r.y-n.y,s=r.x-n.x;return i==0?Infinity:Math.atan(i/s)};var S=function(e,t,n){var r=g(e,t,n);if(r.location>1)r.location=1;if(r.location<0)r.location=0;return E(e,r.location)};var x=function(e,t,n,r){r=r==null?0:r;var i=g(e,t,r),s=E(e,i.location),o=Math.atan(-1/s),u=n/2*Math.sin(o),a=n/2*Math.cos(o);return[{x:i.point.x+a,y:i.point.y+u},{x:i.point.x-a,y:i.point.y-u}]};ChemDoodle.math.jsBezier={distanceFromCurve:s,gradientAtPoint:E,gradientAtPointAlongCurveFrom:S,nearestPointOnCurve:o,pointOnCurve:v,pointAlongCurveFrom:b,perpendicularToCurveAt:x,locationAlongCurveFrom:w,getLength:y}})(ChemDoodle.math);ChemDoodle.featureDetection=function(e,t,n,r){"use strict";var i={};i.supports_canvas=function(){return!!n.createElement("canvas").getContext};i.supports_canvas_text=function(){if(!i.supports_canvas()){return false}var e=n.createElement("canvas");var t=e.getContext("2d");return typeof t.fillText==="function"};i.supports_webgl=function(){var e=n.createElement("canvas");try{if(e.getContext("webgl")){return true}if(e.getContext("experimental-webgl")){return true}}catch(t){}return false};i.supports_xhr2=function(){return t.support.cors};i.supports_touch=function(){return"ontouchstart"in r&&navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|BB10/i)};i.supports_gesture=function(){return"ongesturestart"in r};return i}(ChemDoodle.iChemLabs,jQuery,document,window);ChemDoodle.SYMBOLS=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Uut","Uuq","Uup","Uuh","Uus","Uuo"];ChemDoodle.ELEMENT=function(e){"use strict";function n(e,t,n,r,i,s,o,u,a){this.symbol=e;this.name=t;this.atomicNumber=n;this.addH=r;this.jmolColor=this.pymolColor=i;this.covalentRadius=s;this.vdWRadius=o;this.valency=u;this.mass=a}var t=[];t.H=new n("H","Hydrogen",1,false,"#FFFFFF",.31,1.2,1,1);t.He=new n("He","Helium",2,false,"#D9FFFF",.28,1.4,0,4);t.Li=new n("Li","Lithium",3,false,"#CC80FF",1.28,1.82,1,7);t.Be=new n("Be","Beryllium",4,false,"#C2FF00",.96,0,2,9);t.B=new n("B","Boron",5,true,"#FFB5B5",.84,0,3,11);t.C=new n("C","Carbon",6,true,"#909090",.76,1.7,4,12);t.N=new n("N","Nitrogen",7,true,"#3050F8",.71,1.55,3,14);t.O=new n("O","Oxygen",8,true,"#FF0D0D",.66,1.52,2,16);t.F=new n("F","Fluorine",9,true,"#90E050",.57,1.47,1,19);t.Ne=new n("Ne","Neon",10,false,"#B3E3F5",.58,1.54,0,20);t.Na=new n("Na","Sodium",11,false,"#AB5CF2",1.66,2.27,1,23);t.Mg=new n("Mg","Magnesium",12,false,"#8AFF00",1.41,1.73,0,24);t.Al=new n("Al","Aluminum",13,false,"#BFA6A6",1.21,0,0,27);t.Si=new n("Si","Silicon",14,true,"#F0C8A0",1.11,2.1,4,28);t.P=new n("P","Phosphorus",15,true,"#FF8000",1.07,1.8,3,31);t.S=new n("S","Sulfur",16,true,"#FFFF30",1.05,1.8,2,32);t.Cl=new n("Cl","Chlorine",17,true,"#1FF01F",1.02,1.75,1,35);t.Ar=new n("Ar","Argon",18,false,"#80D1E3",1.06,1.88,0,40);t.K=new n("K","Potassium",19,false,"#8F40D4",2.03,2.75,0,39);t.Ca=new n("Ca","Calcium",20,false,"#3DFF00",1.76,0,0,40);t.Sc=new n("Sc","Scandium",21,false,"#E6E6E6",1.7,0,0,45);t.Ti=new n("Ti","Titanium",22,false,"#BFC2C7",1.6,0,1,48);t.V=new n("V","Vanadium",23,false,"#A6A6AB",1.53,0,1,51);t.Cr=new n("Cr","Chromium",24,false,"#8A99C7",1.39,0,2,52);t.Mn=new n("Mn","Manganese",25,false,"#9C7AC7",1.39,0,3,55);t.Fe=new n("Fe","Iron",26,false,"#E06633",1.32,0,2,56);t.Co=new n("Co","Cobalt",27,false,"#F090A0",1.26,0,1,59);t.Ni=new n("Ni","Nickel",28,false,"#50D050",1.24,1.63,1,58);t.Cu=new n("Cu","Copper",29,false,"#C88033",1.32,1.4,0,63);t.Zn=new n("Zn","Zinc",30,false,"#7D80B0",1.22,1.39,0,64);t.Ga=new n("Ga","Gallium",31,false,"#C28F8F",1.22,1.87,0,69);t.Ge=new n("Ge","Germanium",32,false,"#668F8F",1.2,0,4,74);t.As=new n("As","Arsenic",33,true,"#BD80E3",1.19,1.85,3,75);t.Se=new n("Se","Selenium",34,true,"#FFA100",1.2,1.9,2,80);t.Br=new n("Br","Bromine",35,true,"#A62929",1.2,1.85,1,79);t.Kr=new n("Kr","Krypton",36,false,"#5CB8D1",1.16,2.02,0,84);t.Rb=new n("Rb","Rubidium",37,false,"#702EB0",2.2,0,0,85);t.Sr=new n("Sr","Strontium",38,false,"#00FF00",1.95,0,0,88);t.Y=new n("Y","Yttrium",39,false,"#94FFFF",1.9,0,0,89);t.Zr=new n("Zr","Zirconium",40,false,"#94E0E0",1.75,0,0,90);t.Nb=new n("Nb","Niobium",41,false,"#73C2C9",1.64,0,1,93);t.Mo=new n("Mo","Molybdenum",42,false,"#54B5B5",1.54,0,2,98);t.Tc=new n("Tc","Technetium",43,false,"#3B9E9E",1.47,0,3,0);t.Ru=new n("Ru","Ruthenium",44,false,"#248F8F",1.46,0,2,102);t.Rh=new n("Rh","Rhodium",45,false,"#0A7D8C",1.42,0,1,103);t.Pd=new n("Pd","Palladium",46,false,"#006985",1.39,1.63,0,106);t.Ag=new n("Ag","Silver",47,false,"#C0C0C0",1.45,1.72,0,107);t.Cd=new n("Cd","Cadmium",48,false,"#FFD98F",1.44,1.58,0,114);t.In=new n("In","Indium",49,false,"#A67573",1.42,1.93,0,115);t.Sn=new n("Sn","Tin",50,false,"#668080",1.39,2.17,4,120);t.Sb=new n("Sb","Antimony",51,false,"#9E63B5",1.39,0,3,121);t.Te=new n("Te","Tellurium",52,true,"#D47A00",1.38,2.06,2,130);t.I=new n("I","Iodine",53,true,"#940094",1.39,1.98,1,127);t.Xe=new n("Xe","Xenon",54,false,"#429EB0",1.4,2.16,0,132);t.Cs=new n("Cs","Cesium",55,false,"#57178F",2.44,0,0,133);t.Ba=new n("Ba","Barium",56,false,"#00C900",2.15,0,0,138);t.La=new n("La","Lanthanum",57,false,"#70D4FF",2.07,0,0,139);t.Ce=new n("Ce","Cerium",58,false,"#FFFFC7",2.04,0,0,140);t.Pr=new n("Pr","Praseodymium",59,false,"#D9FFC7",2.03,0,0,141);t.Nd=new n("Nd","Neodymium",60,false,"#C7FFC7",2.01,0,0,142);t.Pm=new n("Pm","Promethium",61,false,"#A3FFC7",1.99,0,0,0);t.Sm=new n("Sm","Samarium",62,false,"#8FFFC7",1.98,0,0,152);t.Eu=new n("Eu","Europium",63,false,"#61FFC7",1.98,0,0,153);t.Gd=new n("Gd","Gadolinium",64,false,"#45FFC7",1.96,0,0,158);t.Tb=new n("Tb","Terbium",65,false,"#30FFC7",1.94,0,0,159);t.Dy=new n("Dy","Dysprosium",66,false,"#1FFFC7",1.92,0,0,164);t.Ho=new n("Ho","Holmium",67,false,"#00FF9C",1.92,0,0,165);t.Er=new n("Er","Erbium",68,false,"#00E675",1.89,0,0,166);t.Tm=new n("Tm","Thulium",69,false,"#00D452",1.9,0,0,169);t.Yb=new n("Yb","Ytterbium",70,false,"#00BF38",1.87,0,0,174);t.Lu=new n("Lu","Lutetium",71,false,"#00AB24",1.87,0,0,175);t.Hf=new n("Hf","Hafnium",72,false,"#4DC2FF",1.75,0,0,180);t.Ta=new n("Ta","Tantalum",73,false,"#4DA6FF",1.7,0,1,181);t.W=new n("W","Tungsten",74,false,"#2194D6",1.62,0,2,184);t.Re=new n("Re","Rhenium",75,false,"#267DAB",1.51,0,3,187);t.Os=new n("Os","Osmium",76,false,"#266696",1.44,0,2,192);t.Ir=new n("Ir","Iridium",77,false,"#175487",1.41,0,3,193);t.Pt=new n("Pt","Platinum",78,false,"#D0D0E0",1.36,1.75,0,195);t.Au=new n("Au","Gold",79,false,"#FFD123",1.36,1.66,1,197);t.Hg=new n("Hg","Mercury",80,false,"#B8B8D0",1.32,1.55,0,202);t.Tl=new n("Tl","Thallium",81,false,"#A6544D",1.45,1.96,0,205);t.Pb=new n("Pb","Lead",82,false,"#575961",1.46,2.02,4,208);t.Bi=new n("Bi","Bismuth",83,false,"#9E4FB5",1.48,0,3,209);t.Po=new n("Po","Polonium",84,false,"#AB5C00",1.4,0,2,0);t.At=new n("At","Astatine",85,true,"#754F45",1.5,0,1,0);t.Rn=new n("Rn","Radon",86,false,"#428296",1.5,0,0,0);t.Fr=new n("Fr","Francium",87,false,"#420066",2.6,0,0,0);t.Ra=new n("Ra","Radium",88,false,"#007D00",2.21,0,0,0);t.Ac=new n("Ac","Actinium",89,false,"#70ABFA",2.15,0,0,0);t.Th=new n("Th","Thorium",90,false,"#00BAFF",2.06,0,0,232);t.Pa=new n("Pa","Protactinium",91,false,"#00A1FF",2,0,0,231);t.U=new n("U","Uranium",92,false,"#008FFF",1.96,1.86,0,238);t.Np=new n("Np","Neptunium",93,false,"#0080FF",1.9,0,0,0);t.Pu=new n("Pu","Plutonium",94,false,"#006BFF",1.87,0,0,0);t.Am=new n("Am","Americium",95,false,"#545CF2",1.8,0,0,0);t.Cm=new n("Cm","Curium",96,false,"#785CE3",1.69,0,0,0);t.Bk=new n("Bk","Berkelium",97,false,"#8A4FE3",0,0,0,0);t.Cf=new n("Cf","Californium",98,false,"#A136D4",0,0,0,0);t.Es=new n("Es","Einsteinium",99,false,"#B31FD4",0,0,0,0);t.Fm=new n("Fm","Fermium",100,false,"#B31FBA",0,0,0,0);t.Md=new n("Md","Mendelevium",101,false,"#B30DA6",0,0,0,0);t.No=new n("No","Nobelium",102,false,"#BD0D87",0,0,0,0);t.Lr=new n("Lr","Lawrencium",103,false,"#C70066",0,0,0,0);t.Rf=new n("Rf","Rutherfordium",104,false,"#CC0059",0,0,0,0);t.Db=new n("Db","Dubnium",105,false,"#D1004F",0,0,0,0);t.Sg=new n("Sg","Seaborgium",106,false,"#D90045",0,0,0,0);t.Bh=new n("Bh","Bohrium",107,false,"#E00038",0,0,0,0);t.Hs=new n("Hs","Hassium",108,false,"#E6002E",0,0,0,0);t.Mt=new n("Mt","Meitnerium",109,false,"#EB0026",0,0,0,0);t.Ds=new n("Ds","Darmstadtium",110,false,"#000000",0,0,0,0);t.Rg=new n("Rg","Roentgenium",111,false,"#000000",0,0,0,0);t.Cn=new n("Cn","Copernicium",112,false,"#000000",0,0,0,0);t.Uut=new n("Uut","Ununtrium",113,false,"#000000",0,0,0,0);t.Uuq=new n("Uuq","Ununquadium",114,false,"#000000",0,0,0,0);t.Uup=new n("Uup","Ununpentium",115,false,"#000000",0,0,0,0);t.Uuh=new n("Uuh","Ununhexium",116,false,"#000000",0,0,0,0);t.Uus=new n("Uus","Ununseptium",117,false,"#000000",0,0,0,0);t.Uuo=new n("Uuo","Ununoctium",118,false,"#000000",0,0,0,0);t.H.pymolColor="#E6E6E6";t.C.pymolColor="#33FF33";t.N.pymolColor="#3333FF";t.O.pymolColor="#FF4D4D";t.F.pymolColor="#B3FFFF";t.S.pymolColor="#E6C640";return t}(ChemDoodle.SYMBOLS);ChemDoodle.RESIDUE=function(){"use strict";function t(e,t,n,r,i){this.symbol=e;this.name=t;this.polar=n;this.aminoColor=r;this.shapelyColor=i}var e=[];e.Ala=new t("Ala","Alanine",false,"#C8C8C8","#8CFF8C");e.Arg=new t("Arg","Arginine",true,"#145AFF","#00007C");e.Asn=new t("Asn","Asparagine",true,"#00DCDC","#FF7C70");e.Asp=new t("Asp","Aspartic Acid",true,"#E60A0A","#A00042");e.Cys=new t("Cys","Cysteine",true,"#E6E600","#FFFF70");e.Gln=new t("Gln","Glutamine",true,"#00DCDC","#FF4C4C");e.Glu=new t("Glu","Glutamic Acid",true,"#E60A0A","#660000");e.Gly=new t("Gly","Glycine",false,"#EBEBEB","#FFFFFF");e.His=new t("His","Histidine",true,"#8282D2","#7070FF");e.Ile=new t("Ile","Isoleucine",false,"#0F820F","#004C00");e.Leu=new t("Leu","Leucine",false,"#0F820F","#455E45");e.Lys=new t("Lys","Lysine",true,"#145AFF","#4747B8");e.Met=new t("Met","Methionine",false,"#E6E600","#B8A042");e.Phe=new t("Phe","Phenylalanine",false,"#3232AA","#534C52");e.Pro=new t("Pro","Proline",false,"#DC9682","#525252");e.Ser=new t("Ser","Serine",true,"#FA9600","#FF7042");e.Thr=new t("Thr","Threonine",true,"#FA9600","#B84C00");e.Trp=new t("Trp","Tryptophan",true,"#B45AB4","#4F4600");e.Tyr=new t("Tyr","Tyrosine",true,"#3232AA","#8C704C");e.Val=new t("Val","Valine",false,"#0F820F","#FF8CFF");e.Asx=new t("Asx","Asparagine/Aspartic Acid",true,"#FF69B4","#FF00FF");e.Glx=new t("Glx","Glutamine/Glutamic Acid",true,"#FF69B4","#FF00FF");e["*"]=new t("*","Other",false,"#BEA06E","#FF00FF");e.A=new t("A","Adenine",false,"#BEA06E","#A0A0FF");e.G=new t("G","Guanine",false,"#BEA06E","#FF7070");e.I=new t("I","",false,"#BEA06E","#80FFFF");e.C=new t("C","Cytosine",false,"#BEA06E","#FF8C4B");e.T=new t("T","Thymine",false,"#BEA06E","#A0FFA0");e.U=new t("U","Uracil",false,"#BEA06E","#FF8080");return e}();(function(e){"use strict";e.Queue=function(){this.queue=[]};var t=e.Queue.prototype;t.queueSpace=0;t.getSize=function(){return this.queue.length-this.queueSpace};t.isEmpty=function(){return this.queue.length===0};t.enqueue=function(e){this.queue.push(e)};t.dequeue=function(){var e;if(this.queue.length){e=this.queue[this.queueSpace];if(++this.queueSpace*2>=this.queue.length){this.queue=this.queue.slice(this.queueSpace);this.queueSpace=0}}return e};t.getOldestElement=function(){var e;if(this.queue.length){e=this.queue[this.queueSpace]}return e}})(ChemDoodle.structures);(function(e,t){"use strict";e.Point=function(e,t){this.x=e?e:0;this.y=t?t:0};var n=e.Point.prototype;n.sub=function(e){this.x-=e.x;this.y-=e.y};n.add=function(e){this.x+=e.x;this.y+=e.y};n.distance=function(e){var n=e.x-this.x;var r=e.y-this.y;return t.sqrt(n*n+r*r)};n.angleForStupidCanvasArcs=function(e){var n=e.x-this.x;var r=e.y-this.y;var i=0;if(n===0){if(r===0){i=0}else if(r>0){i=t.PI/2}else{i=3*t.PI/2}}else if(r===0){if(n>0){i=0}else{i=t.PI}}else{if(n<0){i=t.atan(r/n)+t.PI}else if(r<0){i=t.atan(r/n)+2*t.PI}else{i=t.atan(r/n)}}while(i<0){i+=t.PI*2}i=i%(t.PI*2);return i};n.angle=function(e){var n=e.x-this.x;var r=this.y-e.y;var i=0;if(n===0){if(r===0){i=0}else if(r>0){i=t.PI/2}else{i=3*t.PI/2}}else if(r===0){if(n>0){i=0}else{i=t.PI}}else{if(n<0){i=t.atan(r/n)+t.PI}else if(r<0){i=t.atan(r/n)+2*t.PI}else{i=t.atan(r/n)}}while(i<0){i+=t.PI*2}i=i%(t.PI*2);return i}})(ChemDoodle.structures,Math);(function(e,t,n,r,i,s){"use strict";r.Atom=function(t,n,r,i){this.label=t?t.replace(/\s/g,""):"C";if(!e[this.label]){this.label="C"}this.x=n?n:0;this.y=r?r:0;this.z=i?i:0};var o=r.Atom.prototype=new r.Point(0,0);o.charge=0;o.numLonePair=0;o.numRadical=0;o.mass=-1;o.coordinationNumber=0;o.bondNumber=0;o.angleOfLeastInterference=0;o.isHidden=false;o.altLabel=undefined;o.any=false;o.rgroup=-1;o.isLone=false;o.isHover=false;o.isSelected=false;o.add3D=function(e){this.x+=e.x;this.y+=e.y;this.z+=e.z};o.sub3D=function(e){this.x-=e.x;this.y-=e.y;this.z-=e.z};o.distance3D=function(e){var t=e.x-this.x;var n=e.y-this.y;var r=e.z-this.z;return i.sqrt(t*t+n*n+r*r)};o.draw=function(e,r){if(this.isLassoed){var s=e.createRadialGradient(this.x-1,this.y-1,0,this.x,this.y,7);s.addColorStop(0,"rgba(212, 99, 0, 0)");s.addColorStop(.7,"rgba(212, 99, 0, 0.8)");e.fillStyle=s;e.beginPath();e.arc(this.x,this.y,5,0,i.PI*2,false);e.fill()}this.textBounds=[];if(this.specs){r=this.specs}var o=t.getFontString(r.atoms_font_size_2D,r.atoms_font_families_2D,r.atoms_font_bold_2D,r.atoms_font_italic_2D);e.font=o;e.fillStyle=this.getElementColor(r.atoms_useJMOLColors,r.atoms_usePYMOLColors,r.atoms_color,2);var u;if(this.isLone&&!r.atoms_displayAllCarbonLabels_2D||r.atoms_circles_2D){e.beginPath();e.arc(this.x,this.y,r.atoms_circleDiameter_2D/2,0,i.PI*2,false);e.fill();if(r.atoms_circleBorderWidth_2D>0){e.lineWidth=r.atoms_circleBorderWidth_2D;e.strokeStyle="black";e.stroke(this.x,this.y,0,i.PI*2,r.atoms_circleDiameter_2D/2)}}else if(this.isLabelVisible(r)){e.textAlign="center";e.textBaseline="middle";if(this.altLabel!==undefined){e.fillText(this.altLabel,this.x,this.y);var a=e.measureText(this.altLabel).width;this.textBounds.push({x:this.x-a/2,y:this.y-r.atoms_font_size_2D/2+1,w:a,h:r.atoms_font_size_2D-2})}else if(this.any){e.font=t.getFontString(r.atoms_font_size_2D+5,r.atoms_font_families_2D,true);e.fillText("*",this.x+1,this.y+3);var a=e.measureText("*").width;this.textBounds.push({x:this.x-a/2,y:this.y-r.atoms_font_size_2D/2+1,w:a,h:r.atoms_font_size_2D-2})}else if(this.rgroup!==-1){var f="R"+this.rgroup;e.fillText(f,this.x,this.y);var a=e.measureText(f).width;this.textBounds.push({x:this.x-a/2,y:this.y-r.atoms_font_size_2D/2+1,w:a,h:r.atoms_font_size_2D-2})}else{e.fillText(this.label,this.x,this.y);var a=e.measureText(this.label).width;this.textBounds.push({x:this.x-a/2,y:this.y-r.atoms_font_size_2D/2+1,w:a,h:r.atoms_font_size_2D-2});var l=0;if(this.mass!==-1){var c=t.getFontString(r.atoms_font_size_2D*.7,r.atoms_font_families_2D,r.atoms_font_bold_2D,r.atoms_font_italic_2D);var h=e.font;e.font=t.getFontString(r.atoms_font_size_2D*.7,r.atoms_font_families_2D,r.atoms_font_bold_2D,r.atoms_font_italic_2D);l=e.measureText(this.mass).width;e.fillText(this.mass,this.x-l-.5,this.y-r.atoms_font_size_2D/2+1);this.textBounds.push({x:this.x-a/2-l-.5,y:this.y-r.atoms_font_size_2D*1.7/2+1,w:l,h:r.atoms_font_size_2D/2-1});e.font=h}var p=a/2;var d=this.getImplicitHydrogenCount();if(r.atoms_implicitHydrogens_2D&&d>0){u=0;var v=e.measureText("H").width;var g=true;if(d>1){var y=a/2+v/2;var b=0;var c=t.getFontString(r.atoms_font_size_2D*.8,r.atoms_font_families_2D,r.atoms_font_bold_2D,r.atoms_font_italic_2D);e.font=c;var w=e.measureText(d).width;if(this.bondNumber===1){if(this.angleOfLeastInterference>i.PI/2&&this.angleOfLeastInterference<3*i.PI/2){y=-a/2-w-v/2-l/2;g=false;u=i.PI}}else{if(this.angleOfLeastInterference<=i.PI/4){}else if(this.angleOfLeastInterference<3*i.PI/4){y=0;b=-r.atoms_font_size_2D*.9;if(this.charge!==0){b-=r.atoms_font_size_2D*.3}g=false;u=i.PI/2}else if(this.angleOfLeastInterference<=5*i.PI/4){y=-a/2-w-v/2-l/2;g=false;u=i.PI}else if(this.angleOfLeastInterference<7*i.PI/4){y=0;b=r.atoms_font_size_2D*.9;g=false;u=3*i.PI/2}}e.font=o;e.fillText("H",this.x+y,this.y+b);e.font=c;e.fillText(d,this.x+y+v/2+w/2,this.y+b+r.atoms_font_size_2D*.3);this.textBounds.push({x:this.x+y-v/2,y:this.y+b-r.atoms_font_size_2D/2+1,w:v,h:r.atoms_font_size_2D-2});this.textBounds.push({x:this.x+y+v/2,y:this.y+b+r.atoms_font_size_2D*.3-r.atoms_font_size_2D/2+1,w:w,h:r.atoms_font_size_2D*.8-2})}else{var y=a/2+v/2;var b=0;if(this.bondNumber===1){if(this.angleOfLeastInterference>i.PI/2&&this.angleOfLeastInterference<3*i.PI/2){y=-a/2-v/2-l/2;u=i.PI}}else{if(this.angleOfLeastInterference<=i.PI/4){}else if(this.angleOfLeastInterference<3*i.PI/4){y=0;b=-r.atoms_font_size_2D*.9;g=false;u=i.PI/2}else if(this.angleOfLeastInterference<=5*i.PI/4){y=-a/2-v/2-l/2;g=false;u=i.PI}else if(this.angleOfLeastInterference<7*i.PI/4){y=0;b=r.atoms_font_size_2D*.9;g=false;u=3*i.PI/2}}e.fillText("H",this.x+y,this.y+b);this.textBounds.push({x:this.x+y-v/2,y:this.y+b-r.atoms_font_size_2D/2+1,w:v,h:r.atoms_font_size_2D-2})}if(g){p+=v}}if(this.charge!==0){var E=this.charge.toFixed(0);if(E==="1"){E="+"}else if(E==="-1"){E="–"}else if(t.stringStartsWith(E,"-")){E=E.substring(1)+"–"}else{E+="+"}var S=e.measureText(E).width;p+=S/2;e.textAlign="center";e.textBaseline="middle";e.font=t.getFontString(i.floor(r.atoms_font_size_2D*.8),r.atoms_font_families_2D,r.atoms_font_bold_2D,r.atoms_font_italic_2D);e.fillText(E,this.x+p-1,this.y-r.atoms_font_size_2D/2+1);this.textBounds.push({x:this.x+p-S/2-1,y:this.y-r.atoms_font_size_2D*1.8/2+5,w:S,h:r.atoms_font_size_2D/2-1})}}}if(this.numLonePair>0||this.numRadical>0){e.fillStyle="black";var x=this.angles.slice(0);var T=this.angleOfLeastInterference;var N=this.largestAngle;if(u!==undefined){x.push(u);x.sort();var C=n.angleBetweenLargest(x);T=C.angle%(i.PI*2);N=C.largest}var k=[];for(var L=0;L<this.numLonePair;L++){k.push({t:2})}for(var L=0;L<this.numRadical;L++){k.push({t:1})}if(u===undefined&&i.abs(N-2*i.PI/x.length)<i.PI/60){var A=i.ceil(k.length/x.length);for(var L=0,O=k.length;L<O;L+=A,T+=N){this.drawElectrons(e,r,k.slice(L,i.min(k.length,L+A)),T,N,u)}}else{this.drawElectrons(e,r,k,T,N,u)}}};o.drawElectrons=function(e,t,n,r,s,o){var u=s/(n.length+(this.bonds.length===0&&o===undefined?0:1));var a=r-s/2+u;for(var f=0;f<n.length;f++){var l=n[f];var r=a+f*u;var c=this.x+Math.cos(r)*t.atoms_lonePairDistance_2D;var h=this.y-Math.sin(r)*t.atoms_lonePairDistance_2D;if(l.t===2){var p=r+Math.PI/2;var d=Math.cos(p)*t.atoms_lonePairSpread_2D/2;var v=-Math.sin(p)*t.atoms_lonePairSpread_2D/2;e.beginPath();e.arc(c+d,h+v,t.atoms_lonePairDiameter_2D,0,i.PI*2,false);e.fill();e.beginPath();e.arc(c-d,h-v,t.atoms_lonePairDiameter_2D,0,i.PI*2,false);e.fill()}else if(l.t===1){e.beginPath();e.arc(c,h,t.atoms_lonePairDiameter_2D,0,i.PI*2,false);e.fill()}}};o.drawDecorations=function(e){if(this.isHover||this.isSelected){e.strokeStyle=this.isHover?"#885110":"#0060B2";e.lineWidth=1.2;e.beginPath();var t=this.isHover?7:15;e.arc(this.x,this.y,t,0,i.PI*2,false);e.stroke()}if(this.isOverlap){e.strokeStyle="#C10000";e.lineWidth=1.2;e.beginPath();e.arc(this.x,this.y,7,0,i.PI*2,false);e.stroke()}};o.render=function(t,n,r){if(this.specs){n=this.specs}var i=s.translate(t.modelViewMatrix,[this.x,this.y,this.z],[]);var o=n.atoms_useVDWDiameters_3D?e[this.label].vdWRadius*n.atoms_vdwMultiplier_3D:n.atoms_sphereDiameter_3D/2;if(o===0){o=1}s.scale(i,[o,o,o]);if(!r){var u=n.atoms_color;if(n.atoms_useJMOLColors){u=e[this.label].jmolColor}else if(n.atoms_usePYMOLColors){u=e[this.label].pymolColor}t.material.setDiffuseColor(u)}t.setMatrixUniforms(i);var a=this.renderAsStar?t.starBuffer:t.sphereBuffer;t.drawElements(t.TRIANGLES,a.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)};o.isLabelVisible=function(e){if(e.atoms_displayAllCarbonLabels_2D){return true}if(this.label!=="C"){return true}if(this.altLabel){return true}if(this.any||this.rgroup!==-1){return true}if(this.mass!==-1||this.charge!==0){return true}if(e.atoms_showAttributedCarbons_2D&&(this.numRadical!==0||this.numLonePair!==0)){return true}if(this.isHidden&&e.atoms_showHiddenCarbons_2D){return true}if(e.atoms_displayTerminalCarbonLabels_2D&&this.bondNumber===1){return true}return false};o.getImplicitHydrogenCount=function(){if(this.label==="H"||!e[this.label]||!e[this.label].addH){return 0}var t=e[this.label].valency;var n=t-this.coordinationNumber;if(this.numRadical>0){n=i.max(0,n-this.numRadical)}if(this.charge>0){var r=4-t;if(this.charge<=r){n+=this.charge}else{n=4-this.coordinationNumber-this.charge+r}}else{n+=this.charge}return n<0?0:i.floor(n)};o.getBounds=function(){var e=new n.Bounds;e.expand(this.x,this.y);if(this.textBounds){for(var t=0,r=this.textBounds.length;t<r;t++){var i=this.textBounds[t];e.expand(i.x,i.y,i.x+i.w,i.y+i.h)}}return e};o.getBounds3D=function(){var e=new n.Bounds;e.expand3D(this.x,this.y,this.z);return e};o.getElementColor=function(t,n,r,i){if(i==2&&this.any||this.rgroup!==-1){return r}if(t){r=e[this.label].jmolColor}else if(n){r=e[this.label].pymolColor}return r}})(ChemDoodle.ELEMENT,ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,Math,mat4);(function(e,t,n,r,i,s,o){"use strict";n.Bond=function(e,t,n){this.a1=e;this.a2=t;this.bondOrder=n!==undefined?n:1};n.Bond.STEREO_NONE="none";n.Bond.STEREO_PROTRUDING="protruding";n.Bond.STEREO_RECESSED="recessed";n.Bond.STEREO_AMBIGUOUS="ambiguous";var u=n.Bond.prototype;u.stereo=n.Bond.STEREO_NONE;u.isHover=false;u.ring=undefined;u.getCenter=function(){return new n.Point((this.a1.x+this.a2.x)/2,(this.a1.y+this.a2.y)/2)};u.getLength=function(){return this.a1.distance(this.a2)};u.getLength3D=function(){return this.a1.distance3D(this.a2)};u.contains=function(e){return e===this.a1||e===this.a2};u.getNeighbor=function(e){if(e===this.a1){return this.a2}else if(e===this.a2){return this.a1}return undefined};u.draw=function(e,s){if(this.a1.x===this.a2.x&&this.a1.y===this.a2.y){return}if(this.specs){s=this.specs}var o=this.a1.x;var u=this.a2.x;var a=this.a1.y;var f=this.a2.y;var l=this.a1.distance(this.a2);var c=u-o;var h=f-a;if(this.a1.isLassoed&&this.a2.isLassoed){var p=e.createLinearGradient(o,a,u,f);p.addColorStop(0,"rgba(212, 99, 0, 0)");p.addColorStop(.5,"rgba(212, 99, 0, 0.8)");p.addColorStop(1,"rgba(212, 99, 0, 0)");var d=2.5;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var b=o-g*d;var w=a+y*d;var E=o+g*d;var S=a-y*d;var x=u+g*d;var T=f-y*d;var N=u-g*d;var C=f+y*d;e.fillStyle=p;e.beginPath();e.moveTo(b,w);e.lineTo(E,S);e.lineTo(x,T);e.lineTo(N,C);e.closePath();e.fill()}if(s.atoms_display&&!s.atoms_circles_2D&&this.a1.isLabelVisible(s)&&this.a1.textBounds){var k=0;for(var L=0,A=this.a1.textBounds.length;L<A;L++){k=Math.max(k,r.calculateDistanceInterior(this.a1,this.a2,this.a1.textBounds[L]))}k+=s.bonds_atomLabelBuffer_2D;var O=k/l;o+=c*O;a+=h*O}if(s.atoms_display&&!s.atoms_circles_2D&&this.a2.isLabelVisible(s)&&this.a2.textBounds){var k=0;for(var L=0,A=this.a2.textBounds.length;L<A;L++){k=Math.max(k,r.calculateDistanceInterior(this.a2,this.a1,this.a2.textBounds[L]))}k+=s.bonds_atomLabelBuffer_2D;var O=k/l;u-=c*O;f-=h*O}if(s.bonds_clearOverlaps_2D){var M=o+c*.15;var _=a+h*.15;var D=u-c*.15;var P=f-h*.15;e.strokeStyle=s.backgroundColor;e.lineWidth=s.bonds_width_2D+s.bonds_overlapClearWidth_2D*2;e.lineCap="round";e.beginPath();e.moveTo(M,_);e.lineTo(D,P);e.closePath();e.stroke()}e.strokeStyle=s.bonds_color;e.fillStyle=s.bonds_color;e.lineWidth=s.bonds_width_2D;e.lineCap=s.bonds_ends_2D;if(s.bonds_useJMOLColors||s.bonds_usePYMOLColors){var H=e.createLinearGradient(o,a,u,f);var B=this.a1.getElementColor(s.bonds_useJMOLColors,s.bonds_usePYMOLColors,s.atoms_color,2);var j=this.a2.getElementColor(s.bonds_useJMOLColors,s.bonds_usePYMOLColors,s.atoms_color,2);H.addColorStop(0,B);if(!s.bonds_colorGradient){H.addColorStop(.5,B);H.addColorStop(.51,j)}H.addColorStop(1,j);e.strokeStyle=H;e.fillStyle=H}switch(this.bondOrder){case 0:var F=u-o;var I=f-a;var q=i.sqrt(F*F+I*I);var R=i.floor(q/s.bonds_dotSize_2D);var U=(q-(R-1)*s.bonds_dotSize_2D)/2;if(R%2===1){U+=s.bonds_dotSize_2D/4}else{U-=s.bonds_dotSize_2D/4;R+=2}R/=2;var z=this.a1.angle(this.a2);var M=o+U*Math.cos(z);var _=a-U*Math.sin(z);e.beginPath();for(var L=0;L<R;L++){e.arc(M,_,s.bonds_dotSize_2D/2,0,i.PI*2,false);M+=2*s.bonds_dotSize_2D*Math.cos(z);_-=2*s.bonds_dotSize_2D*Math.sin(z)}e.fill();break;case.5:e.beginPath();e.moveTo(o,a);t.contextHashTo(e,o,a,u,f,s.bonds_hashSpacing_2D,s.bonds_hashSpacing_2D);e.stroke();break;case 1:if(this.stereo===n.Bond.STEREO_PROTRUDING||this.stereo===n.Bond.STEREO_RECESSED){var W=s.bonds_width_2D/2;var d=this.a1.distance(this.a2)*s.bonds_wedgeThickness_2D/2;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var b=o-g*W;var w=a+y*W;var E=o+g*W;var S=a-y*W;var x=u+g*d;var T=f-y*d;var N=u-g*d;var C=f+y*d;e.beginPath();e.moveTo(b,w);e.lineTo(E,S);e.lineTo(x,T);e.lineTo(N,C);e.closePath();if(this.stereo===n.Bond.STEREO_PROTRUDING){e.fill()}else{e.save();e.clip();e.lineWidth=d*2;e.lineCap="butt";e.beginPath();e.moveTo(o,a);t.contextHashTo(e,o,a,u,f,s.bonds_hashWidth_2D,s.bonds_hashSpacing_2D);e.stroke();e.restore()}}else if(this.stereo===n.Bond.STEREO_AMBIGUOUS){e.beginPath();e.moveTo(o,a);var X=i.floor(i.sqrt(c*c+h*h)/s.bonds_wavyLength_2D);var V=o;var $=a;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var J=c/X;var K=h/X;var Q,G,Y,Z;for(var L=0,A=X;L<A;L++){V+=J;$+=K;Q=s.bonds_wavyLength_2D*g+V-J*.5;Y=s.bonds_wavyLength_2D*-y+$-K*.5;G=s.bonds_wavyLength_2D*-g+V-J*.5;Z=s.bonds_wavyLength_2D*y+$-K*.5;if(L%2===0){e.quadraticCurveTo(Q,Y,V,$)}else{e.quadraticCurveTo(G,Z,V,$)}}e.stroke();break}else{e.beginPath();e.moveTo(o,a);e.lineTo(u,f);e.stroke()}break;case 1.5:case 2:if(this.stereo===n.Bond.STEREO_AMBIGUOUS){var d=this.a1.distance(this.a2)*s.bonds_saturationWidth_2D/2;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var b=o-g*d;var w=a+y*d;var E=o+g*d;var S=a-y*d;var x=u+g*d;var T=f-y*d;var N=u-g*d;var C=f+y*d;e.beginPath();e.moveTo(b,w);e.lineTo(x,T);e.moveTo(E,S);e.lineTo(N,C);e.stroke()}else if(!s.bonds_symmetrical_2D&&(this.ring||this.a1.label==="C"&&this.a2.label==="C")){e.beginPath();e.moveTo(o,a);e.lineTo(u,f);var et=0;var l=this.a1.distance(this.a2);var z=this.a1.angle(this.a2);var v=z+i.PI/2;var d=l*s.bonds_saturationWidth_2D;var tt=s.bonds_saturationAngle_2D;if(tt<i.PI/2){et=-(d/i.tan(tt))}if(i.abs(et)<l/2){var nt=o-i.cos(z)*et;var rt=u+i.cos(z)*et;var it=a+i.sin(z)*et;var st=f-i.sin(z)*et;var g=i.cos(v);var y=i.sin(v);var b=nt-g*d;var w=it+y*d;var E=nt+g*d;var S=it-y*d;var x=rt-g*d;var T=st+y*d;var N=rt+g*d;var C=st-y*d;var ot=!this.ring||this.ring.center.angle(this.a1)>this.ring.center.angle(this.a2)&&!(this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)>i.PI)||this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)<-i.PI;if(ot){e.moveTo(b,w);if(this.bondOrder===2){e.lineTo(x,T)}else{t.contextHashTo(e,b,w,x,T,s.bonds_hashSpacing_2D,s.bonds_hashSpacing_2D)}}else{e.moveTo(E,S);if(this.bondOrder===2){e.lineTo(N,C)}else{t.contextHashTo(e,E,S,N,C,s.bonds_hashSpacing_2D,s.bonds_hashSpacing_2D)}}e.stroke()}}else{var d=this.a1.distance(this.a2)*s.bonds_saturationWidth_2D/2;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var b=o-g*d;var w=a+y*d;var E=o+g*d;var S=a-y*d;var x=u+g*d;var T=f-y*d;var N=u-g*d;var C=f+y*d;e.beginPath();e.moveTo(b,w);e.lineTo(N,C);e.moveTo(E,S);if(this.bondOrder===2){e.lineTo(x,T)}else{t.contextHashTo(e,E,S,x,T,s.bonds_hashSpacing_2D,s.bonds_hashSpacing_2D)}e.stroke()}break;case 3:var d=this.a1.distance(this.a2)*s.bonds_saturationWidth_2D;var v=this.a1.angle(this.a2)+i.PI/2;var g=i.cos(v);var y=i.sin(v);var b=o-g*d;var w=a+y*d;var E=o+g*d;var S=a-y*d;var x=u+g*d;var T=f-y*d;var N=u-g*d;var C=f+y*d;e.beginPath();e.moveTo(b,w);e.lineTo(N,C);e.moveTo(E,S);e.lineTo(x,T);e.moveTo(o,a);e.lineTo(u,f);e.stroke();break}};u.drawDecorations=function(e){if(this.isHover||this.isSelected){var t=2*i.PI;var n=(this.a1.angleForStupidCanvasArcs(this.a2)+i.PI/2)%t;e.strokeStyle=this.isHover?"#885110":"#0060B2";e.lineWidth=1.2;e.beginPath();var r=(n+i.PI)%t;r=r%(i.PI*2);e.arc(this.a1.x,this.a1.y,7,n,r,false);e.stroke();e.beginPath();n+=i.PI;r=(n+i.PI)%t;e.arc(this.a2.x,this.a2.y,7,n,r,false);e.stroke()}};u.render=function(e,n,r){if(this.specs){n=this.specs}var u=this.a1.distance3D(this.a2);if(u===0){return}var a=n.bonds_cylinderDiameter_3D/2;var f=n.bonds_color;var l;var c=s.translate(e.modelViewMatrix,[this.a1.x,this.a1.y,this.a1.z],[]);var h;var p=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z];var d=[0,1,0];var v=0;var g;if(this.a1.x===this.a2.x&&this.a1.z===this.a2.z){g=[0,0,1];if(this.a2.y<this.a1.y){v=i.PI}}else{v=t.vec3AngleFrom(d,p);g=o.cross(d,p,[])}var y=n.bonds_useJMOLColors;var b=n.bonds_usePYMOLColors;if(y||b){f=this.a1.getElementColor(y,b,f);l=this.a2.getElementColor(y,b,n.bonds_color);if(f!=l){h=s.translate(e.modelViewMatrix,[this.a2.x,this.a2.y,this.a2.z],[])}}var w=[0];var E;if(r){if(n.bonds_showBondOrders_3D&&this.bondOrder>1){w=[n.bonds_cylinderDiameter_3D];var S=[0,0,1];var x=s.inverse(e.rotationMatrix,[]);s.multiplyVec3(x,S);E=o.cross(p,S,[]);o.normalize(E)}var T=1;var N=n.bonds_pillSpacing_3D;var C=n.bonds_pillHeight_3D;if(this.bondOrder==0){if(n.bonds_renderAsLines_3D){C=N}else{C=n.bonds_pillDiameter_3D;if(C<n.bonds_cylinderDiameter_3D){C/=2}T=C/2;u/=T;N/=T/2}}var k=C+N;var L=u/k;var A=i.floor(L);var O=u-k*A;var M=(N+n.bonds_pillDiameter_3D+O)/2;var _=A;if(h){_=i.floor(A/2)}for(var D=0,P=w.length;D<P;D++){var H=s.set(c,[]);if(w[D]!==0){s.translate(H,o.scale(E,w[D],[]))}if(v!==0){s.rotate(H,v,g)}if(T!=1){s.scale(H,[T,T,T])}if(f)e.material.setDiffuseColor(f);s.translate(H,[0,M,0]);for(var B=0;B<_;B++){if(n.bonds_renderAsLines_3D){if(this.bondOrder==0){e.setMatrixUniforms(H);e.drawArrays(e.POINTS,0,1)}else{s.scale(H,[1,C,1]);e.setMatrixUniforms(H);e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems);s.scale(H,[1,1/C,1])}}else{e.setMatrixUniforms(H);if(this.bondOrder==0){e.drawElements(e.TRIANGLES,e.sphereBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}else{e.drawElements(e.TRIANGLES,e.pillBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}s.translate(H,[0,k,0])}if(h){var j,F;if(n.bonds_renderAsLines_3D){j=C;j/=2;F=0}else{j=2/3;F=(1-j)/2}if(A%2!=0){s.scale(H,[1,j,1]);e.setMatrixUniforms(H);if(n.bonds_renderAsLines_3D){if(this.bondOrder==0){e.drawArrays(e.POINTS,0,1)}else{e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems)}}else{if(this.bondOrder==0){e.drawElements(e.TRIANGLES,e.sphereBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}else{e.drawElements(e.TRIANGLES,e.pillBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}s.translate(H,[0,k*(1+F),0]);s.scale(H,[1,1/j,1])}s.set(h,H);if(w[D]!==0){s.translate(H,o.scale(E,w[D],[]))}s.rotate(H,v+i.PI,g);if(T!=1){s.scale(H,[T,T,T])}if(l)e.material.setDiffuseColor(l);s.translate(H,[0,M,0]);for(var B=0;B<_;B++){if(n.bonds_renderAsLines_3D){if(this.bondOrder==0){e.setMatrixUniforms(H);e.drawArrays(e.POINTS,0,1)}else{s.scale(H,[1,C,1]);e.setMatrixUniforms(H);e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems);s.scale(H,[1,1/C,1])}}else{e.setMatrixUniforms(H);if(this.bondOrder==0){e.drawElements(e.TRIANGLES,e.sphereBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}else{e.drawElements(e.TRIANGLES,e.pillBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}s.translate(H,[0,k,0])}if(A%2!=0){s.scale(H,[1,j,1]);e.setMatrixUniforms(H);if(n.bonds_renderAsLines_3D){if(this.bondOrder==0){e.drawArrays(e.POINTS,0,1)}else{e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems)}}else{if(this.bondOrder==0){e.drawElements(e.TRIANGLES,e.sphereBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}else{e.drawElements(e.TRIANGLES,e.pillBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}s.translate(H,[0,k*(1+F),0]);s.scale(H,[1,1/j,1])}}}}else{if(n.bonds_showBondOrders_3D){switch(this.bondOrder){case 1.5:w=[-n.bonds_cylinderDiameter_3D];break;case 2:w=[-n.bonds_cylinderDiameter_3D,n.bonds_cylinderDiameter_3D];break;case 3:w=[-1.2*n.bonds_cylinderDiameter_3D,0,1.2*n.bonds_cylinderDiameter_3D];break}if(this.bondOrder>1){var S=[0,0,1];var x=s.inverse(e.rotationMatrix,[]);s.multiplyVec3(x,S);E=o.cross(p,S,[]);o.normalize(E)}}else{switch(this.bondOrder){case 0:a*=.25;break;case.5:case 1.5:a*=.5;break}}if(h){u/=2}var I=[a,u,a];for(var D=0,P=w.length;D<P;D++){var H=s.set(c,[]);if(w[D]!==0){s.translate(H,o.scale(E,w[D],[]))}if(v!==0){s.rotate(H,v,g)}s.scale(H,I);if(f)e.material.setDiffuseColor(f);e.setMatrixUniforms(H);if(n.bonds_renderAsLines_3D){e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems)}else{e.drawArrays(e.TRIANGLE_STRIP,0,e.cylinderBuffer.vertexPositionBuffer.numItems)}if(h){s.set(h,H);if(w[D]!==0){s.translate(H,o.scale(E,w[D],[]))}s.rotate(H,v+i.PI,g);s.scale(H,I);if(l)e.material.setDiffuseColor(l);e.setMatrixUniforms(H);if(n.bonds_renderAsLines_3D){e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems)}else{e.drawArrays(e.TRIANGLE_STRIP,0,e.cylinderBuffer.vertexPositionBuffer.numItems)}}}}};u.renderPicker=function(e,n){if(this.specs){n=this.specs}var r=this.a1.distance3D(this.a2);if(r===0){return}var u=n.bonds_cylinderDiameter_3D/2;var a=s.translate(e.modelViewMatrix,[this.a1.x,this.a1.y,this.a1.z],[]);var f=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z];var l=[0,1,0];var c=0;var h;if(this.a1.x===this.a2.x&&this.a1.z===this.a2.z){h=[0,0,1];if(this.a2.y<this.a1.y){c=i.PI}}else{c=t.vec3AngleFrom(l,f);h=o.cross(l,f,[])}var p=[0];var d;if(n.bonds_showBondOrders_3D){if(n.bonds_renderAsLines_3D){switch(this.bondOrder){case 1.5:case 2:p=[-n.bonds_cylinderDiameter_3D,n.bonds_cylinderDiameter_3D];break;case 3:p=[-1.2*n.bonds_cylinderDiameter_3D,0,1.2*n.bonds_cylinderDiameter_3D];break}if(this.bondOrder>1){var v=[0,0,1];var g=s.inverse(e.rotationMatrix,[]);s.multiplyVec3(g,v);d=o.cross(f,v,[]);o.normalize(d)}}else{switch(this.bondOrder){case 1.5:case 2:u*=3;break;case 3:u*=3.4;break}}}else{switch(this.bondOrder){case 0:u*=.25;break;case.5:case 1.5:u*=.5;break}}var y=[u,r,u];for(var b=0,w=p.length;b<w;b++){var E=s.set(a,[]);if(p[b]!==0){s.translate(E,o.scale(d,p[b],[]))}if(c!==0){s.rotate(E,c,h)}s.scale(E,y);e.setMatrixUniforms(E);if(n.bonds_renderAsLines_3D){e.drawArrays(e.LINES,0,e.lineBuffer.vertexPositionBuffer.numItems)}else{e.drawArrays(e.TRIANGLE_STRIP,0,e.cylinderBuffer.vertexPositionBuffer.numItems)}}}})(ChemDoodle.ELEMENT,ChemDoodle.extensions,ChemDoodle.structures,ChemDoodle.math,Math,mat4,vec3);(function(e,t){"use strict";e.Ring=function(){this.atoms=[];this.bonds=[]};var n=e.Ring.prototype;n.center=undefined;n.setupBonds=function(){for(var e=0,t=this.bonds.length;e<t;e++){this.bonds[e].ring=this}this.center=this.getCenter()};n.getCenter=function(){var n=Infinity,r=Infinity,i=-Infinity,s=-Infinity;for(var o=0,u=this.atoms.length;o<u;o++){n=t.min(this.atoms[o].x,n);r=t.min(this.atoms[o].y,r);i=t.max(this.atoms[o].x,i);s=t.max(this.atoms[o].y,s)}return new e.Point((i+n)/2,(s+r)/2)}})(ChemDoodle.structures,Math);(function(e,t,n,r,i){"use strict";n.Molecule=function(){this.atoms=[];this.bonds=[];this.rings=[]};var s=n.Molecule.prototype;s.findRings=true;s.draw=function(e,t){if(this.specs){t=this.specs}if(t.atoms_display&&!t.atoms_circles_2D){for(var n=0,r=this.atoms.length;n<r;n++){this.atoms[n].draw(e,t)}}if(t.bonds_display){for(var n=0,r=this.bonds.length;n<r;n++){this.bonds[n].draw(e,t)}}if(t.atoms_display&&t.atoms_circles_2D){for(var n=0,r=this.atoms.length;n<r;n++){this.atoms[n].draw(e,t)}}};s.render=function(e,t){if(this.specs){t=this.specs}var i=this.atoms.length>0&&this.atoms[0].hetatm!==undefined;if(i){if(t.macro_displayBonds){if(this.bonds.length>0){if(t.bonds_renderAsLines_3D&&!this.residueSpecs||this.residueSpecs&&this.residueSpecs.bonds_renderAsLines_3D){e.lineWidth(this.residueSpecs?this.residueSpecs.bonds_width_2D:t.bonds_width_2D);e.lineBuffer.bindBuffers(e)}else{e.cylinderBuffer.bindBuffers(e)}e.material.setTempColors(t.bonds_materialAmbientColor_3D,undefined,t.bonds_materialSpecularColor_3D,t.bonds_materialShininess_3D)}for(var s=0,o=this.bonds.length;s<o;s++){var u=this.bonds[s];if(!u.a1.hetatm&&(t.macro_atomToLigandDistance===-1||u.a1.closestDistance!==undefined&&t.macro_atomToLigandDistance>=u.a1.closestDistance&&t.macro_atomToLigandDistance>=u.a2.closestDistance)){u.render(e,this.residueSpecs?this.residueSpecs:t)}}}if(t.macro_displayAtoms){if(this.atoms.length>0){e.sphereBuffer.bindBuffers(e);e.material.setTempColors(t.atoms_materialAmbientColor_3D,undefined,t.atoms_materialSpecularColor_3D,t.atoms_materialShininess_3D)}for(var s=0,o=this.atoms.length;s<o;s++){var a=this.atoms[s];if(!a.hetatm&&(t.macro_atomToLigandDistance===-1||a.closestDistance!==undefined&&t.macro_atomToLigandDistance>=a.closestDistance)){a.render(e,this.residueSpecs?this.residueSpecs:t)}}}}if(t.bonds_display){var f=[];var l=[];if(this.bonds.length>0){if(t.bonds_renderAsLines_3D){e.lineWidth(t.bonds_width_2D);e.lineBuffer.bindBuffers(e)}else{e.cylinderBuffer.bindBuffers(e)}e.material.setTempColors(t.bonds_materialAmbientColor_3D,undefined,t.bonds_materialSpecularColor_3D,t.bonds_materialShininess_3D)}for(var s=0,o=this.bonds.length;s<o;s++){var u=this.bonds[s];if(!i||u.a1.hetatm){if(t.bonds_showBondOrders_3D){if(u.bondOrder==0){l.push(u)}else if(u.bondOrder==.5){f.push(u)}else{if(u.bondOrder==1.5){f.push(u)}u.render(e,t)}}else{u.render(e,t)}}}if(f.length>0){if(!t.bonds_renderAsLines_3D){e.pillBuffer.bindBuffers(e)}for(var s=0,o=f.length;s<o;s++){f[s].render(e,t,true)}}if(l.length>0){if(!t.bonds_renderAsLines_3D){e.sphereBuffer.bindBuffers(e)}for(var s=0,o=l.length;s<o;s++){l[s].render(e,t,true)}}}if(t.atoms_display){for(var s=0,o=this.atoms.length;s<o;s++){var a=this.atoms[s];a.bondNumber=0;a.renderAsStar=false}for(var s=0,o=this.bonds.length;s<o;s++){var u=this.bonds[s];u.a1.bondNumber++;u.a2.bondNumber++}if(this.atoms.length>0){e.sphereBuffer.bindBuffers(e);e.material.setTempColors(t.atoms_materialAmbientColor_3D,undefined,t.atoms_materialSpecularColor_3D,t.atoms_materialShininess_3D)}var c=[];for(var s=0,o=this.atoms.length;s<o;s++){var a=this.atoms[s];if(!i||a.hetatm&&(t.macro_showWater||!a.isWater)){if(t.atoms_nonBondedAsStars_3D&&a.bondNumber===0){a.renderAsStar=true;c.push(a)}else{a.render(e,t)}}}if(c.length>0){e.starBuffer.bindBuffers(e);for(var s=0,o=c.length;s<o;s++){c[s].render(e,t)}}}if(this.chains){e.setMatrixUniforms(e.modelViewMatrix);if(t.proteins_displayRibbon){e.material.setTempColors(t.proteins_materialAmbientColor_3D,undefined,t.proteins_materialSpecularColor_3D,t.proteins_materialShininess_3D);for(var h=0,p=this.ribbons.length;h<p;h++){if(t.proteins_useShapelyColors||t.proteins_useAminoColors||t.proteins_usePolarityColors){var d=t.proteins_ribbonCartoonize?this.cartoons[h]:this.ribbons[h];d.front.bindBuffers(e);for(var s=0,o=d.front.segments.length;s<o;s++){d.front.segments[s].render(e,t)}d.back.bindBuffers(e);for(var s=0,o=d.back.segments.length;s<o;s++){d.back.segments[s].render(e,t)}}else{if(t.proteins_ribbonCartoonize){var d=this.cartoons[h];d.front.bindBuffers(e);for(var s=0,o=d.front.cartoonSegments.length;s<o;s++){d.front.cartoonSegments[s].render(e,t)}d.back.bindBuffers(e);for(var s=0,o=d.back.cartoonSegments.length;s<o;s++){d.back.cartoonSegments[s].render(e,t)}}else{var d=this.ribbons[h];d.front.render(e,t);d.back.render(e,t)}}}}if(t.proteins_displayBackbone){if(!this.alphaCarbonTrace){this.alphaCarbonTrace={nodes:[],edges:[]};for(var h=0,p=this.chains.length;h<p;h++){var v=this.chains[h];var m=v.length>2&&r[v[2].name]&&r[v[2].name].aminoColor==="#BEA06E";if(!m&&v.length>0){for(var s=1,o=v.length-2;s<o;s++){var g=v[s].cp1;g.chainColor=v.chainColor;this.alphaCarbonTrace.nodes.push(g);var u=new n.Bond(v[s].cp1,v[s+1].cp1);u.residueName=v[s].name;u.chainColor=v.chainColor;this.alphaCarbonTrace.edges.push(u);if(s===v.length-3){g=v[s+1].cp1;g.chainColor=v.chainColor;this.alphaCarbonTrace.nodes.push(g)}}}}}if(this.alphaCarbonTrace.nodes.length>0){var y=new n.VisualSpecifications;y.atoms_display=true;y.bonds_display=true;y.atoms_sphereDiameter_3D=t.proteins_backboneThickness;y.bonds_cylinderDiameter_3D=t.proteins_backboneThickness;y.bonds_useJMOLColors=false;y.atoms_color=t.proteins_backboneColor;y.bonds_color=t.proteins_backboneColor;y.atoms_useVDWDiameters_3D=false;e.material.setTempColors(t.proteins_materialAmbientColor_3D,undefined,t.proteins_materialSpecularColor_3D,t.proteins_materialShininess_3D);e.material.setDiffuseColor(t.proteins_backboneColor);for(var s=0,o=this.alphaCarbonTrace.nodes.length;s<o;s++){var g=this.alphaCarbonTrace.nodes[s];if(t.macro_colorByChain){y.atoms_color=g.chainColor}e.sphereBuffer.bindBuffers(e);g.render(e,y)}for(var s=0,o=this.alphaCarbonTrace.edges.length;s<o;s++){var b=this.alphaCarbonTrace.edges[s];var w;var E=r[b.residueName]?r[b.residueName]:r["*"];if(t.macro_colorByChain){w=b.chainColor}else if(t.proteins_useShapelyColors){w=E.shapelyColor}else if(t.proteins_useAminoColors){w=E.aminoColor}else if(t.proteins_usePolarityColors){if(E.polar){w="#C10000"}else{w="#FFFFFF"}}if(w){y.bonds_color=w}e.cylinderBuffer.bindBuffers(e);b.render(e,y)}}}if(t.nucleics_display){e.material.setTempColors(t.nucleics_materialAmbientColor_3D,undefined,t.nucleics_materialSpecularColor_3D,t.nucleics_materialShininess_3D);for(var h=0,p=this.tubes.length;h<p;h++){e.setMatrixUniforms(e.modelViewMatrix);var d=this.tubes[h];d.render(e,t)}}}if(t.crystals_displayUnitCell&&this.unitCell){e.setMatrixUniforms(e.modelViewMatrix);this.unitCell.bindBuffers(e);e.material.setDiffuseColor(t.crystals_unitCellColor);e.lineWidth(t.crystals_unitCellLineWidth);e.drawElements(e.LINES,this.unitCell.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}if(this.surface&&t.surfaces_display){e.setMatrixUniforms(e.modelViewMatrix);this.surface.bindBuffers(e);e.material.setTempColors(t.surfaces_materialAmbientColor_3D,t.surfaces_color,t.surfaces_materialSpecularColor_3D,t.surfaces_materialShininess_3D);if(t.surfaces_style==="Dot"){e.drawArrays(e.POINTS,0,this.surface.vertexPositionBuffer.numItems)}else{e.drawElements(e.TRIANGLES,this.surface.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}};s.renderPickFrame=function(e,n,r){if(this.specs){n=this.specs}var i=this.atoms.length>0&&this.atoms[0].hetatm!==undefined;if(n.bonds_display){if(this.bonds.length>0){if(n.bonds_renderAsLines_3D){e.lineWidth(n.bonds_width_2D);e.lineBuffer.bindBuffers(e)}else{e.cylinderBuffer.bindBuffers(e)}}for(var s=0,o=this.bonds.length;s<o;s++){var u=this.bonds[s];if(!i||u.a1.hetatm){e.material.setDiffuseColor(t.idx2color(r.length));u.renderPicker(e,n);r.push(u)}}}if(n.atoms_display){for(var s=0,o=this.atoms.length;s<o;s++){var a=this.atoms[s];a.bondNumber=0;a.renderAsStar=false}for(var s=0,o=this.bonds.length;s<o;s++){var u=this.bonds[s];u.a1.bondNumber++;u.a2.bondNumber++}if(this.atoms.length>0){e.sphereBuffer.bindBuffers(e)}var f=[];for(var s=0,o=this.atoms.length;s<o;s++){var a=this.atoms[s];if(!i||a.hetatm&&(n.macro_showWater||!a.isWater)){if(n.atoms_nonBondedAsStars_3D&&a.bondNumber===0){a.renderAsStar=true;f.push(a)}else{e.material.setDiffuseColor(t.idx2color(r.length));a.render(e,n,true);r.push(a)}}}if(f.length>0){e.starBuffer.bindBuffers(e);for(var s=0,o=f.length;s<o;s++){var a=f[s];e.material.setDiffuseColor(t.idx2color(r.length));a.render(e,n,true);r.push(a)}}}};s.getCenter3D=function(){if(this.atoms.length===1){return new n.Atom("C",this.atoms[0].x,this.atoms[0].y,this.atoms[0].z)}var e=Infinity,t=Infinity,r=Infinity;var s=-Infinity,o=-Infinity,u=-Infinity;if(this.chains){for(var a=0,f=this.chains.length;a<f;a++){var l=this.chains[a];for(var c=0,h=l.length;c<h;c++){var p=l[c];e=i.min(p.cp1.x,p.cp2.x,e);t=i.min(p.cp1.y,p.cp2.y,t);r=i.min(p.cp1.z,p.cp2.z,r);s=i.max(p.cp1.x,p.cp2.x,s);o=i.max(p.cp1.y,p.cp2.y,o);u=i.max(p.cp1.z,p.cp2.z,u)}}}for(var a=0,f=this.atoms.length;a<f;a++){e=i.min(this.atoms[a].x,e);t=i.min(this.atoms[a].y,t);r=i.min(this.atoms[a].z,r);s=i.max(this.atoms[a].x,s);o=i.max(this.atoms[a].y,o);u=i.max(this.atoms[a].z,u)}return new n.Atom("C",(s+e)/2,(o+t)/2,(u+r)/2)};s.getCenter=function(){if(this.atoms.length===1){return new n.Point(this.atoms[0].x,this.atoms[0].y)}var e=Infinity,t=Infinity;var r=-Infinity,s=-Infinity;for(var o=0,u=this.atoms.length;o<u;o++){e=i.min(this.atoms[o].x,e);t=i.min(this.atoms[o].y,t);r=i.max(this.atoms[o].x,r);s=i.max(this.atoms[o].y,s)}return new n.Point((r+e)/2,(s+t)/2)};s.getDimension=function(){if(this.atoms.length===1){return new n.Point(0,0)}var e=Infinity,t=Infinity;var r=-Infinity,s=-Infinity;if(this.chains){for(var o=0,u=this.chains.length;o<u;o++){var a=this.chains[o];for(var f=0,l=a.length;f<l;f++){var c=a[f];e=i.min(c.cp1.x,c.cp2.x,e);t=i.min(c.cp1.y,c.cp2.y,t);r=i.max(c.cp1.x,c.cp2.x,r);s=i.max(c.cp1.y,c.cp2.y,s)}}e-=30;t-=30;r+=30;s+=30}for(var o=0,u=this.atoms.length;o<u;o++){e=i.min(this.atoms[o].x,e);t=i.min(this.atoms[o].y,t);r=i.max(this.atoms[o].x,r);s=i.max(this.atoms[o].y,s)}return new n.Point(r-e,s-t)};s.check=function(t){if(t&&this.doChecks){if(this.findRings){if(this.bonds.length-this.atoms.length!==this.fjNumCache){this.rings=(new e.informatics.SSSRFinder(this)).rings;for(var n=0,r=this.bonds.length;n<r;n++){this.bonds[n].ring=undefined}for(var n=0,r=this.rings.length;n<r;n++){this.rings[n].setupBonds()}}else{for(var n=0,r=this.rings.length;n<r;n++){var i=this.rings[n];i.center=i.getCenter()}}}for(var n=0,r=this.atoms.length;n<r;n++){this.atoms[n].isLone=false;if(this.atoms[n].label==="C"){var s=0;for(var o=0,u=this.bonds.length;o<u;o++){if(this.bonds[o].a1===this.atoms[n]||this.bonds[o].a2===this.atoms[n]){s++}}if(s===0){this.atoms[n].isLone=true}}}var a=false;for(var n=0,r=this.atoms.length;n<r;n++){if(this.atoms[n].z!==0){a=true}}if(a){this.sortAtomsByZ();this.sortBondsByZ()}this.setupMetaData();this.atomNumCache=this.atoms.length;this.bondNumCache=this.bonds.length;this.fjNumCache=this.bonds.length-this.atoms.length}this.doChecks=!t};s.getAngles=function(e){var t=[];for(var n=0,r=this.bonds.length;n<r;n++){if(this.bonds[n].contains(e)){t.push(e.angle(this.bonds[n].getNeighbor(e)))}}t.sort();return t};s.getCoordinationNumber=function(e){var t=0;for(var n=0,r=e.length;n<r;n++){t+=e[n].bondOrder}return t};s.getBonds=function(e){var t=[];for(var n=0,r=this.bonds.length;n<r;n++){if(this.bonds[n].contains(e)){t.push(this.bonds[n])}}return t};s.sortAtomsByZ=function(){for(var e=1,t=this.atoms.length;e<t;e++){var n=e;while(n>0&&this.atoms[n].z<this.atoms[n-1].z){var r=this.atoms[n];this.atoms[n]=this.atoms[n-1];this.atoms[n-1]=r;n--}}};s.sortBondsByZ=function(){for(var e=1,t=this.bonds.length;e<t;e++){var n=e;while(n>0&&this.bonds[n].a1.z+this.bonds[n].a2.z<this.bonds[n-1].a1.z+this.bonds[n-1].a2.z){var r=this.bonds[n];this.bonds[n]=this.bonds[n-1];this.bonds[n-1]=r;n--}}};s.setupMetaData=function(){var e=this.getCenter();for(var n=0,r=this.atoms.length;n<r;n++){var s=this.atoms[n];s.bonds=this.getBonds(s);s.angles=this.getAngles(s);s.isHidden=s.bonds.length===2&&i.abs(i.abs(s.angles[1]-s.angles[0])-i.PI)<i.PI/30&&s.bonds[0].bondOrder===s.bonds[1].bondOrder;var o=t.angleBetweenLargest(s.angles);s.angleOfLeastInterference=o.angle%(i.PI*2);s.largestAngle=o.largest;s.coordinationNumber=this.getCoordinationNumber(s.bonds);s.bondNumber=s.bonds.length;s.molCenter=e}for(var n=0,r=this.bonds.length;n<r;n++){var u=this.bonds[n];u.molCenter=e}};s.scaleToAverageBondLength=function(e){var t=this.getAverageBondLength();if(t!==0){var n=e/t;for(var r=0,i=this.atoms.length;r<i;r++){this.atoms[r].x*=n;this.atoms[r].y*=n}}};s.getAverageBondLength=function(){if(this.bonds.length===0){return 0}var e=0;for(var t=0,n=this.bonds.length;t<n;t++){e+=this.bonds[t].getLength()}e/=this.bonds.length;return e};s.getBounds=function(){var e=new t.Bounds;for(var n=0,r=this.atoms.length;n<r;n++){e.expand(this.atoms[n].getBounds())}if(this.chains){for(var n=0,r=this.chains.length;n<r;n++){var i=this.chains[n];for(var s=0,o=i.length;s<o;s++){var u=i[s];e.expand(u.cp1.x,u.cp1.y);e.expand(u.cp2.x,u.cp2.y)}}e.minX-=30;e.minY-=30;e.maxX+=30;e.maxY+=30}return e};s.getBounds3D=function(){var e=new t.Bounds;for(var n=0,r=this.atoms.length;n<r;n++){e.expand(this.atoms[n].getBounds3D())}if(this.chains){for(var n=0,r=this.chains.length;n<r;n++){var i=this.chains[n];for(var s=0,o=i.length;s<o;s++){var u=i[s];e.expand3D(u.cp1.x,u.cp1.y,u.cp1.z);e.expand3D(u.cp2.x,u.cp2.y,u.cp2.z)}}}return e}})(ChemDoodle,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.RESIDUE,Math);(function(e,t,n,r){"use strict";function o(e){var t=e*e;var r=e*e*e;var o=[6/r,0,0,0,6/r,2/t,0,0,1/r,1/t,1/e,0,0,0,0,1];var u=[-1/6,1/2,-1/2,1/6,1/2,-1,1/2,0,-1/2,0,1/2,0,1/6,2/3,1/6,0];i=n.multiply(u,o,[]);s=e}var i;var s=-1;e.Residue=function(e){this.resSeq=e};var u=e.Residue.prototype;u.setup=function(t,n){this.horizontalResolution=n;var i=[t.x-this.cp1.x,t.y-this.cp1.y,t.z-this.cp1.z];var s=[this.cp2.x-this.cp1.x,this.cp2.y-this.cp1.y,this.cp2.z-this.cp1.z];var o=r.cross(i,s,[]);this.D=r.cross(o,i,[]);r.normalize(o);r.normalize(this.D);this.guidePointsSmall=[];this.guidePointsLarge=[];var u=[(t.x+this.cp1.x)/2,(t.y+this.cp1.y)/2,(t.z+this.cp1.z)/2];if(this.helix){r.scale(o,1.5);r.add(u,o)}this.guidePointsSmall[0]=new e.Atom("",u[0]-this.D[0]/2,u[1]-this.D[1]/2,u[2]-this.D[2]/2);for(var a=1;a<n;a++){this.guidePointsSmall[a]=new e.Atom("",this.guidePointsSmall[0].x+this.D[0]*a/n,this.guidePointsSmall[0].y+this.D[1]*a/n,this.guidePointsSmall[0].z+this.D[2]*a/n)}r.scale(this.D,4);this.guidePointsLarge[0]=new e.Atom("",u[0]-this.D[0]/2,u[1]-this.D[1]/2,u[2]-this.D[2]/2);for(var a=1;a<n;a++){this.guidePointsLarge[a]=new e.Atom("",this.guidePointsLarge[0].x+this.D[0]*a/n,this.guidePointsLarge[0].y+this.D[1]*a/n,this.guidePointsLarge[0].z+this.D[2]*a/n)}};u.getGuidePointSet=function(e){if(e===0){return this.helix||this.sheet?this.guidePointsLarge:this.guidePointsSmall}else if(e===1){return this.guidePointsSmall}else if(e===2){return this.guidePointsLarge}};u.computeLineSegments=function(e,t,n,r,i){if(i!==s){o(i)}this.split=t.helix!==this.helix||t.sheet!==this.sheet;this.lineSegments=this.innerCompute(0,e,t,n,false,i);if(r){this.lineSegmentsCartoon=this.innerCompute(t.helix||t.sheet?2:1,e,t,n,true,i)}};u.innerCompute=function(s,o,u,a,f,l){var c=[];var h=this.getGuidePointSet(s);var p=o.getGuidePointSet(s);var d=u.getGuidePointSet(s);var v=a.getGuidePointSet(s);for(var g=0,y=this.guidePointsLarge.length;g<y;g++){var b=[p[g].x,p[g].y,p[g].z,1,h[g].x,h[g].y,h[g].z,1,d[g].x,d[g].y,d[g].z,1,v[g].x,v[g].y,v[g].z,1];var w=n.multiply(b,i,[]);var E=[];for(var S=0;S<l;S++){for(var x=3;x>0;x--){for(var T=0;T<4;T++){w[x*4+T]+=w[(x-1)*4+T]}}E[S]=new e.Atom("",w[12]/w[15],w[13]/w[15],w[14]/w[15])}c[g]=E}if(f&&this.arrow){for(var x=0,N=l;x<N;x++){var C=1.5-1.3*x/l;var k=t.floor(this.horizontalResolution/2);var L=c[k];for(var T=0,A=c.length;T<A;T++){if(T!==k){var O=L[x];var M=c[T][x];var _=[M.x-O.x,M.y-O.y,M.z-O.z];r.scale(_,C);M.x=O.x+_[0];M.y=O.y+_[1];M.z=O.z+_[2]}}}}return c}})(ChemDoodle.structures,Math,mat4,vec3);(function(e,t,n,r,i){"use strict";t.Spectrum=function(){this.data=[];this.metadata=[];this.dataDisplay=[];this.memory={offsetTop:0,offsetLeft:0,offsetBottom:0,flipXAxis:false,scale:1,width:0,height:0}};var s=t.Spectrum.prototype;s.title=undefined;s.xUnit=undefined;s.yUnit=undefined;s.continuous=true;s.integrationSensitivity=.01;s.draw=function(t,n,r,s){if(this.specs){n=this.specs}var o=5;var u=0;var a=0;t.fillStyle=n.text_color;t.textAlign="center";t.textBaseline="alphabetic";t.font=e.getFontString(n.text_font_size,n.text_font_families);if(this.xUnit){a+=n.text_font_size;t.fillText(this.xUnit,r/2,s-2)}if(this.yUnit&&n.plots_showYAxis){u+=n.text_font_size;t.save();t.translate(n.text_font_size,s/2);t.rotate(-i.PI/2);t.fillText(this.yUnit,0,0);t.restore()}if(this.title){o+=n.text_font_size;t.fillText(this.title,r/2,n.text_font_size)}a+=5+n.text_font_size;if(n.plots_showYAxis){u+=5+t.measureText("1000").width}if(n.plots_showGrid){t.strokeStyle=n.plots_gridColor;t.lineWidth=n.plots_gridLineWidth;t.strokeRect(u,o,r-u,s-a-o)}t.textAlign="center";t.textBaseline="top";var f=this.maxX-this.minX;var l=f/100;var c=.001;while(c<l||f/c>25){c*=10}var h=0;var p=n.plots_flipXAxis?r:0;for(var d=i.round(this.minX/c)*c;d<=this.maxX;d+=c/2){var v=this.getTransformedX(d,n,r,u);if(v>u){t.strokeStyle="black";t.lineWidth=1;if(h%2===0){t.beginPath();t.moveTo(v,s-a);t.lineTo(v,s-a+2);t.stroke();var g=d.toFixed(5);while(g.charAt(g.length-1)==="0"){g=g.substring(0,g.length-1)}if(g.charAt(g.length-1)==="."){g=g.substring(0,g.length-1)}var y=t.measureText(g).width;if(n.plots_flipXAxis){y*=-1}var b=v-y/2;if(n.plots_flipXAxis?b<p:b>p){t.fillText(g,v,s-a+2);p=v+y/2}if(n.plots_showGrid){t.strokeStyle=n.plots_gridColor;t.lineWidth=n.plots_gridLineWidth;t.beginPath();t.moveTo(v,s-a);t.lineTo(v,o);t.stroke()}}else{t.beginPath();t.moveTo(v,s-a);t.lineTo(v,s-a+2);t.stroke()}}h++}if(n.plots_showYAxis||n.plots_showGrid){var w=1/n.scale;var h=0;t.textAlign="right";t.textBaseline="middle";for(var d=0;d<=10;d++){var E=w/10*d;var S=o+(s-a-o)*(1-E*n.scale);if(n.plots_showGrid){t.strokeStyle=n.plots_gridColor;t.lineWidth=n.plots_gridLineWidth;t.beginPath();t.moveTo(u,S);t.lineTo(r,S);t.stroke()}if(n.plots_showYAxis){t.strokeStyle="black";t.lineWidth=1;t.beginPath();t.moveTo(u,S);t.lineTo(u-3,S);t.stroke();var x=E*100;var T=i.max(0,3-i.floor(x).toString().length);var g=x.toFixed(T);if(T>0){while(g.charAt(g.length-1)==="0"){g=g.substring(0,g.length-1)}}if(g.charAt(g.length-1)==="."){g=g.substring(0,g.length-1)}t.fillText(g,u-3,S)}}}t.strokeStyle="black";t.lineWidth=1;t.beginPath();t.moveTo(r,s-a);t.lineTo(u,s-a);if(n.plots_showYAxis){t.lineTo(u,o)}t.stroke();if(this.dataDisplay.length>0){t.textAlign="left";t.textBaseline="top";var N=0;for(var d=0,C=this.dataDisplay.length;d<C;d++){if(this.dataDisplay[d].value){t.fillText([this.dataDisplay[d].display,": ",this.dataDisplay[d].value].join(""),u+10,o+10+N*(n.text_font_size+5));N++}else if(this.dataDisplay[d].tag){for(var k=0,L=this.metadata.length;k<L;k++){if(e.stringStartsWith(this.metadata[k],this.dataDisplay[d].tag)){var A=this.metadata[k];if(this.dataDisplay[d].display){var O=this.metadata[k].indexOf("=");A=[this.dataDisplay[d].display,": ",O>-1?this.metadata[k].substring(O+2):this.metadata[k]].join("")}t.fillText(A,u+10,o+10+N*(n.text_font_size+5));N++;break}}}}}this.drawPlot(t,n,r,s,o,u,a);this.memory.offsetTop=o;this.memory.offsetLeft=u;this.memory.offsetBottom=a;this.memory.flipXAxis=n.plots_flipXAxis;this.memory.scale=n.scale;this.memory.width=r;this.memory.height=s};s.drawPlot=function(e,n,r,s,o,u,a){if(this.specs){n=this.specs}e.strokeStyle=n.plots_color;e.lineWidth=n.plots_width;var f=[];e.beginPath();if(this.continuous){var l=false;var c=0;for(var h=0,p=this.data.length;h<p;h++){var d=this.getTransformedX(this.data[h].x,n,r,u);if(d>=u&&d<r){var v=this.getTransformedY(this.data[h].y,n,s,a,o);if(n.plots_showIntegration&&i.abs(this.data[h].y)>this.integrationSensitivity){f.push(new t.Point(this.data[h].x,this.data[h].y))}if(!l){e.moveTo(d,v);l=true}e.lineTo(d,v);c++;if(c%1e3===0){e.stroke();e.beginPath();e.moveTo(d,v)}}else if(l){break}}}else{for(var h=0,p=this.data.length;h<p;h++){var d=this.getTransformedX(this.data[h].x,n,r,u);if(d>=u&&d<r){e.moveTo(d,s-a);e.lineTo(d,this.getTransformedY(this.data[h].y,n,s,a,o))}}}e.stroke();if(n.plots_showIntegration&&f.length>1){e.strokeStyle=n.plots_integrationColor;e.lineWidth=n.plots_integrationLineWidth;e.beginPath();var g=f[1].x>f[0].x;var y;if(this.flipXAxis&&!g||!this.flipXAxis&&g){for(var h=f.length-2;h>=0;h--){f[h].y=f[h].y+f[h+1].y}y=f[0].y}else{for(var h=1,p=f.length;h<p;h++){f[h].y=f[h].y+f[h-1].y}y=f[f.length-1].y}for(var h=0,p=f.length;h<p;h++){var d=this.getTransformedX(f[h].x,n,r,u);var v=this.getTransformedY(f[h].y/n.scale/y,n,s,a,o);if(h===0){e.moveTo(d,v)}else{e.lineTo(d,v)}}e.stroke()}};s.getTransformedY=function(e,t,n,r,i){return i+(n-r-i)*(1-e*t.scale)};s.getInverseTransformedY=function(e){return(1-(e-this.memory.offsetTop)/(this.memory.height-this.memory.offsetBottom-this.memory.offsetTop))/this.memory.scale*100};s.getTransformedX=function(e,t,n,r){var i=r+(e-this.minX)/(this.maxX-this.minX)*(n-r);if(t.plots_flipXAxis){i=n+r-i}return i};s.getInverseTransformedX=function(e){if(this.memory.flipXAxis){e=this.memory.width+this.memory.offsetLeft-e}return(e-this.memory.offsetLeft)*(this.maxX-this.minX)/(this.memory.width-this.memory.offsetLeft)+this.minX};s.setup=function(){var e=Number.MAX_VALUE;var t=Number.MIN_VALUE;var n=Number.MIN_VALUE;for(var r=0,s=this.data.length;r<s;r++){e=i.min(e,this.data[r].x);t=i.max(t,this.data[r].x);n=i.max(n,this.data[r].y)}if(this.continuous){this.minX=e;this.maxX=t}else{this.minX=e-1;this.maxX=t+1}for(var r=0,s=this.data.length;r<s;r++){this.data[r].y/=n}};s.zoom=function(e,t,r,s){var o=this.getInverseTransformedX(e);var u=this.getInverseTransformedX(t);this.minX=i.min(o,u);this.maxX=i.max(o,u);if(s){var a=Number.MIN_VALUE;for(var f=0,l=this.data.length;f<l;f++){if(n.isBetween(this.data[f].x,this.minX,this.maxX)){a=i.max(a,this.data[f].y)}}return 1/a}};s.translate=function(e,t){var n=e/(t-this.memory.offsetLeft)*(this.maxX-this.minX)*(this.memory.flipXAxis?1:-1);this.minX+=n;this.maxX+=n};s.alertMetadata=function(){alert(this.metadata.join("\n"))};s.getInternalCoordinates=function(e,t){return new ChemDoodle.structures.Point(this.getInverseTransformedX(e),this.getInverseTransformedY(t))};s.getClosestPlotInternalCoordinates=function(e){var t=this.getInverseTransformedX(e-1);var r=this.getInverseTransformedX(e+1);if(t>r){var i=t;t=r;r=i}var s=-1;var o=-Infinity;var u=false;for(var a=0,f=this.data.length;a<f;a++){var l=this.data[a];if(n.isBetween(l.x,t,r)){if(l.y>o){u=true;o=l.y;s=a}}else if(u){break}}if(s===-1){return undefined}var l=this.data[s];return new ChemDoodle.structures.Point(l.x,l.y*100)};s.getClosestPeakInternalCoordinates=function(e){var t=this.getInverseTransformedX(e);var n=0;var r=Infinity;for(var s=0,o=this.data.length;s<o;s++){var u=i.abs(this.data[s].x-t);if(u<=r){r=u;n=s}else{break}}var a=highestRight=n;var f=maxRight=this.data[n].y;for(var s=n+1,o=this.data.length;s<o;s++){if(this.data[s].y+.05>maxRight){maxRight=this.data[s].y;highestRight=s}else{break}}for(var s=n-1;s>=0;s--){if(this.data[s].y+.05>f){f=this.data[s].y;a=s}else{break}}var l=this.data[a-n>highestRight-n?highestRight:a];return new ChemDoodle.structures.Point(l.x,l.y*100)}})(ChemDoodle.extensions,ChemDoodle.structures,ChemDoodle.math,jQuery,Math);(function(e,t,n){"use strict";t._Shape=function(){};var r=t._Shape.prototype;r.drawDecorations=function(e,t){if(this.isHover){var n=this.getPoints();for(var r=0,i=n.length;r<i;r++){var s=n[r];this.drawAnchor(e,t,s,s===this.hoverPoint)}}};r.getBounds=function(){var t=new e.Bounds;var n=this.getPoints();for(var r=0,i=n.length;r<i;r++){var s=n[r];t.expand(s.x,s.y)}return t};r.drawAnchor=function(e,t,r,i){e.save();e.translate(r.x,r.y);e.rotate(n.PI/4);e.scale(1/t.scale,1/t.scale);var s=4;var o=s/2;e.beginPath();e.moveTo(-s,-s);e.lineTo(s,-s);e.lineTo(s,s);e.lineTo(-s,s);e.closePath();if(i){e.fillStyle="#885110"}else{e.fillStyle="white"}e.fill();e.beginPath();e.moveTo(-s,-o);e.lineTo(-s,-s);e.lineTo(-o,-s);e.moveTo(o,-s);e.lineTo(s,-s);e.lineTo(s,-o);e.moveTo(s,o);e.lineTo(s,s);e.lineTo(o,s);e.moveTo(-o,s);e.lineTo(-s,s);e.lineTo(-s,o);e.moveTo(-s,-o);e.strokeStyle="rgba(0,0,0,.2)";e.lineWidth=5;e.stroke();e.strokeStyle="blue";e.lineWidth=1;e.stroke();e.restore()}})(ChemDoodle.math,ChemDoodle.structures.d2,Math);(function(e,t,n,r,i){"use strict";r.Bracket=function(e,t){this.p1=e?e:new n.Point;this.p2=t?t:new n.Point};var s=r.Bracket.prototype=new r._Shape;s.charge=0;s.mult=0;s.repeat=0;s.draw=function(t,n){var r=i.min(this.p1.x,this.p2.x);var s=i.max(this.p1.x,this.p2.x);var o=i.min(this.p1.y,this.p2.y);var u=i.max(this.p1.y,this.p2.y);var a=s-r;var f=u-o;var l=f/10;t.beginPath();t.moveTo(r+l,o);t.lineTo(r,o);t.lineTo(r,u);t.lineTo(r+l,u);t.moveTo(s-l,u);t.lineTo(s,u);t.lineTo(s,o);t.lineTo(s-l,o);if(this.isLassoed){var c=t.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y);c.addColorStop(0,"rgba(212, 99, 0, 0)");c.addColorStop(.5,"rgba(212, 99, 0, 0.8)");c.addColorStop(1,"rgba(212, 99, 0, 0)");t.lineWidth=n.shapes_lineWidth_2D+5;t.strokeStyle=c;t.lineJoin="miter";t.lineCap="square";t.stroke()}t.strokeStyle=n.shapes_color;t.lineWidth=n.shapes_lineWidth_2D;t.lineJoin="miter";t.lineCap="butt";t.stroke();if(this.charge!==0){t.fillStyle=n.text_color;t.textAlign="left";t.textBaseline="alphabetic";t.font=e.getFontString(n.text_font_size,n.text_font_families);var h=this.charge.toFixed(0);if(h==="1"){h="+"}else if(h==="-1"){h="–"}else if(e.stringStartsWith(h,"-")){h=h.substring(1)+"–"}else{h+="+"}t.fillText(h,s+5,o+5)}if(this.mult!==0){t.fillStyle=n.text_color;t.textAlign="right";t.textBaseline="middle";t.font=e.getFontString(n.text_font_size,n.text_font_families);t.fillText(this.mult.toFixed(0),r-5,o+f/2)}if(this.repeat!==0){t.fillStyle=n.text_color;t.textAlign="left";t.textBaseline="top";t.font=e.getFontString(n.text_font_size,n.text_font_families);var h=this.repeat.toFixed(0);t.fillText(h,s+5,u-5)}};s.getPoints=function(){return[this.p1,this.p2]};s.isOver=function(e,n){return t.isBetween(e.x,this.p1.x,this.p2.x)&&t.isBetween(e.y,this.p1.y,this.p2.y)}})(ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(e,t,n,r){"use strict";n.Line=function(e,n){this.p1=e?e:new t.Point;this.p2=n?n:new t.Point};n.Line.ARROW_SYNTHETIC="synthetic";n.Line.ARROW_RETROSYNTHETIC="retrosynthetic";n.Line.ARROW_RESONANCE="resonance";n.Line.ARROW_EQUILIBRIUM="equilibrium";var i=n.Line.prototype=new n._Shape;i.arrowType=undefined;i.topText=undefined;i.bottomText=undefined;i.draw=function(e,t){if(this.isLassoed){var i=e.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y);i.addColorStop(0,"rgba(212, 99, 0, 0)");i.addColorStop(.5,"rgba(212, 99, 0, 0.8)");i.addColorStop(1,"rgba(212, 99, 0, 0)");var s=2.5;var o=this.p1.angle(this.p2)+r.PI/2;var u=r.cos(o);var a=r.sin(o);var f=this.p1.x-u*s;var l=this.p1.y+a*s;var c=this.p1.x+u*s;var h=this.p1.y-a*s;var p=this.p2.x+u*s;var d=this.p2.y-a*s;var v=this.p2.x-u*s;var g=this.p2.y+a*s;e.fillStyle=i;e.beginPath();e.moveTo(f,l);e.lineTo(c,h);e.lineTo(p,d);e.lineTo(v,g);e.closePath();e.fill()}e.strokeStyle=t.shapes_color;e.fillStyle=t.shapes_color;e.lineWidth=t.shapes_lineWidth_2D;e.lineJoin="miter";e.lineCap="butt";if(this.p1.x!==this.p2.x||this.p1.y!==this.p2.y){if(this.arrowType===n.Line.ARROW_RETROSYNTHETIC){var y=r.sqrt(2)*2;var s=t.shapes_arrowLength_2D/y;var b=this.p1.angle(this.p2);var o=b+r.PI/2;var w=t.shapes_arrowLength_2D/y;var E=r.cos(b);var S=r.sin(b);var u=r.cos(o);var a=r.sin(o);var f=this.p1.x-u*s;var l=this.p1.y+a*s;var c=this.p1.x+u*s;var h=this.p1.y-a*s;var p=this.p2.x+u*s-E*w;var d=this.p2.y-a*s+S*w;var v=this.p2.x-u*s-E*w;var g=this.p2.y+a*s+S*w;var x=this.p2.x+u*s*2-E*w*2;var T=this.p2.y-a*s*2+S*w*2;var N=this.p2.x-u*s*2-E*w*2;var C=this.p2.y+a*s*2+S*w*2;e.beginPath();e.moveTo(c,h);e.lineTo(p,d);e.moveTo(x,T);e.lineTo(this.p2.x,this.p2.y);e.lineTo(N,C);e.moveTo(v,g);e.lineTo(f,l);e.stroke()}else if(this.arrowType===n.Line.ARROW_EQUILIBRIUM){var y=r.sqrt(2)*2;var s=t.shapes_arrowLength_2D/y/2;var b=this.p1.angle(this.p2);var o=b+r.PI/2;var w=t.shapes_arrowLength_2D*2/r.sqrt(3);var E=r.cos(b);var S=r.sin(b);var u=r.cos(o);var a=r.sin(o);var f=this.p1.x-u*s;var l=this.p1.y+a*s;var c=this.p1.x+u*s;var h=this.p1.y-a*s;var p=this.p2.x+u*s;var d=this.p2.y-a*s;var v=this.p2.x-u*s;var g=this.p2.y+a*s;e.beginPath();e.moveTo(c,h);e.lineTo(p,d);e.moveTo(v,g);e.lineTo(f,l);e.stroke();var k=p-E*w*.8;var L=d+S*w*.8;var x=p+u*t.shapes_arrowLength_2D/3-E*w;var T=d-a*t.shapes_arrowLength_2D/3+S*w;e.beginPath();e.moveTo(p,d);e.lineTo(x,T);e.lineTo(k,L);e.closePath();e.fill();e.stroke();k=f+E*w*.8;L=l-S*w*.8;x=f-u*t.shapes_arrowLength_2D/3+E*w;T=l+a*t.shapes_arrowLength_2D/3-S*w;e.beginPath();e.moveTo(f,l);e.lineTo(x,T);e.lineTo(k,L);e.closePath();e.fill();e.stroke()}else if(this.arrowType===n.Line.ARROW_SYNTHETIC){var b=this.p1.angle(this.p2);var o=b+r.PI/2;var w=t.shapes_arrowLength_2D*2/r.sqrt(3);var E=r.cos(b);var S=r.sin(b);var u=r.cos(o);var a=r.sin(o);e.beginPath();e.moveTo(this.p1.x,this.p1.y);e.lineTo(this.p2.x-E*w/2,this.p2.y+S*w/2);e.stroke();var k=this.p2.x-E*w*.8;var L=this.p2.y+S*w*.8;var x=this.p2.x+u*t.shapes_arrowLength_2D/3-E*w;var T=this.p2.y-a*t.shapes_arrowLength_2D/3+S*w;var N=this.p2.x-u*t.shapes_arrowLength_2D/3-E*w;var C=this.p2.y+a*t.shapes_arrowLength_2D/3+S*w;e.beginPath();e.moveTo(this.p2.x,this.p2.y);e.lineTo(N,C);e.lineTo(k,L);e.lineTo(x,T);e.closePath();e.fill();e.stroke()}else if(this.arrowType===n.Line.ARROW_RESONANCE){var b=this.p1.angle(this.p2);var o=b+r.PI/2;var w=t.shapes_arrowLength_2D*2/r.sqrt(3);var E=r.cos(b);var S=r.sin(b);var u=r.cos(o);var a=r.sin(o);e.beginPath();e.moveTo(this.p1.x+E*w/2,this.p1.y-S*w/2);e.lineTo(this.p2.x-E*w/2,this.p2.y+S*w/2);e.stroke();var k=this.p2.x-E*w*.8;var L=this.p2.y+S*w*.8;var x=this.p2.x+u*t.shapes_arrowLength_2D/3-E*w;var T=this.p2.y-a*t.shapes_arrowLength_2D/3+S*w;var N=this.p2.x-u*t.shapes_arrowLength_2D/3-E*w;var C=this.p2.y+a*t.shapes_arrowLength_2D/3+S*w;e.beginPath();e.moveTo(this.p2.x,this.p2.y);e.lineTo(N,C);e.lineTo(k,L);e.lineTo(x,T);e.closePath();e.fill();e.stroke();k=this.p1.x+E*w*.8;L=this.p1.y-S*w*.8;x=this.p1.x-u*t.shapes_arrowLength_2D/3+E*w;T=this.p1.y+a*t.shapes_arrowLength_2D/3-S*w;N=this.p1.x+u*t.shapes_arrowLength_2D/3+E*w;C=this.p1.y-a*t.shapes_arrowLength_2D/3-S*w;e.beginPath();e.moveTo(this.p1.x,this.p1.y);e.lineTo(N,C);e.lineTo(k,L);e.lineTo(x,T);e.closePath();e.fill();e.stroke()}else{e.beginPath();e.moveTo(this.p1.x,this.p1.y);e.lineTo(this.p2.x,this.p2.y);e.stroke()}if(this.topText){e.textAlign="center";e.textBaseline="bottom";e.fillText(this.topText,(this.p1.x+this.p2.x)/2,this.p1.y-5)}if(this.bottomText){e.textAlign="center";e.textBaseline="top";e.fillText(this.bottomText,(this.p1.x+this.p2.x)/2,this.p1.y+5)}}};i.getPoints=function(){return[this.p1,this.p2]};i.isOver=function(t,n){var r=e.distanceFromPointToLineInclusive(t,this.p1,this.p2);return r!==-1&&r<n}})(ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(e,t,n,r,i){"use strict";var s=function(e){var t=[];if(e instanceof n.Atom){if(e.bondNumber===0){t.push(i.PI)}else if(e.angles){if(e.angles.length===1){t.push(e.angles[0]+i.PI)}else{for(var r=1,s=e.angles.length;r<s;r++){t.push(e.angles[r-1]+(e.angles[r]-e.angles[r-1])/2)}var o=e.angles[0]+i.PI*2;var u=e.angles[e.angles.length-1];t.push(u+(o-u)/2)}if(e.largestAngle>i.PI){t=[e.angleOfLeastInterference]}if(e.bonds){for(var r=0,s=e.bonds.length;r<s;r++){var a=e.bonds[r];if(a.bondOrder===2){var f=a.getNeighbor(e);if(f.label==="O"){t=[f.angle(e)];break}}}}}}else{var l=e.a1.angle(e.a2);t.push(l+i.PI/2);t.push(l+3*i.PI/2)}for(var r=0,s=t.length;r<s;r++){while(t[r]>i.PI*2){t[r]-=i.PI*2}while(t[r]<0){t[r]+=i.PI*2}}return t};var o=function(e,t){var r=3;if(e instanceof n.Atom){if(e.isLabelVisible(t)){r=8}if(e.charge!==0||e.numRadical!==0||e.numLonePair!==0){r=13}}else if(e instanceof n.Point){r=0}else{if(e.bondOrder>1){r=5}}return r};var u=function(e,t,r,s,u,a,f,l,c,h){var p=a.angle(u);var d=f.angle(l);var v=p+i.PI/2;var g=i.cos(p);var y=i.sin(p);var b=o(r,t);u.x-=g*b;u.y+=y*b;var v=d+i.PI/2;var w=t.shapes_arrowLength_2D*2/i.sqrt(3);var g=i.cos(d);var y=i.sin(d);var E=i.cos(v);var S=i.sin(v);l.x-=g*5;l.y+=y*5;var x=new n.Point(l.x,l.y);b=o(s,t)/3;x.x-=g*b;x.y+=y*b;l.x-=g*(w*.8+b);l.y+=y*(w*.8+b);var T=x.x-g*w*.8;var N=x.y+y*w*.8;var C=new n.Point(x.x+E*t.shapes_arrowLength_2D/3-g*w,x.y-S*t.shapes_arrowLength_2D/3+y*w);var k=new n.Point(x.x-E*t.shapes_arrowLength_2D/3-g*w,x.y+S*t.shapes_arrowLength_2D/3+y*w);var L=true,A=true;if(c===1){if(C.distance(a)>k.distance(a)){A=false}else{L=false}}e.beginPath();e.moveTo(x.x,x.y);if(A){e.lineTo(k.x,k.y)}e.lineTo(T,N);if(L){e.lineTo(C.x,C.y)}e.closePath();e.fill();e.stroke();e.beginPath();e.moveTo(u.x,u.y);e.bezierCurveTo(a.x,a.y,f.x,f.y,l.x,l.y);e.stroke();h.push([u,a,f,l])};r.Pusher=function(e,t,n){this.o1=e;this.o2=t;this.numElectron=n?n:1};var a=r.Pusher.prototype=new r._Shape;a.drawDecorations=function(e,t){if(this.isHover){var r=this.o1 instanceof n.Atom?new n.Point(this.o1.x,this.o1.y):this.o1.getCenter();var i=this.o2 instanceof n.Atom?new n.Point(this.o2.x,this.o2.y):this.o2.getCenter();var s=[r,i];for(var o=0,u=s.length;o<u;o++){var a=s[o];this.drawAnchor(e,t,a,a===this.hoverPoint)}}};a.draw=function(t,r){if(this.o1&&this.o2){t.strokeStyle=r.shapes_color;t.fillStyle=r.shapes_color;t.lineWidth=r.shapes_lineWidth_2D;t.lineJoin="miter";t.lineCap="butt";var o=this.o1 instanceof n.Atom?new n.Point(this.o1.x,this.o1.y):this.o1.getCenter();var a=this.o2 instanceof n.Atom?new n.Point(this.o2.x,this.o2.y):this.o2.getCenter();var f=35;var l=s(this.o1);var c=s(this.o2);var h,p;var d=Infinity;for(var v=0,g=l.length;v<g;v++){for(var y=0,b=c.length;y<b;y++){var w=new n.Point(o.x+f*i.cos(l[v]),o.y-f*i.sin(l[v]));var E=new n.Point(a.x+f*i.cos(c[y]),a.y-f*i.sin(c[y]));var S=w.distance(E);if(S<d){d=S;h=w;p=E}}}this.caches=[];if(this.numElectron===-1){var x=o.distance(a)/2;var T=o.angle(a);var N=T+i.PI/2;var C=i.cos(T);var k=i.sin(T);var L=new n.Point(o.x+(x-1)*C,o.y-(x-1)*k);var A=new n.Point(L.x+i.cos(N+i.PI/6)*f,L.y-i.sin(N+i.PI/6)*f);var O=new n.Point(o.x+(x+1)*C,o.y-(x+1)*k);var M=new n.Point(O.x+i.cos(N-i.PI/6)*f,O.y-i.sin(N-i.PI/6)*f);u(t,r,this.o1,L,o,h,A,L,1,this.caches);u(t,r,this.o2,O,a,p,M,O,1,this.caches)}else{if(e.intersectLines(o.x,o.y,h.x,h.y,a.x,a.y,p.x,p.y)){var _=h;h=p;p=_}var D=h.angle(o);var P=p.angle(a);var H=i.max(D,P)-i.min(D,P);if(i.abs(H-i.PI)<.001&&this.o1.molCenter===this.o2.molCenter){D+=i.PI/2;P-=i.PI/2;h.x=o.x+f*i.cos(D+i.PI);h.y=o.y-f*i.sin(D+i.PI);p.x=a.x+f*i.cos(P+i.PI);p.y=a.y-f*i.sin(P+i.PI)}u(t,r,this.o1,this.o2,o,h,p,a,this.numElectron,this.caches)}}};a.getPoints=function(){return[]};a.isOver=function(e,n){for(var r=0,i=this.caches.length;r<i;r++){var s=t.distanceFromCurve(e,this.caches[r]);if(s.distance<n){return true}}return false}})(ChemDoodle.math,ChemDoodle.math.jsBezier,ChemDoodle.structures,ChemDoodle.structures.d2,Math);(function(e,t){"use strict";e._Mesh=function(){};var n=e._Mesh.prototype;n.storeData=function(e,t,n){this.positionData=e;this.normalData=t;this.indexData=n};n.setupBuffers=function(e){this.vertexPositionBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positionData),e.STATIC_DRAW);this.vertexPositionBuffer.itemSize=3;this.vertexPositionBuffer.numItems=this.positionData.length/3;this.vertexNormalBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.vertexNormalBuffer);e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.normalData),e.STATIC_DRAW);this.vertexNormalBuffer.itemSize=3;this.vertexNormalBuffer.numItems=this.normalData.length/3;if(this.indexData){this.vertexIndexBuffer=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexData),e.STATIC_DRAW);this.vertexIndexBuffer.itemSize=1;this.vertexIndexBuffer.numItems=this.indexData.length}if(this.partitions){for(var t=0,n=this.partitions.length;t<n;t++){var r=this.partitions[t];var i=this.generateBuffers(e,r.positionData,r.normalData,r.indexData);r.vertexPositionBuffer=i[0];r.vertexNormalBuffer=i[1];r.vertexIndexBuffer=i[2]}}};n.generateBuffers=function(e,t,n,r){var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW);i.itemSize=3;i.numItems=t.length/3;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s);e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW);s.itemSize=3;s.numItems=n.length/3;var o;if(r){o=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),e.STATIC_DRAW);o.itemSize=1;o.numItems=r.length}return[i,s,o]};n.bindBuffers=function(e){if(!this.vertexPositionBuffer){this.setupBuffers(e)}e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);e.vertexAttribPointer(e.shader.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexNormalBuffer);e.vertexAttribPointer(e.shader.vertexNormalAttribute,this.vertexNormalBuffer.itemSize,e.FLOAT,false,0,0);if(this.vertexIndexBuffer){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}})(ChemDoodle.structures.d3,Math);(function(e,t){"use strict";e.Arrow=function(e,n){var r=[];var i=[];for(var s=0;s<=n;s++){var o=s*2*t.PI/n;var u=t.sin(o);var a=t.cos(o);var f=a;var l=u;var c=0;i.push(0,0,-1,0,0,-1,f,l,0,f,l,0,0,0,-1,0,0,-1,f,l,1,f,l,1);r.push(0,0,0,e*f,e*l,0,e*f,e*l,0,e*f,e*l,2,e*f,e*l,2,e*f*2,e*l*2,2,e*f*2,e*l*2,2,0,0,3)}var h=[];for(var p=0;p<n;p++){var d=p*8;for(var v=0,g=7;v<g;v++){var y=v+d;var b=y+1;var w=y+g+2;var E=w-1;h.push(y,w,b,w,y,E)}}this.storeData(r,i,h)};var n=e.Arrow.prototype=new e._Mesh;n.getLength=function(){return 3}})(ChemDoodle.structures.d3,Math);(function(e,t,n){"use strict";e.Compass=function(r,i){this.textImage=new e.TextImage;this.textImage.init(r);this.textImage.updateFont(r,i.text_font_size,i.text_font_families,i.text_font_bold,i.text_font_italic,i.text_font_stroke_3D);this.textMesh=new e.TextMesh;this.textMesh.init(r);var s=i.compass_size_3D/r.canvas.clientHeight;var o=r.arrowBuffer.getLength()/s;var u=t.tan(i.projectionPerspectiveVerticalFieldOfView_3D/360*t.PI);var a=o/u;var f=t.max(a-o,.1);var l=a+o;var c=r.canvas.clientWidth/r.canvas.clientHeight;var h=-(r.canvas.clientWidth-i.compass_size_3D)/2+this.textImage.charHeight;var p=-(r.canvas.clientHeight-i.compass_size_3D)/2+this.textImage.charHeight;var d,v;if(i.projectionPerspective_3D){v=f;d=n.frustum}else{v=a;d=n.ortho}var g=v/r.canvas.clientHeight*2*u;var y=h*g;var b=p*g;var w=u*v;var E=-w;var S=c*E;var x=c*w;this.projectionMatrix=d(S-y,x-y,E-b,w-b,f,l);this.translationMatrix=n.translate(n.identity([]),[0,0,-a]);var T={position:[],texCoord:[],translation:[],zDepth:[]};this.textImage.pushVertexData("X",[3.5,0,0],0,T);this.textImage.pushVertexData("Y",[0,3.5,0],0,T);this.textImage.pushVertexData("Z",[0,0,3.5],0,T);this.textMesh.storeData(r,T.position,T.texCoord,T.translation,T.zDepth)};var r=e.Compass.prototype;r.renderArrow=function(e,t,n){e.material.setDiffuseColor(t);e.setMatrixUniforms(n);e.drawElements(e.TRIANGLES,e.arrowBuffer.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)};r.render=function(e,r){e.arrowBuffer.bindBuffers(e);e.material.setTempColors(r.bonds_materialAmbientColor_3D,undefined,r.bonds_materialSpecularColor_3D,r.bonds_materialShininess_3D);var i=n.multiply(this.translationMatrix,e.rotationMatrix,[]);var s=t.PI/2;e.fogging.setMode(0);this.renderArrow(e,r.compass_axisXColor_3D,n.rotateY(i,s,[]));this.renderArrow(e,r.compass_axisYColor_3D,n.rotateX(i,-s,[]));this.renderArrow(e,r.compass_axisZColor_3D,i)};r.renderText=function(e){var t=n.multiply(this.translationMatrix,e.rotationMatrix,[]);e.shaderText.setUniforms(e,t,this.projectionMatrix);this.textImage.useTexture(e);this.textMesh.render(e)}})(ChemDoodle.structures.d3,Math,mat4);(function(e,t){"use strict";e.Cylinder=function(e,n,r){var i=[];var s=[];for(var o=0;o<r;o++){var u=o*2*t.PI/r;var a=t.cos(u);var f=t.sin(u);s.push(a,0,f);i.push(e*a,0,e*f);s.push(a,0,f);i.push(e*a,n,e*f)}s.push(1,0,0);i.push(e,0,0);s.push(1,0,0);i.push(e,n,0);this.storeData(i,s)};e.Cylinder.prototype=new e._Mesh})(ChemDoodle.structures.d3,Math);(function(e,t,n){"use strict";t.Fog=function(e){this.gl=e;var t="u_fog.";this.mUL=e.getUniformLocation(e.program,t+"mode");this.cUL=e.getUniformLocation(e.program,t+"color");this.sUL=e.getUniformLocation(e.program,t+"start");this.eUL=e.getUniformLocation(e.program,t+"end");this.dUL=e.getUniformLocation(e.program,t+"density")};var r=t.Fog.prototype;r.setTempParameter=function(t,n,r,i){if(!this.cCache||this.cCache!==t){this.cCache=t;var s=e.getRGB(t,1);this.gl.uniform3f(this.cUL,s[0],s[1],s[2])}if(!this.sCache||this.sCache!==n){this.sCache=n;this.gl.uniform1f(this.sUL,n)}if(!this.eCache||this.eCache!==r){this.eCache=r;this.gl.uniform1f(this.eUL,r)}if(!this.dCache||this.dCache!==i){this.dCache=i;this.gl.uniform1f(this.dUL,i)}};r.setMode=function(e){if(!this.mCache||this.mCache!==e){this.mCache=e;this.gl.uniform1i(this.mUL,e)}}})(ChemDoodle.math,ChemDoodle.structures.d3,vec3);(function(e,t){t.Label=function(){this.textImage=new t.TextImage};var n=t.Label.prototype;n.init=function(e,t){this.textImage.init(e);this.textImage.updateFont(e,t.atoms_font_size_2D,t.atoms_font_families_2D,t.atoms_font_bold_2D,t.atoms_font_italic_2D,t.text_font_stroke_3D)};n.updateVerticesBuffer=function(t,n,r){for(var i=0,s=n.length;i<s;i++){var o=n[i];var u=o.labelMesh;var a=o.atoms;var f=this.textImage;var l={position:[],texCoord:[],translation:[],zDepth:[]};var c=a.length>0&&a[0].hetatm!=undefined;for(var h=0,p=a.length;h<p;h++){var d=a[h];var v=d.label;var m=.05;if(r.atoms_useVDWDiameters_3D){var g=e[v].vdWRadius*r.atoms_vdwMultiplier_3D;if(g===0){g=1}m+=g}else if(r.atoms_sphereDiameter_3D){m+=r.atoms_sphereDiameter_3D/2*1.5}if(c){if(!d.hetatm){if(!r.macro_displayAtoms){continue}}else if(d.isWater){if(!r.macro_showWaters){continue}}}f.pushVertexData(v,[d.x,d.y,d.z],m,l)}var y=o.chains;if(y&&(r.proteins_displayRibbon||r.proteins_displayBackbone)){for(var h=0,p=y.length;h<p;h++){var b=y[h];for(var w=0,E=b.length;w<E;w++){var S=b[w];if(S.name){var d=S.cp1;f.pushVertexData(S.name,[d.x,d.y,d.z],2,l)}}}}u.storeData(t,l.position,l.texCoord,l.translation,l.zDepth)}};n.render=function(e,t,n){e.shaderText.setUniforms(e,e.modelViewMatrix,e.projectionMatrix);this.textImage.useTexture(e);for(var r=0,i=n.length;r<i;r++){if(n[r].labelMesh){n[r].labelMesh.render(e)}}}})(ChemDoodle.ELEMENT,ChemDoodle.structures.d3);(function(e,t){"use strict";e.Sphere=function(e,n,r){var i=[];var s=[];for(var o=0;o<=n;o++){var u=o*t.PI/n;var a=t.sin(u);var f=t.cos(u);for(var l=0;l<=r;l++){var c=l*2*t.PI/r;var h=t.sin(c);var p=t.cos(c);var d=p*a;var v=f;var g=h*a;s.push(d,v,g);i.push(e*d,e*v,e*g)}}var y=[];r+=1;for(var o=0;o<n;o++){for(var l=0;l<r;l++){var b=o*r+l%r;var w=b+r;y.push(b,b+1,w);if(l<r-1){y.push(w,b+1,w+1)}}}this.storeData(i,s,y)};e.Sphere.prototype=new e._Mesh})(ChemDoodle.structures.d3,Math);(function(e,t,n,r){"use strict";function s(e,t,n,r){this.entire=e;this.name=t;this.indexes=n;this.pi=r}var i=function(e,t){e.bindBuffer(e.ARRAY_BUFFER,t.vertexPositionBuffer);e.vertexAttribPointer(e.shader.vertexPositionAttribute,t.vertexPositionBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,t.vertexNormalBuffer);e.vertexAttribPointer(e.shader.vertexNormalAttribute,t.vertexNormalBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.vertexIndexBuffer)};var o=s.prototype;o.getColor=function(t){if(t.macro_colorByChain){return this.chainColor}else if(this.name){return this.getResidueColor(e[this.name]?this.name:"*",t)}else if(this.helix){return this.entire.front?t.proteins_ribbonCartoonHelixPrimaryColor:t.proteins_ribbonCartoonHelixSecondaryColor}else if(this.sheet){return t.proteins_ribbonCartoonSheetColor}else{return this.entire.front?t.proteins_primaryColor:t.proteins_secondaryColor}};o.getResidueColor=function(t,n){var r=e[t];if(n.proteins_useShapelyColors){return r.shapelyColor}else if(n.proteins_useAminoColors){return r.aminoColor}else if(n.proteins_usePolarityColors){if(r.polar){return"#C10000"}else{return"#FFFFFF"}}return"#FFFFFF"};o.render=function(e,t){if(this.entire.partitions&&this.pi!==this.entire.partitions.lastRender){i(e,this.entire.partitions[this.pi]);this.entire.partitions.lastRender=this.pi}if(!this.vertexIndexBuffer){this.vertexIndexBuffer=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexes),e.STATIC_DRAW);this.vertexIndexBuffer.itemSize=1;this.vertexIndexBuffer.numItems=this.indexes.length}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);e.material.setDiffuseColor(this.getColor(t));e.drawElements(e.TRIANGLES,this.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)};t.Ribbon=function(e,t,i){var o=e[0].lineSegments.length;var u=e[0].lineSegments[0].length;this.partitions=[];this.partitions.lastRender=0;var a;this.front=t>0;for(var f=0,l=e.length-1;f<l;f++){if(!a||a.positionData.length>65e3){if(this.partitions.length>0){f--}a={count:0,positionData:[],normalData:[],indexData:[]};this.partitions.push(a)}var c=e[f];a.count++;for(var h=0;h<o;h++){var p=i?c.lineSegmentsCartoon[h]:c.lineSegments[h];var d=h===0;var v=false;for(var g=0;g<u;g++){var y=p[g];var b=f;var w=g+1;if(f===e.length-2&&g===u-1){w--}else if(g===u-1){b++;w=0}var E=i?e[b].lineSegmentsCartoon[h][w]:e[b].lineSegments[h][w];var S=false;var x=h+1;if(h===o-1){x-=2;S=true}var T=i?c.lineSegmentsCartoon[x][g]:c.lineSegments[x][g];var N=[E.x-y.x,E.y-y.y,E.z-y.z];var C=[T.x-y.x,T.y-y.y,T.z-y.z];var k=r.cross(N,C,[]);if(g===0){r.normalize(N);r.scale(N,-1);a.normalData.push(N[0],N[1],N[2]);a.positionData.push(y.x,y.y,y.z)}if(d||v){r.normalize(C);r.scale(C,-1);a.normalData.push(C[0],C[1],C[2]);a.positionData.push(y.x,y.y,y.z);if(d&&g===u-1){d=false;g=-1}}else{r.normalize(k);if(S&&!this.front||!S&&this.front){r.scale(k,-1)}a.normalData.push(k[0],k[1],k[2]);r.scale(k,n.abs(t));a.positionData.push(y.x+k[0],y.y+k[1],y.z+k[2]);if(h===o-1&&g===u-1){v=true;g=-1}}if(g===-1||g===u-1){r.normalize(N);a.normalData.push(N[0],N[1],N[2]);a.positionData.push(y.x,y.y,y.z)}}}}o+=2;u+=2;if(i){this.cartoonSegments=[]}this.segments=[];for(var L=0,A=this.partitions.length;L<A;L++){var a=this.partitions[L];var O;if(i){O=[]}for(var f=0,l=a.count-1;f<l;f++){var M=f;for(var h=0;h<L;h++){M+=this.partitions[h].count-1}var _=e[M];if(f>0&&i&&_.split){var D=new s(this,undefined,O,L);if(_.helix){D.helix=true}if(_.sheet){D.sheet=true}this.cartoonSegments.push(D);O=[]}var P=f*o*u;var H=[];for(var h=0,B=o-1;h<B;h++){var j=P+h*u;for(var g=0;g<u;g++){var F=1;if(f===a.count-1){F=0}else if(g===u-1){F=o*u-g}var I=[j+g,j+u+g,j+u+g+F,j+g,j+g+F,j+u+g+F];if(g!==u-1){if(this.front){H.push(I[0],I[1],I[2],I[3],I[5],I[4])}else{H.push(I[0],I[2],I[1],I[3],I[4],I[5])}}if(g===u-2&&f<a.count-1){var q=o*u-g;I[2]+=q;I[4]+=q;I[5]+=q}if(this.front){a.indexData.push(I[0],I[1],I[2],I[3],I[5],I[4])}else{a.indexData.push(I[0],I[2],I[1],I[3],I[4],I[5])}if(i){if(this.front){O.push(I[0],I[1],I[2],I[3],I[5],I[4])}else{O.push(I[0],I[2],I[1],I[3],I[4],I[5])}}}}var R=e[M+1].name;this.segments.push(new s(this,R,H,L))}if(i){var D=new s(this,undefined,O,L);var M=a.count-1;for(var h=0;h<L;h++){M+=this.partitions[h].count-1}var _=e[M];if(_.helix){D.helix=true}if(_.sheet){D.sheet=true}this.cartoonSegments.push(D)}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData);if(this.partitions.length===1){this.partitions=undefined}};var u=t.Ribbon.prototype=new t._Mesh;u.render=function(e,t){this.bindBuffers(e);var n=t.macro_colorByChain?this.chainColor:undefined;if(!n){n=this.front?t.proteins_primaryColor:t.proteins_secondaryColor}e.material.setDiffuseColor(n);e.drawElements(e.TRIANGLES,this.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0);if(this.partitions){for(var r=1,s=this.partitions.length;r<s;r++){var o=this.partitions[r];i(e,o);e.drawElements(e.TRIANGLES,o.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}}}})(ChemDoodle.RESIDUE,ChemDoodle.structures.d3,Math,vec3);(function(e,t,n){"use strict";t.Light=function(t,n,r){this.diffuseRGB=e.getRGB(t,1);this.specularRGB=e.getRGB(n,1);this.direction=r};var r=t.Light.prototype;r.lightScene=function(e){var t="u_light.";e.uniform3f(e.getUniformLocation(e.program,t+"diffuse_color"),this.diffuseRGB[0],this.diffuseRGB[1],this.diffuseRGB[2]);e.uniform3f(e.getUniformLocation(e.program,t+"specular_color"),this.specularRGB[0],this.specularRGB[1],this.specularRGB[2]);var r=n.create(this.direction);n.normalize(r);n.negate(r);e.uniform3f(e.getUniformLocation(e.program,t+"direction"),r[0],r[1],r[2]);var i=[0,0,0];var s=[i[0]+r[0],i[1]+r[1],i[2]+r[2]];var o=n.length(s);if(o===0)s=[0,0,1];else{n.scale(1/o)}e.uniform3f(e.getUniformLocation(e.program,t+"half_vector"),s[0],s[1],s[2])}})(ChemDoodle.math,ChemDoodle.structures.d3,vec3);(function(e){"use strict";e.Line=function(){this.storeData([0,0,0,0,1,0],[0,0,0,0,0,0])};e.Line.prototype=new e._Mesh})(ChemDoodle.structures.d3);(function(e,t){"use strict";t.Material=function(e){this.gl=e;var t="u_material.";this.aUL=e.getUniformLocation(e.program,t+"ambient_color");this.dUL=e.getUniformLocation(e.program,t+"diffuse_color");this.sUL=e.getUniformLocation(e.program,t+"specular_color");this.snUL=e.getUniformLocation(e.program,t+"shininess");this.alUL=e.getUniformLocation(e.program,t+"alpha")};var n=t.Material.prototype;n.setTempColors=function(t,n,r,i){if(!this.aCache||this.aCache!==t){this.aCache=t;var s=e.getRGB(t,1);this.gl.uniform3f(this.aUL,s[0],s[1],s[2])}if(n&&(!this.dCache||this.dCache!==n)){this.dCache=n;var s=e.getRGB(n,1);this.gl.uniform3f(this.dUL,s[0],s[1],s[2])}if(!this.sCache||this.sCache!==r){this.sCache=r;var s=e.getRGB(r,1);this.gl.uniform3f(this.sUL,s[0],s[1],s[2])}if(!this.snCache||this.snCache!==i){this.snCache=i;this.gl.uniform1f(this.snUL,i)}this.alCache=1;this.gl.uniform1f(this.alUL,1)};n.setDiffuseColor=function(t){if(!this.dCache||this.dCache!==t){this.dCache=t;var n=e.getRGB(t,1);this.gl.uniform3f(this.dUL,n[0],n[1],n[2])}};n.setAlpha=function(e){if(!this.alCache||this.alCache!==e){this.alCache=e;this.gl.uniform1f(this.alUL,e)}}})(ChemDoodle.math,ChemDoodle.structures.d3);(function(e,t,n,r){"use strict";t.MolecularSurface=function(t,i,s,o,u){function j(e,t,n,r){var i=e.index;if(e.contained){i=-1;var s=Infinity;for(var o=0,u=t.length;o<u;o++){var a=t[o];for(var f=0,l=a.length;f<l;f++){var c=a[f];if(!c.contained&&c.index!==n&&c.index!==r){var h=c.distance3D(e);if(h<s){i=c.index;s=h}}}}}return i}var a=[];var f=[];var l=[];var c=[];for(var h=0;h<=i;h++){var p=h*r.PI/i;var d=r.sin(p);var v=r.cos(p);for(var g=0;g<=s;g++){var y=g*2*r.PI/s;c.push(r.cos(y)*d,v,r.sin(y)*d)}}var b=[];for(var w=0,E=t.atoms.length;w<E;w++){var S=[];var x=t.atoms[w];var T=n[x.label][u]+o;var N=[];for(var C=0,k=t.atoms.length;C<k;C++){if(C!==w){var L=t.atoms[C];L.index=C;if(x.distance3D(L)<T+n[L.label][u]+o){N.push(L)}}}for(var C=0,k=c.length;C<k;C+=3){var A=new e.Atom("C",x.x+T*c[C],x.y+T*c[C+1],x.z+T*c[C+2]);for(var O=0,M=N.length;O<M;O++){var L=N[O];if(A.distance3D(L)<n[L.label][u]+o){A.contained=true;break}}S.push(A)}b.push(S)}var _=[];s++;for(var h=0;h<i;h++){for(var g=0;g<s;g++){var D=h*s+g%s;var P=D+s;_.push(D);_.push(P);_.push(D+1);if(g<s-1){_.push(P);_.push(P+1);_.push(D+1)}}}var H=0;for(var w=0,E=b.length;w<E;w++){var S=b[w];for(var C=0,k=S.length;C<k;C++){var A=S[C];if(!A.contained){A.index=H;H++;a.push(A.x,A.y,A.z);f.push(c[C*3],c[C*3+1],c[C*3+2])}}for(var C=0,k=_.length;C<k;C+=3){var D=S[_[C]];var P=S[_[C+1]];var B=S[_[C+2]];if(!D.contained&&!P.contained&&!B.contained){l.push(D.index,P.index,B.index)}}}var F=[];for(var w=0,E=b.length;w<E;w++){var S=b[w];for(var C=0,k=_.length;C<k;C+=3){var D=S[_[C]];var P=S[_[C+1]];var B=S[_[C+2]];var N=[];for(var O=0,M=b.length;O<M;O++){if(O!==w){N.push(b[O])}}if(!(D.contained&&P.contained&&B.contained)&&(D.contained||P.contained||B.contained)){var I=j(D,N,-1,-1);var q=j(P,N,I,-1);var R=j(B,N,I,q);if(I!==-1&&q!==-1&&R!==-1){var U=false;for(var O=0,M=F.length;O<M;O+=3){var z=F[O];var W=F[O+1];var X=F[O+2];var V=I===z||I===W||I===X;var $=q===z||q===W||q===X;var J=R===z||R===W||R===X;if(V&&$&&J){U=true;break}}if(!U){F.push(I,q,R)}}}}}l=l.concat(F);this.storeData(a,f,l)};t.MolecularSurface.prototype=new t._Mesh})(ChemDoodle.structures,ChemDoodle.structures.d3,ChemDoodle.ELEMENT,Math);(function(e,t){"use strict";e.Picker=function(){};var n=e.Picker.prototype;n.init=function(e){this.framebuffer=e.createFramebuffer();var t=e.createTexture();var n=e.createRenderbuffer();e.bindTexture(e.TEXTURE_2D,t);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindRenderbuffer(e.RENDERBUFFER,n);e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,n);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)};n.setDimension=function(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);var r=e.getFramebufferAttachmentParameter(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);if(e.isRenderbuffer(r)){e.bindRenderbuffer(e.RENDERBUFFER,r);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,n);e.bindRenderbuffer(e.RENDERBUFFER,null)}var i=e.getFramebufferAttachmentParameter(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);if(e.isTexture(i)){e.bindTexture(e.TEXTURE_2D,i);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null);e.bindTexture(e.TEXTURE_2D,null)}e.bindFramebuffer(e.FRAMEBUFFER,null)};n.pick=function(e,t,n,r,i){var s=undefined;var o=e.getParameter(e.COLOR_CLEAR_VALUE);e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);e.clearColor(1,1,1,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.fogging.setMode(0);e.disableVertexAttribArray(e.shader.vertexNormalAttribute);var u=[];e.material.setAlpha(255);for(var a=0,f=t.length;a<f;a++){t[a].renderPickFrame(e,n,u)}e.flush();var l=new Uint8Array(4);e.readPixels(r-2,i+2,1,1,e.RGBA,e.UNSIGNED_BYTE,l);var c=l[3];if(c>0){var h=l[2]|l[1]<<8|l[0]<<16;s=u[h]}u=undefined;e.enableVertexAttribArray(e.shader.vertexNormalAttribute);e.fogging.setMode(n.fog_mode_3D);e.bindFramebuffer(e.FRAMEBUFFER,null);e.clearColor(o[0],o[1],o[2],o[3]);return s}})(ChemDoodle.structures.d3,document);(function(e,t){"use strict";e.Pill=function(e,n,r,i){var s=1;var o=2*e;n-=o;if(n<0){s=0;n+=o}else if(n<o){s=n/o;n=o}var u=[];var a=[];for(var f=0;f<=r;f++){var l=f*t.PI/r;var c=t.sin(l);var h=t.cos(l)*s;for(var p=0;p<=i;p++){var d=p*2*t.PI/i;var v=t.sin(d);var g=t.cos(d);var y=g*c;var b=h;var w=v*c;a.push(y,b,w);u.push(e*y,e*b+(f<r/2?n:0),e*w)}}var E=[];i+=1;for(var f=0;f<r;f++){for(var p=0;p<i;p++){var S=f*i+p%i;var x=S+i;E.push(S,S+1,x);if(p<i-1){E.push(x,S+1,x+1)}}}this.storeData(u,a,E)};e.Pill.prototype=new e._Mesh})(ChemDoodle.structures.d3,Math);(function(e,t){"use strict";e.Shader=function(){};var n=e.Shader.prototype;n.init=function(e){var t=this.getShader(e,"vertex-shader");if(!t){t=this.loadDefaultVertexShader(e)}var n=this.getShader(e,"fragment-shader");if(!n){n=this.loadDefaultFragmentShader(e)}e.attachShader(e.program,t);e.attachShader(e.program,n);this.vertexPositionAttribute=0;e.bindAttribLocation(e.program,this.vertexPositionAttribute,"a_vertex_position");e.linkProgram(e.program);if(!e.getProgramParameter(e.program,e.LINK_STATUS)){alert("Could not initialize shaders: "+e.getProgramInfoLog(e.program))}e.useProgram(e.program);e.enableVertexAttribArray(this.vertexPositionAttribute);this.vertexNormalAttribute=e.getAttribLocation(e.program,"a_vertex_normal");e.enableVertexAttribArray(this.vertexNormalAttribute)};n.getShader=function(e,n){var r=t.getElementById(n);if(!r){return undefined}var i=[];var s=r.firstChild;while(s){if(s.nodeType===3){i.push(s.textContent)}s=s.nextSibling}var o;if(r.type==="x-shader/x-fragment"){o=e.createShader(e.FRAGMENT_SHADER)}else if(r.type==="x-shader/x-vertex"){o=e.createShader(e.VERTEX_SHADER)}else{return undefined}e.shaderSource(o,i.join(""));e.compileShader(o);if(!e.getShaderParameter(o,e.COMPILE_STATUS)){alert(r.type+" "+e.getShaderInfoLog(o));return undefined}return o};n.loadDefaultVertexShader=function(e){var t=["precision mediump float;","struct Light","{","vec3 diffuse_color;","vec3 specular_color;","vec3 direction;","vec3 half_vector;","};","struct Material","{","vec3 ambient_color;","vec3 diffuse_color;","vec3 specular_color;","float shininess;","float alpha;","};","attribute vec3 a_vertex_position;","attribute vec3 a_vertex_normal;","uniform Light u_light;","uniform Material u_material;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","uniform mat3 u_normal_matrix;","varying vec3 v_diffuse;","varying vec4 v_ambient;","varying vec3 v_normal;","void main(void)","{","v_normal = length(a_vertex_normal)==0.0 ? a_vertex_normal : normalize(u_normal_matrix * a_vertex_normal);","v_ambient = vec4(u_material.ambient_color, 1.0);","v_diffuse = u_material.diffuse_color * u_light.diffuse_color;","gl_Position = u_projection_matrix * u_model_view_matrix * vec4(a_vertex_position, 1.0);","gl_Position /= gl_Position.w;","gl_PointSize = 2.0;","}"].join("");var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t);e.compileShader(n);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){alert("Vertex shader failed to compile: "+e.getShaderInfoLog(n));return undefined}return n};n.loadDefaultFragmentShader=function(e){var t=["precision mediump float;\n","struct Light","{","vec3 diffuse_color;","vec3 specular_color;","vec3 direction;","vec3 half_vector;","};","struct Material","{","vec3 ambient_color;","vec3 diffuse_color;","vec3 specular_color;","float shininess;","float alpha;","};","struct Fog","{","int mode;","vec3 color;","float density;","float start;","float end;","};","uniform Light u_light;","uniform Material u_material;","uniform Fog u_fog;","varying vec3 v_diffuse;","varying vec4 v_ambient;","varying vec3 v_normal;","void main(void)","{","if(length(v_normal)==0.0){","gl_FragColor = vec4(vec3(v_diffuse.rgb),u_material.alpha);","}else{","float nDotL = max(dot(v_normal, u_light.direction), 0.0);","vec4 color = vec4(v_diffuse*nDotL, 1.0);","float nDotHV = max(dot(v_normal, u_light.half_vector), 0.0);","vec3 specular = u_material.specular_color * u_light.specular_color;","color+=vec4(specular * pow(nDotHV, u_material.shininess), 1.0);","gl_FragColor = color+v_ambient;","gl_FragColor.a*=u_material.alpha;","float fogCoord = gl_FragCoord.z/gl_FragCoord.w;","float fogFactor = 1.;","if(u_fog.mode == 1){","if(fogCoord < u_fog.start){","fogFactor = 1.;","}else if(fogCoord > u_fog.end){","fogFactor = 0.;","}else{","fogFactor = clamp((u_fog.end - fogCoord) / (u_fog.end - u_fog.start), 0.0, 1.0);","}","}","else if(u_fog.mode == 2) {","fogFactor = clamp(exp(-u_fog.density*fogCoord), 0.0, 1.0);","}","else if(u_fog.mode == 3) {","fogFactor = clamp(exp(-pow(u_fog.density*fogCoord, 2.0)), 0.0, 1.0);","}","gl_FragColor = mix(vec4(vec3(u_fog.color), 1.), gl_FragColor, fogFactor);","}","}"].join("");var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t);e.compileShader(n);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){alert("Fragment shader failed to compile: "+e.getShaderInfoLog(n));return undefined}return n}})(ChemDoodle.structures.d3,document);(function(e,t,n){"use strict";t.Shape=function(t,r){var i=t.length;var s=[];var o=[];var u=new e.Point;for(var a=0,f=i;a<f;a++){var l=a+1;if(a===f-1){l=0}var c=[0,0,1];var h=t[a];var p=t[l];var d=[p.x-h.x,p.y-h.y,0];var v=n.cross(c,d);for(var m=0;m<2;m++){s.push(h.x,h.y,r/2);s.push(h.x,h.y,-r/2);s.push(p.x,p.y,r/2);s.push(p.x,p.y,-r/2)}for(var m=0;m<4;m++){o.push(v[0],v[1],v[2])}o.push(0,0,1);o.push(0,0,-1);o.push(0,0,1);o.push(0,0,-1);u.add(h)}u.x/=i;u.y/=i;o.push(0,0,1);s.push(u.x,u.y,r/2);o.push(0,0,-1);s.push(u.x,u.y,-r/2);var g=[];var y=i*8;for(var a=0,f=i;a<f;a++){var b=a*8;g.push(b);g.push(b+3);g.push(b+1);g.push(b);g.push(b+2);g.push(b+3);g.push(b+4);g.push(y);g.push(b+6);g.push(b+5);g.push(b+7);g.push(y+1)}this.storeData(s,o,g)};t.Shape.prototype=new t._Mesh})(ChemDoodle.structures,ChemDoodle.structures.d3,vec3);(function(e,t,n){"use strict";e.Star=function(){var e=[.8944,.4472,0,.2764,.4472,.8506,.2764,.4472,-.8506,-.7236,.4472,.5257,-.7236,.4472,-.5257,-.3416,.4472,0,-.1056,.4472,.3249,-.1056,.4472,-.3249,.2764,.4472,.2008,.2764,.4472,-.2008,-.8944,-.4472,0,-.2764,-.4472,.8506,-.2764,-.4472,-.8506,.7236,-.4472,.5257,.7236,-.4472,-.5257,.3416,-.4472,0,.1056,-.4472,.3249,.1056,-.4472,-.3249,-.2764,-.4472,.2008,-.2764,-.4472,-.2008,-.5527,.1058,0,-.1708,.1058,.5527,-.1708,.1058,-.5527,.4471,.1058,.3249,.4471,.1058,-.3249,.5527,-.1058,0,.1708,-.1058,.5527,.1708,-.1058,-.5527,-.4471,-.1058,.3249,-.4471,-.1058,-.3249,0,1,0,0,-1,0];var t=[0,9,8,2,7,9,4,5,7,3,6,5,1,8,6,0,8,23,30,6,8,3,21,6,11,26,21,13,23,26,2,9,24,30,8,9,1,23,8,13,25,23,14,24,25,4,7,22,30,9,7,0,24,9,14,27,24,12,22,27,3,5,20,30,7,5,2,22,7,12,29,22,10,20,29,1,6,21,30,5,6,4,20,5,10,28,20,11,21,28,10,19,18,12,17,19,14,15,17,13,16,15,11,18,16,31,19,17,14,17,27,2,27,22,4,22,29,10,29,19,31,18,19,12,19,29,4,29,20,3,20,28,11,28,18,31,16,18,10,18,28,3,28,21,1,21,26,13,26,16,31,15,16,11,16,26,1,26,23,0,23,25,14,25,15,31,17,15,13,15,25,0,25,24,2,24,27,12,27,17];var r=[];var i=[];var s=[];for(var o=0,u=t.length;o<u;o+=3){var a=t[o]*3;var f=t[o+1]*3;var l=t[o+2]*3;var c=[e[a],e[a+1],e[a+2]];var h=[e[f],e[f+1],e[f+2]];var p=[e[l],e[l+1],e[l+2]];var d=[c[0]-h[0],c[1]-h[1],c[2]-h[2]];var v=[p[0]-h[0],p[1]-h[1],p[2]-h[2]];var m=n.cross(v,d,[]);n.normalize(m);r.push(c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]);i.push(m[0],m[1],m[2],m[0],m[1],m[2],m[0],m[1],m[2]);s.push(o,o+1,o+2)}this.storeData(r,i,s)};e.Star.prototype=new e._Mesh})(ChemDoodle.structures.d3,Math,vec3);(function(e,t,n){"use strict";e.TextImage=function(){this.ctx=n.createElement("canvas").getContext("2d");this.data=[];this.text="";this.charHeight=0};var r=e.TextImage.prototype;r.init=function(e){this.textureImage=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.textureImage);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,false);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.bindTexture(e.TEXTURE_2D,null);this.updateFont(e,12,["Sans-serif"],false,false,false)};r.charData=function(e){var t=this.text.indexOf(e);return t>=0?this.data[t]:null};r.updateFont=function(e,n,r,i,s,o){var u=this.ctx;var a=this.ctx.canvas;var f=[];var l="";var c=t.getFontString(n,r,i,s);u.font=c;u.save();var h=0;var p=n*1.5;for(var d=32,v=127;d<v;d++){var m=String.fromCharCode(d),g=u.measureText(m).width;f.push({text:m,width:g,height:p});h+=g*2}var y=h*p;var b=Math.sqrt(y);var w=Math.ceil(b/p);var E=Math.ceil(h/(w-1));a.width=E;a.height=w*p;u.font=c;u.textAlign="left";u.textBaseline="middle";u.strokeStyle="#000";u.lineWidth=1.4;u.fillStyle="#fff";var S=0;var x=0;for(var d=0,v=f.length;d<v;d++){var T=f[d];var N=T.width*2;var p=T.height;var C=T.text;var k=x+N;if(k>E){S++;x=0}var L=S*p;if(o){u.strokeText(C,x,L+p/2)}u.fillText(C,x,L+p/2);T.x=x;T.y=L;l+=C;x+=N}this.text=l;this.data=f;this.charHeight=p;e.bindTexture(e.TEXTURE_2D,this.textureImage);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a);e.bindTexture(e.TEXTURE_2D,null)};r.pushVertexData=function(e,t,n,r){var i=e.toString().split("");var s=this.getHeight();var o=this.getWidth();var u=-this.textWidth(e)/2;var a=-this.charHeight/2;for(var f=0,l=i.length;f<l;f++){var c=this.charData(i[f]);var h=c.width;var p=c.x/o;var d=p+c.width*1.8/o;var v=c.y/s;var m=v+c.height/s;var g=u+h*1.8;var y=this.charHeight/2;r.position.push(t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2]);r.texCoord.push(p,v,d,m,d,v,p,v,p,m,d,m);r.translation.push(u,y,g,a,g,y,u,y,u,a,g,a);r.zDepth.push(n,n,n,n,n,n);u=g+h-h*1.8}};r.getCanvas=function(){return this.ctx.canvas};r.getHeight=function(){return this.getCanvas().height};r.getWidth=function(){return this.getCanvas().width};r.textWidth=function(e){return this.ctx.measureText(e).width};r.test=function(){n.body.appendChild(this.getCanvas())};r.useTexture=function(e){e.bindTexture(e.TEXTURE_2D,this.textureImage)}})(ChemDoodle.structures.d3,ChemDoodle.extensions,document);(function(e,t){"use strict";e.TextMesh=function(){};var n=e.TextMesh.prototype;n.init=function(e){this.vertexPositionBuffer=e.createBuffer();this.vertexTexCoordBuffer=e.createBuffer();this.vertexTranslationBuffer=e.createBuffer();this.vertexZDepthBuffer=e.createBuffer()};n.setVertexData=function(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t);e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW);t.itemSize=r;t.numItems=n.length/r};n.storeData=function(e,t,n,r,i){this.setVertexData(e,this.vertexPositionBuffer,t,3);this.setVertexData(e,this.vertexTexCoordBuffer,n,2);this.setVertexData(e,this.vertexTranslationBuffer,r,2);this.setVertexData(e,this.vertexZDepthBuffer,i,1)};n.bindBuffers=function(e){var t=e.shaderText;e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer);e.vertexAttribPointer(t.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexTexCoordBuffer);e.vertexAttribPointer(t.vertexTexCoordAttribute,this.vertexTexCoordBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexTranslationBuffer);e.vertexAttribPointer(t.vertexTranslationAttribute,this.vertexTranslationBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexZDepthBuffer);e.vertexAttribPointer(t.vertexZDepthAttribute,this.vertexZDepthBuffer.itemSize,e.FLOAT,false,0,0)};n.render=function(e){var t=this.vertexPositionBuffer.numItems;if(!t){return}this.bindBuffers(e);e.drawArrays(e.TRIANGLES,0,t)}})(ChemDoodle.structures.d3,Math);(function(e){"use strict";e.TextShader=function(){};var t=e.TextShader.prototype=new e.Shader;t.init=function(e){e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);var t=this.loadDefaultVertexShader(e);var n=this.loadDefaultFragmentShader(e);e.attachShader(e.programLabel,t);e.attachShader(e.programLabel,n);e.linkProgram(e.programLabel);if(!e.getProgramParameter(e.programLabel,e.LINK_STATUS)){alert("Could not initialize shaders: "+e.getProgramInfoLog(e.programLabel))}this.vertexPositionAttribute=e.getAttribLocation(e.programLabel,"a_vertex_position");this.vertexTexCoordAttribute=e.getAttribLocation(e.programLabel,"a_vertex_texcoord");this.vertexTranslationAttribute=e.getAttribLocation(e.programLabel,"a_translation");this.vertexZDepthAttribute=e.getAttribLocation(e.programLabel,"a_z_depth");this.modelViewMatrixUniform=e.getUniformLocation(e.programLabel,"u_model_view_matrix");this.projectionMatrixUniform=e.getUniformLocation(e.programLabel,"u_projection_matrix");this.dimensionUniform=e.getUniformLocation(e.programLabel,"u_dimension")};t.loadDefaultVertexShader=function(e){var t=["precision mediump float;","attribute vec3 a_vertex_position;","attribute vec2 a_vertex_texcoord;","attribute vec2 a_translation;","attribute float a_z_depth;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","uniform vec2 u_dimension;","varying vec2 v_texcoord;","void main() {","gl_Position = u_model_view_matrix * vec4(a_vertex_position, 1.0);","vec4 depth_pos = vec4(gl_Position);","depth_pos.z += a_z_depth;","gl_Position = u_projection_matrix * gl_Position;","depth_pos = u_projection_matrix * depth_pos;","gl_Position /= gl_Position.w;","gl_Position.xy += a_translation / u_dimension * 2.0;","gl_Position.z = depth_pos.z / depth_pos.w;","v_texcoord = a_vertex_texcoord;","}"].join("");var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t);e.compileShader(n);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){alert("Vertex shader failed to compile: "+e.getShaderInfoLog(n));return undefined}return n};t.loadDefaultFragmentShader=function(e){var t=["precision mediump float;","uniform sampler2D u_image;","varying vec2 v_texcoord;","void main() {","gl_FragColor = texture2D(u_image, v_texcoord);","}"].join("");var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t);e.compileShader(n);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){alert("Fragment shader failed to compile: "+e.getShaderInfoLog(n));return undefined}return n};t.setUniforms=function(e,t,n){e.uniformMatrix4fv(this.modelViewMatrixUniform,false,t);e.uniformMatrix4fv(this.projectionMatrixUniform,false,n);e.uniform2f(this.dimensionUniform,e.canvas.clientWidth,e.canvas.clientHeight)}})(ChemDoodle.structures.d3);(function(e,t,n,r,i,s,o){"use strict";var u=function(e,t){e.bindBuffer(e.ARRAY_BUFFER,t.vertexPositionBuffer);e.vertexAttribPointer(e.shader.vertexPositionAttribute,t.vertexPositionBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,t.vertexNormalBuffer);e.vertexAttribPointer(e.shader.vertexNormalAttribute,t.vertexNormalBuffer.itemSize,e.FLOAT,false,0,0);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.vertexIndexBuffer)};var a=function(e,t,n){var r=i.sqrt(t[1]*t[1]+t[2]*t[2]);var o=[1,0,0,0,0,t[2]/r,-t[1]/r,0,0,t[1]/r,t[2]/r,0,0,0,0,1];var u=[1,0,0,0,0,t[2]/r,t[1]/r,0,0,-t[1]/r,t[2]/r,0,0,0,0,1];var a=[r,0,-t[0],0,0,1,0,0,t[0],0,r,0,0,0,0,1];var f=[r,0,t[0],0,0,1,0,0,-t[0],0,r,0,0,0,0,1];var l=[i.cos(n),-i.sin(n),0,0,i.sin(n),i.cos(n),0,0,0,0,1,0,0,0,0,1];var c=s.multiply(o,s.multiply(a,s.multiply(l,s.multiply(f,u,[]))));this.rotate=function(){return s.multiplyVec3(c,e)}};r.Tube=function(r,f,l){var c=r[0].lineSegments[0].length;this.partitions=[];var h;this.ends=[];this.ends.push(r[0].lineSegments[0][0]);this.ends.push(r[r.length-2].lineSegments[0][0]);var p=[1,0,0];for(var d=0,v=r.length-1;d<v;d++){if(!h||h.positionData.length>65e3){if(this.partitions.length>0){d--}h={count:0,positionData:[],normalData:[],indexData:[]};this.partitions.push(h)}var g=r[d];h.count++;var y=Infinity;var b=new n.Atom("",r[d+1].cp1.x,r[d+1].cp1.y,r[d+1].cp1.z);for(var w=0;w<c;w++){var E=g.lineSegments[0][w];var S;if(w===c-1){if(d===r.length-2){S=g.lineSegments[0][w-1]}else{S=r[d+1].lineSegments[0][0]}}else{S=g.lineSegments[0][w+1]}var x=[S.x-E.x,S.y-E.y,S.z-E.z];o.normalize(x);if(d===r.length-2&&w===c-1){o.scale(x,-1)}var T=vec3.cross(x,p,[]);o.normalize(T);o.scale(T,f/2);var N=new a(T,x,2*Math.PI/l);for(var C=0,k=l;C<k;C++){var L=N.rotate();if(C===i.floor(l/4)){p=[L[0],L[1],L[2]]}h.normalData.push(L[0],L[1],L[2]);h.positionData.push(E.x+L[0],E.y+L[1],E.z+L[2])}if(b){var A=E.distance3D(b);if(A<y){y=A;r[d+1].pPoint=E}}}}for(var O=0,M=this.partitions.length;O<M;O++){var h=this.partitions[O];for(var d=0,v=h.count-1;d<v;d++){var _=d*c*l;for(var w=0,D=c;w<D;w++){var P=_+w*l;for(var C=0;C<l;C++){var H=1;var B=P+C;h.indexData.push(B);h.indexData.push(B+l);h.indexData.push(B+l+H);h.indexData.push(B);h.indexData.push(B+l+H);h.indexData.push(B+H)}}}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData);var j=[new n.Point(2,0)];for(var d=0;d<60;d++){var F=d/60*i.PI;j.push(new n.Point(2*i.cos(F),-2*i.sin(F)))}j.push(new n.Point(-2,0),new n.Point(-2,4),new n.Point(2,4));var I=new n.d3.Shape(j,1);this.render=function(a,l){this.bindBuffers(a);a.material.setDiffuseColor(l.macro_colorByChain?this.chainColor:l.nucleics_tubeColor);a.drawElements(a.TRIANGLES,this.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0);if(this.partitions){for(var c=1,h=this.partitions.length;c<h;c++){var p=this.partitions[c];u(a,p);a.drawElements(a.TRIANGLES,p.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)}}a.sphereBuffer.bindBuffers(a);for(var c=0;c<2;c++){var p=this.ends[c];var d=s.translate(a.modelViewMatrix,[p.x,p.y,p.z],[]);var v=f/2;s.scale(d,[v,v,v]);a.setMatrixUniforms(d);a.drawElements(a.TRIANGLES,a.sphereBuffer.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)}a.cylinderBuffer.bindBuffers(a);for(var c=1,h=r.length-1;c<h;c++){var g=r[c];var y=g.pPoint;var b=new n.Atom("",g.cp2.x,g.cp2.y,g.cp2.z);var w=1.001*y.distance3D(b);var E=[f/4,w,f/4];var d=s.translate(a.modelViewMatrix,[y.x,y.y,y.z],[]);var S=[0,1,0];var x=0;var T;var N=[b.x-y.x,b.y-y.y,b.z-y.z];if(y.x===b.x&&y.z===b.z){T=[0,0,1];if(y.y<y.y){x=i.PI}}else{x=e.vec3AngleFrom(S,N);T=o.cross(S,N,[])}if(x!==0){s.rotate(d,x,T)}s.scale(d,E);a.setMatrixUniforms(d);a.drawArrays(a.TRIANGLE_STRIP,0,a.cylinderBuffer.vertexPositionBuffer.numItems)}I.bindBuffers(a);if(!l.nucleics_useShapelyColors&&!l.macro_colorByChain){a.material.setDiffuseColor(l.nucleics_baseColor)}for(var c=1,h=r.length-1;c<h;c++){var g=r[c];var b=g.cp2;var d=s.translate(a.modelViewMatrix,[b.x,b.y,b.z],[]);var S=[0,1,0];var x=0;var T;var C=g.cp3;var N=[C.x-b.x,C.y-b.y,C.z-b.z];if(b.x===C.x&&b.z===C.z){T=[0,0,1];if(b.y<b.y){x=i.PI}}else{x=e.vec3AngleFrom(S,N);T=o.cross(S,N,[])}if(x!==0){s.rotate(d,x,T)}var k=[1,0,0];var L=s.rotate(s.identity([]),x,T);s.multiplyVec3(L,k);var A=g.cp4;var O=g.cp5;if(!(A.y===O.y&&A.z===O.z)){var M=[O.x-A.x,O.y-A.y,O.z-A.z];var _=e.vec3AngleFrom(k,M);if(o.dot(N,o.cross(k,M))<0){_*=-1}s.rotateY(d,_)}if(l.nucleics_useShapelyColors&&!l.macro_colorByChain){if(t[g.name]){a.material.setDiffuseColor(t[g.name].shapelyColor)}else{a.material.setDiffuseColor(t["*"].shapelyColor)}}a.setMatrixUniforms(d);a.drawElements(a.TRIANGLES,I.vertexIndexBuffer.numItems,a.UNSIGNED_SHORT,0)}}};r.Tube.prototype=new r._Mesh})(ChemDoodle.extensions,ChemDoodle.RESIDUE,ChemDoodle.structures,ChemDoodle.structures.d3,Math,mat4,vec3);(function(e,t){"use strict";e.UnitCell=function(e){var t=[];var n=[];var r=function(e,r,i,s){t.push(e[0],e[1],e[2]);t.push(r[0],r[1],r[2]);t.push(i[0],i[1],i[2]);t.push(s[0],s[1],s[2]);for(var o=0;o<4;o++){n.push(0,0,0)}};r(e.o,e.x,e.xy,e.y);r(e.o,e.y,e.yz,e.z);r(e.o,e.z,e.xz,e.x);r(e.yz,e.y,e.xy,e.xyz);r(e.xyz,e.xz,e.z,e.yz);r(e.xy,e.x,e.xz,e.xyz);var i=[];for(var s=0;s<6;s++){var o=s*4;i.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o)}this.storeData(t,n,i)};e.UnitCell.prototype=new e._Mesh})(ChemDoodle.structures.d3,vec3);(function(e,t,n){"use strict";e.Plate=function(e){this.lanes=new Array(e);for(i=0,ii=e;i<ii;i++){this.lanes[i]=[]}};var r=e.Plate.prototype;r.sort=function(){for(i=0,ii=this.lanes.length;i<ii;i++){this.lanes[i].sort(function(e,t){return e-t})}};r.draw=function(e,r){var o=e.canvas.width;var u=e.canvas.height;this.origin=9*u/10;this.front=u/10;this.laneLength=this.origin-this.front;e.strokeStyle="#000000";e.beginPath();e.moveTo(0,this.front);t.contextHashTo(e,0,this.front,o,this.front,3,3);e.closePath();e.stroke();e.beginPath();e.moveTo(0,this.origin);e.lineTo(o,this.origin);e.closePath();e.stroke();for(i=0,ii=this.lanes.length;i<ii;i++){var a=(i+1)*o/(ii+1);e.beginPath();e.moveTo(a,this.origin);e.lineTo(a,this.origin+3);e.closePath();e.stroke();for(s=0,ss=this.lanes[i].length;s<ss;s++){var f=this.origin-this.laneLength*this.lanes[i][s].rf;switch(this.lanes[i][s].type){case"compact":e.beginPath();e.arc(a,f,3,0,2*n.PI,false);e.closePath();break;case"expanded":e.beginPath();e.arc(a,f,7,0,2*n.PI,false);e.closePath();break;case"trailing":break;case"widened":t.contextOval(e,a-18,f-10,36,10);break;case"cresent":e.beginPath();e.arc(a,f,9,0,n.PI,true);e.closePath();break}switch(this.lanes[i][s].style){case"solid":e.fillStyle="#000000";e.fill();break;case"transparent":e.stroke();break;case"gradient":break}}}};e.Plate.Spot=function(e,t,n){this.type=e;this.rf=t;this.style=n?n:"solid"}})(ChemDoodle.structures,ChemDoodle.extensions,Math);(function(e,t,n){"use strict";e.default_backgroundColor="#FFFFFF";e.default_scale=1;e.default_rotateAngle=0;e.default_bondLength_2D=20;e.default_angstromsPerBondLength=1.25;e.default_lightDirection_3D=[-.1,-.1,-1];e.default_lightDiffuseColor_3D="#FFFFFF";e.default_lightSpecularColor_3D="#FFFFFF";e.default_projectionPerspective_3D=true;e.default_projectionPerspectiveVerticalFieldOfView_3D=45;e.default_projectionOrthoWidth_3D=40;e.default_projectionWidthHeightRatio_3D=undefined;e.default_projectionFrontCulling_3D=.1;e.default_projectionBackCulling_3D=1e4;e.default_cullBackFace_3D=true;e.default_fog_mode_3D=0;e.default_fog_color_3D="#000000";e.default_fog_start_3D=0;e.default_fog_end_3D=1;e.default_fog_density_3D=1;e.default_atoms_display=true;e.default_atoms_color="#000000";e.default_atoms_font_size_2D=12;e.default_atoms_font_families_2D=["Helvetica","Arial","Dialog"];e.default_atoms_font_bold_2D=false;e.default_atoms_font_italic_2D=false;e.default_atoms_circles_2D=false;e.default_atoms_circleDiameter_2D=10;e.default_atoms_circleBorderWidth_2D=1;e.default_atoms_lonePairDistance_2D=8;e.default_atoms_lonePairSpread_2D=4;e.default_atoms_lonePairDiameter_2D=1;e.default_atoms_useJMOLColors=false;e.default_atoms_usePYMOLColors=false;e.default_atoms_resolution_3D=60;e.default_atoms_sphereDiameter_3D=.8;e.default_atoms_useVDWDiameters_3D=false;e.default_atoms_vdwMultiplier_3D=1;e.default_atoms_materialAmbientColor_3D="#000000";e.default_atoms_materialSpecularColor_3D="#555555";e.default_atoms_materialShininess_3D=32;e.default_atoms_implicitHydrogens_2D=true;e.default_atoms_displayTerminalCarbonLabels_2D=false;e.default_atoms_showHiddenCarbons_2D=true;e.default_atoms_showAttributedCarbons_2D=true;e.default_atoms_displayAllCarbonLabels_2D=false;e.default_atoms_nonBondedAsStars_3D=false;e.default_atoms_displayLabels_3D=false;e.default_bonds_display=true;e.default_bonds_color="#000000";e.default_bonds_width_2D=1;e.default_bonds_saturationWidth_2D=.2;e.default_bonds_ends_2D="round";e.default_bonds_useJMOLColors=false;e.default_bonds_usePYMOLColors=false;e.default_bonds_colorGradient=false;e.default_bonds_saturationAngle_2D=n.PI/3;e.default_bonds_symmetrical_2D=false;e.default_bonds_clearOverlaps_2D=false;e.default_bonds_overlapClearWidth_2D=.5;e.default_bonds_atomLabelBuffer_2D=1;e.default_bonds_wedgeThickness_2D=.22;e.default_bonds_hashWidth_2D=1;e.default_bonds_hashSpacing_2D=2.5;e.default_bonds_dotSize_2D=2;e.default_bonds_showBondOrders_3D=false;e.default_bonds_resolution_3D=60;e.default_bonds_renderAsLines_3D=false;e.default_bonds_cylinderDiameter_3D=.3;e.default_bonds_pillLatitudeResolution_3D=10;e.default_bonds_pillLongitudeResolution_3D=20;e.default_bonds_pillHeight_3D=.3;e.default_bonds_pillSpacing_3D=.1;e.default_bonds_pillDiameter_3D=.3;e.default_bonds_materialAmbientColor_3D="#222222";e.default_bonds_materialSpecularColor_3D="#555555";e.default_bonds_materialShininess_3D=32;e.default_proteins_displayRibbon=true;e.default_proteins_displayBackbone=false;e.default_proteins_backboneThickness=1.5;e.default_proteins_backboneColor="#CCCCCC";e.default_proteins_ribbonCartoonize=false;e.default_proteins_useShapelyColors=false;e.default_proteins_useAminoColors=false;e.default_proteins_usePolarityColors=false;e.default_proteins_primaryColor="#FF0D0D";e.default_proteins_secondaryColor="#FFFF30";e.default_proteins_ribbonCartoonHelixPrimaryColor="#00E740";e.default_proteins_ribbonCartoonHelixSecondaryColor="#9905FF";e.default_proteins_ribbonCartoonSheetColor="#E8BB99";e.default_proteins_ribbonThickness=.2;e.default_proteins_verticalResolution=10;e.default_proteins_horizontalResolution=9;e.default_proteins_materialAmbientColor_3D="#222222";e.default_proteins_materialSpecularColor_3D="#555555";e.default_proteins_materialShininess_3D=32;e.default_nucleics_display=true;e.default_nucleics_tubeColor="#CCCCCC";e.default_nucleics_baseColor="#C10000";e.default_nucleics_useShapelyColors=true;e.default_nucleics_tubeThickness=1.5;e.default_nucleics_tubeResolution_3D=60;e.default_nucleics_verticalResolution=10;e.default_nucleics_materialAmbientColor_3D="#222222";e.default_nucleics_materialSpecularColor_3D="#555555";e.default_nucleics_materialShininess_3D=32;e.default_macro_displayAtoms=false;e.default_macro_displayBonds=false;e.default_macro_atomToLigandDistance=-1;e.default_macro_showWater=false;e.default_macro_colorByChain=false;e.default_surfaces_display=true;e.default_surfaces_style="Dot";e.default_surfaces_color="#E9B862";e.default_surfaces_materialAmbientColor_3D="#000000";e.default_surfaces_materialSpecularColor_3D="#000000";e.default_surfaces_materialShininess_3D=32;e.default_crystals_displayUnitCell=true;e.default_crystals_unitCellColor="green";e.default_crystals_unitCellLineWidth=1;e.default_plots_color="#000000";e.default_plots_width=1;e.default_plots_showIntegration=false;e.default_plots_integrationColor="#c10000";e.default_plots_integrationLineWidth=1;e.default_plots_showGrid=false;e.default_plots_gridColor="gray";e.default_plots_gridLineWidth=.5;e.default_plots_showYAxis=true;e.default_plots_flipXAxis=false;e.default_text_font_size=12;e.default_text_font_families=["Helvetica","Arial","Dialog"];e.default_text_font_bold=true;e.default_text_font_italic=false;e.default_text_font_stroke_3D=true;e.default_text_color="#000000";e.default_shapes_color="#000000";e.default_shapes_lineWidth_2D=1;e.default_shapes_arrowLength_2D=8;e.default_compass_display=false;e.default_compass_axisXColor_3D="#FF0000";e.default_compass_axisYColor_3D="#00FF00";e.default_compass_axisZColor_3D="#0000FF";e.default_compass_size_3D=50;e.default_compass_resolution_3D=10;e.default_compass_displayText_3D=true;t.VisualSpecifications=function(){this.backgroundColor=e.default_backgroundColor;this.scale=e.default_scale;this.rotateAngle=e.default_rotateAngle;this.bondLength=e.default_bondLength_2D;this.angstromsPerBondLength=e.default_angstromsPerBondLength;this.lightDirection_3D=e.default_lightDirection_3D;this.lightDiffuseColor_3D=e.default_lightDiffuseColor_3D;this.lightSpecularColor_3D=e.default_lightSpecularColor_3D;this.projectionPerspective_3D=e.default_projectionPerspective_3D;this.projectionPerspectiveVerticalFieldOfView_3D=e.default_projectionPerspectiveVerticalFieldOfView_3D;this.projectionOrthoWidth_3D=e.default_projectionOrthoWidth_3D;this.projectionWidthHeightRatio_3D=e.default_projectionWidthHeightRatio_3D;this.projectionFrontCulling_3D=e.default_projectionFrontCulling_3D;this.projectionBackCulling_3D=e.default_projectionBackCulling_3D;this.cullBackFace_3D=e.default_cullBackFace_3D;this.fog_mode_3D=e.default_fog_mode_3D;this.fog_color_3D=e.default_fog_color_3D;this.fog_start_3D=e.default_fog_start_3D;this.fog_end_3D=e.default_fog_end_3D;this.fog_density_3D=e.default_fog_density_3D;this.atoms_display=e.default_atoms_display;this.atoms_color=e.default_atoms_color;this.atoms_font_size_2D=e.default_atoms_font_size_2D;this.atoms_font_families_2D=[];for(var t=0,n=e.default_atoms_font_families_2D.length;t<n;t++){this.atoms_font_families_2D[t]=e.default_atoms_font_families_2D[t]}this.atoms_font_bold_2D=e.default_atoms_font_bold_2D;this.atoms_font_italic_2D=e.default_atoms_font_italic_2D;this.atoms_circles_2D=e.default_atoms_circles_2D;this.atoms_circleDiameter_2D=e.default_atoms_circleDiameter_2D;this.atoms_circleBorderWidth_2D=e.default_atoms_circleBorderWidth_2D;this.atoms_lonePairDistance_2D=e.default_atoms_lonePairDistance_2D;this.atoms_lonePairSpread_2D=e.default_atoms_lonePairSpread_2D;this.atoms_lonePairDiameter_2D=e.default_atoms_lonePairDiameter_2D;this.atoms_useJMOLColors=e.default_atoms_useJMOLColors;this.atoms_usePYMOLColors=e.default_atoms_usePYMOLColors;this.atoms_resolution_3D=e.default_atoms_resolution_3D;this.atoms_sphereDiameter_3D=e.default_atoms_sphereDiameter_3D;this.atoms_useVDWDiameters_3D=e.default_atoms_useVDWDiameters_3D;this.atoms_vdwMultiplier_3D=e.default_atoms_vdwMultiplier_3D;this.atoms_materialAmbientColor_3D=e.default_atoms_materialAmbientColor_3D;this.atoms_materialSpecularColor_3D=e.default_atoms_materialSpecularColor_3D;this.atoms_materialShininess_3D=e.default_atoms_materialShininess_3D;this.atoms_implicitHydrogens_2D=e.default_atoms_implicitHydrogens_2D;this.atoms_displayTerminalCarbonLabels_2D=e.default_atoms_displayTerminalCarbonLabels_2D;this.atoms_showHiddenCarbons_2D=e.default_atoms_showHiddenCarbons_2D;this.atoms_showAttributedCarbons_2D=e.default_atoms_showAttributedCarbons_2D;this.atoms_displayAllCarbonLabels_2D=e.default_atoms_displayAllCarbonLabels_2D;this.atoms_nonBondedAsStars_3D=e.default_atoms_nonBondedAsStars_3D;this.atoms_displayLabels_3D=e.default_atoms_displayLabels_3D;this.bonds_display=e.default_bonds_display;this.bonds_color=e.default_bonds_color;this.bonds_width_2D=e.default_bonds_width_2D;this.bonds_saturationWidth_2D=e.default_bonds_saturationWidth_2D;this.bonds_ends_2D=e.default_bonds_ends_2D;this.bonds_useJMOLColors=e.default_bonds_useJMOLColors;this.bonds_usePYMOLColors=e.default_bonds_usePYMOLColors;this.bonds_colorGradient=e.default_bonds_colorGradient;this.bonds_saturationAngle_2D=e.default_bonds_saturationAngle_2D;this.bonds_symmetrical_2D=e.default_bonds_symmetrical_2D;this.bonds_clearOverlaps_2D=e.default_bonds_clearOverlaps_2D;this.bonds_overlapClearWidth_2D=e.default_bonds_overlapClearWidth_2D;this.bonds_atomLabelBuffer_2D=e.default_bonds_atomLabelBuffer_2D;this.bonds_wedgeThickness_2D=e.default_bonds_wedgeThickness_2D;this.bonds_hashWidth_2D=e.default_bonds_hashWidth_2D;this.bonds_hashSpacing_2D=e.default_bonds_hashSpacing_2D;this.bonds_dotSize_2D=e.default_bonds_dotSize_2D;this.bonds_showBondOrders_3D=e.default_bonds_showBondOrders_3D;this.bonds_resolution_3D=e.default_bonds_resolution_3D;this.bonds_renderAsLines_3D=e.default_bonds_renderAsLines_3D;this.bonds_cylinderDiameter_3D=e.default_bonds_cylinderDiameter_3D;this.bonds_pillHeight_3D=e.default_bonds_pillHeight_3D;this.bonds_pillLatitudeResolution_3D=e.default_bonds_pillLatitudeResolution_3D;this.bonds_pillLongitudeResolution_3D=e.default_bonds_pillLongitudeResolution_3D;this.bonds_pillSpacing_3D=e.default_bonds_pillSpacing_3D;this.bonds_pillDiameter_3D=e.default_bonds_pillDiameter_3D;this.bonds_materialAmbientColor_3D=e.default_bonds_materialAmbientColor_3D;this.bonds_materialSpecularColor_3D=e.default_bonds_materialSpecularColor_3D;this.bonds_materialShininess_3D=e.default_bonds_materialShininess_3D;this.proteins_displayRibbon=e.default_proteins_displayRibbon;this.proteins_displayBackbone=e.default_proteins_displayBackbone;this.proteins_backboneThickness=e.default_proteins_backboneThickness;this.proteins_backboneColor=e.default_proteins_backboneColor;this.proteins_ribbonCartoonize=e.default_proteins_ribbonCartoonize;this.proteins_useShapelyColors=e.default_proteins_useShapelyColors;this.proteins_useAminoColors=e.default_proteins_useAminoColors;this.proteins_usePolarityColors=e.default_proteins_usePolarityColors;this.proteins_primaryColor=e.default_proteins_primaryColor;this.proteins_secondaryColor=e.default_proteins_secondaryColor;this.proteins_ribbonCartoonHelixPrimaryColor=e.default_proteins_ribbonCartoonHelixPrimaryColor;this.proteins_ribbonCartoonHelixSecondaryColor=e.default_proteins_ribbonCartoonHelixSecondaryColor;this.proteins_ribbonCartoonSheetColor=e.default_proteins_ribbonCartoonSheetColor;this.proteins_ribbonThickness=e.default_proteins_ribbonThickness;this.proteins_verticalResolution=e.default_proteins_verticalResolution;this.proteins_horizontalResolution=e.default_proteins_horizontalResolution;this.proteins_materialAmbientColor_3D=e.default_proteins_materialAmbientColor_3D;this.proteins_materialSpecularColor_3D=e.default_proteins_materialSpecularColor_3D;this.proteins_materialShininess_3D=e.default_proteins_materialShininess_3D;this.macro_displayAtoms=e.default_macro_displayAtoms;this.macro_displayBonds=e.default_macro_displayBonds;this.macro_atomToLigandDistance=e.default_macro_atomToLigandDistance;this.nucleics_display=e.default_nucleics_display;this.nucleics_tubeColor=e.default_nucleics_tubeColor;this.nucleics_baseColor=e.default_nucleics_baseColor;this.nucleics_useShapelyColors=e.default_nucleics_useShapelyColors;this.nucleics_tubeThickness=e.default_nucleics_tubeThickness;this.nucleics_tubeResolution_3D=e.default_nucleics_tubeResolution_3D;this.nucleics_verticalResolution=e.default_nucleics_verticalResolution;this.nucleics_materialAmbientColor_3D=e.default_nucleics_materialAmbientColor_3D;this.nucleics_materialSpecularColor_3D=e.default_nucleics_materialSpecularColor_3D;this.nucleics_materialShininess_3D=e.default_nucleics_materialShininess_3D;this.macro_showWater=e.default_macro_showWater;this.macro_colorByChain=e.default_macro_colorByChain;this.surfaces_display=e.default_surfaces_display;this.surfaces_style=e.default_surfaces_style;this.surfaces_color=e.default_surfaces_color;this.surfaces_materialAmbientColor_3D=e.default_surfaces_materialAmbientColor_3D;this.surfaces_materialSpecularColor_3D=e.default_surfaces_materialSpecularColor_3D;this.surfaces_materialShininess_3D=e.default_surfaces_materialShininess_3D;this.crystals_displayUnitCell=e.default_crystals_displayUnitCell;this.crystals_unitCellColor=e.default_crystals_unitCellColor;this.crystals_unitCellLineWidth=e.default_crystals_unitCellLineWidth;this.plots_color=e.default_plots_color;this.plots_width=e.default_plots_width;this.plots_showIntegration=e.default_plots_showIntegration;this.plots_integrationColor=e.default_plots_integrationColor;this.plots_integrationLineWidth=e.default_plots_integrationLineWidth;this.plots_showGrid=e.default_plots_showGrid;this.plots_gridColor=e.default_plots_gridColor;this.plots_gridLineWidth=e.default_plots_gridLineWidth;this.plots_showYAxis=e.default_plots_showYAxis;this.plots_flipXAxis=e.default_plots_flipXAxis;this.text_font_size=e.default_text_font_size;this.text_font_families=[];for(var t=0,n=e.default_text_font_families.length;t<n;t++){this.text_font_families[t]=e.default_text_font_families[t]}this.text_font_bold=e.default_text_font_bold;this.text_font_italic=e.default_text_font_italic;this.text_font_stroke_3D=e.default_text_font_stroke_3D;this.text_color=e.default_text_color;this.shapes_color=e.default_shapes_color;this.shapes_lineWidth_2D=e.default_shapes_lineWidth_2D;this.shapes_arrowLength_2D=e.default_shapes_arrowLength_2D;this.compass_display=e.default_compass_display;this.compass_axisXColor_3D=e.default_compass_axisXColor_3D;this.compass_axisYColor_3D=e.default_compass_axisYColor_3D;this.compass_axisZColor_3D=e.default_compass_axisZColor_3D;this.compass_size_3D=e.default_compass_size_3D;this.compass_resolution_3D=e.default_compass_resolution_3D;this.compass_displayText_3D=e.default_compass_displayText_3D};var r=t.VisualSpecifications.prototype;r.set3DRepresentation=function(t){this.atoms_display=true;this.bonds_display=true;this.bonds_color="#777777";this.atoms_useVDWDiameters_3D=true;this.atoms_useJMOLColors=true;this.bonds_useJMOLColors=true;this.bonds_showBondOrders_3D=true;this.bonds_renderAsLines_3D=false;if(t==="Ball and Stick"){this.atoms_vdwMultiplier_3D=.3;this.bonds_useJMOLColors=false;this.bonds_cylinderDiameter_3D=.3;this.bonds_materialAmbientColor_3D=e.default_atoms_materialAmbientColor_3D;this.bonds_pillDiameter_3D=.15}else if(t==="van der Waals Spheres"){this.bonds_display=false;this.atoms_vdwMultiplier_3D=1}else if(t==="Stick"){this.atoms_useVDWDiameters_3D=false;this.bonds_showBondOrders_3D=false;this.bonds_cylinderDiameter_3D=this.atoms_sphereDiameter_3D=.8;this.bonds_materialAmbientColor_3D=this.atoms_materialAmbientColor_3D}else if(t==="Wireframe"){this.atoms_useVDWDiameters_3D=false;this.bonds_cylinderDiameter_3D=this.bonds_pillDiameter_3D=.05;this.atoms_sphereDiameter_3D=.15;this.bonds_materialAmbientColor_3D=e.default_atoms_materialAmbientColor_3D}else if(t==="Line"){this.atoms_display=false;this.bonds_renderAsLines_3D=true;this.bonds_width_2D=1;this.bonds_cylinderDiameter_3D=.05}else{alert('"'+t+'" is not recognized. Use one of the following strings:\n\n'+"1. Ball and Stick\n"+"2. van der Waals Spheres\n"+"3. Stick\n"+"4. Wireframe\n"+"5. Line\n")}}})(ChemDoodle,ChemDoodle.structures,Math);(function(e,t,n,r){"use strict";n.getPointsPerAngstrom=function(){return e.default_bondLength_2D/e.default_angstromsPerBondLength};n.BondDeducer=function(){};var i=n.BondDeducer.prototype;i.margin=1.1;i.deduceCovalentBonds=function(e,i){var s=n.getPointsPerAngstrom();if(i){s=i}for(var o=0,u=e.atoms.length;o<u;o++){for(var a=o+1;a<u;a++){var f=e.atoms[o];var l=e.atoms[a];if(f.distance3D(l)<(t[f.label].covalentRadius+t[l.label].covalentRadius)*s*this.margin){e.bonds.push(new r.Bond(f,l,1))}}}}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.informatics,ChemDoodle.structures);(function(e){"use strict";e.HydrogenDeducer=function(){};var t=e.HydrogenDeducer.prototype;t.removeHydrogens=function(e){var t=[];var n=[];for(var r=0,i=e.bonds.length;r<i;r++){if(e.bonds[r].a1.label!=="H"&&e.bonds[r].a2.label!=="H"){n.push(e.bonds[r])}}for(var r=0,i=e.atoms.length;r<i;r++){if(e.atoms[r].label!=="H"){t.push(e.atoms[r])}}e.atoms=t;e.bonds=n}})(ChemDoodle.informatics);(function(e,t,n){"use strict";t.MolecularSurfaceGenerator=function(){};var r=t.MolecularSurfaceGenerator.prototype;r.generateSurface=function(e,t,r,i,s){return new n.MolecularSurface(e,t,r,i,s)}})(ChemDoodle,ChemDoodle.informatics,ChemDoodle.structures.d3);(function(e,t){"use strict";e.Splitter=function(){};var n=e.Splitter.prototype;n.split=function(e){var n=[];for(var r=0,i=e.atoms.length;r<i;r++){e.atoms[r].visited=false}for(var r=0,i=e.bonds.length;r<i;r++){e.bonds[r].visited=false}for(var r=0,i=e.atoms.length;r<i;r++){var s=e.atoms[r];if(!s.visited){var o=new t.Molecule;o.atoms.push(s);s.visited=true;var u=new t.Queue;u.enqueue(s);while(!u.isEmpty()){var a=u.dequeue();for(var f=0,l=e.bonds.length;f<l;f++){var c=e.bonds[f];if(c.contains(a)&&!c.visited){c.visited=true;o.bonds.push(c);var h=c.getNeighbor(a);if(!h.visited){h.visited=true;o.atoms.push(h);u.enqueue(h)}}}}n.push(o)}}return n}})(ChemDoodle.informatics,ChemDoodle.structures);(function(e,t,n){"use strict";e.StructureBuilder=function(){};var r=e.StructureBuilder.prototype;r.copy=function(e){var n=new t.JSONInterpreter;return n.molFrom(n.molTo(e))}})(ChemDoodle.informatics,ChemDoodle.io,ChemDoodle.structures);(function(e){"use strict";e._Counter=function(){};var t=e._Counter.prototype;t.value=0;t.molecule=undefined;t.setMolecule=function(e){this.value=0;this.molecule=e;if(this.innerCalculate){this.innerCalculate()}}})(ChemDoodle.informatics);(function(e){"use strict";e.FrerejacqueNumberCounter=function(e){this.setMolecule(e)};var t=e.FrerejacqueNumberCounter.prototype=new e._Counter;t.innerCalculate=function(){this.value=this.molecule.bonds.length-this.molecule.atoms.length+(new e.NumberOfMoleculesCounter(this.molecule)).value}})(ChemDoodle.informatics);(function(e,t){"use strict";t.NumberOfMoleculesCounter=function(e){this.setMolecule(e)};var n=t.NumberOfMoleculesCounter.prototype=new t._Counter;n.innerCalculate=function(){for(var t=0,n=this.molecule.atoms.length;t<n;t++){this.molecule.atoms[t].visited=false}for(var t=0,n=this.molecule.atoms.length;t<n;t++){if(!this.molecule.atoms[t].visited){this.value++;var r=new e.Queue;this.molecule.atoms[t].visited=true;r.enqueue(this.molecule.atoms[t]);while(!r.isEmpty()){var i=r.dequeue();for(var s=0,o=this.molecule.bonds.length;s<o;s++){var u=this.molecule.bonds[s];if(u.contains(i)){var a=u.getNeighbor(i);if(!a.visited){a.visited=true;r.enqueue(a)}}}}}}}})(ChemDoodle.structures,ChemDoodle.informatics);(function(e){"use strict";e._RingFinder=function(){};var t=e._RingFinder.prototype;t.atoms=undefined;t.bonds=undefined;t.rings=undefined;t.reduce=function(e){for(var t=0,n=e.atoms.length;t<n;t++){e.atoms[t].visited=false}for(var t=0,n=e.bonds.length;t<n;t++){e.bonds[t].visited=false}var r=true;while(r){r=false;for(var t=0,n=e.atoms.length;t<n;t++){var i=0;var s;for(var o=0,u=e.bonds.length;o<u;o++){if(e.bonds[o].contains(e.atoms[t])&&!e.bonds[o].visited){i++;if(i===2){break}s=e.bonds[o]}}if(i===1){r=true;s.visited=true;e.atoms[t].visited=true}}}for(var t=0,n=e.atoms.length;t<n;t++){if(!e.atoms[t].visited){this.atoms.push(e.atoms[t])}}for(var t=0,n=e.bonds.length;t<n;t++){if(!e.bonds[t].visited){this.bonds.push(e.bonds[t])}}if(this.bonds.length===0&&this.atoms.length!==0){this.atoms=[]}};t.setMolecule=function(e){this.atoms=[];this.bonds=[];this.rings=[];this.reduce(e);if(this.atoms.length>2&&this.innerGetRings){this.innerGetRings()}};t.fuse=function(){for(var e=0,t=this.rings.length;e<t;e++){for(var n=0,r=this.bonds.length;n<r;n++){if(this.rings[e].atoms.indexOf(this.bonds[n].a1)!==-1&&this.rings[e].atoms.indexOf(this.bonds[n].a2)!==-1){this.rings[e].bonds.push(this.bonds[n])}}}}})(ChemDoodle.informatics);(function(e,t){"use strict";function n(e,t){this.atoms=[];if(t){for(var n=0,r=t.atoms.length;n<r;n++){this.atoms[n]=t.atoms[n]}}this.atoms.push(e)}var r=n.prototype;r.grow=function(e,t){var r=this.atoms[this.atoms.length-1];var i=[];for(var s=0,o=e.length;s<o;s++){if(e[s].contains(r)){var u=e[s].getNeighbor(r);if(t.indexOf(u)===-1){i.push(u)}}}var a=[];for(var s=0,o=i.length;s<o;s++){a.push(new n(i[s],this))}return a};r.check=function(e,n,r){for(var i=0,s=n.atoms.length-1;i<s;i++){if(this.atoms.indexOf(n.atoms[i])!==-1){return undefined}}var o;if(n.atoms[n.atoms.length-1]===this.atoms[this.atoms.length-1]){o=new t.Ring;o.atoms[0]=r;for(var i=0,s=this.atoms.length;i<s;i++){o.atoms.push(this.atoms[i])}for(var i=n.atoms.length-2;i>=0;i--){o.atoms.push(n.atoms[i])}}else{var u=[];for(var i=0,s=e.length;i<s;i++){if(e[i].contains(n.atoms[n.atoms.length-1])){u.push(e[i])}}for(var i=0,s=u.length;i<s;i++){if((n.atoms.length===1||!u[i].contains(n.atoms[n.atoms.length-2]))&&u[i].contains(this.atoms[this.atoms.length-1])){o=new t.Ring;o.atoms[0]=r;for(var a=0,f=this.atoms.length;a<f;a++){o.atoms.push(this.atoms[a])}for(var a=n.atoms.length-1;a>=0;a--){o.atoms.push(n.atoms[a])}break}}}return o};e.EulerFacetRingFinder=function(e){this.setMolecule(e)};var i=e.EulerFacetRingFinder.prototype=new e._RingFinder;i.fingerBreak=5;i.innerGetRings=function(){for(var e=0,t=this.atoms.length;e<t;e++){var r=[];for(var i=0,s=this.bonds.length;i<s;i++){if(this.bonds[i].contains(this.atoms[e])){r.push(this.bonds[i].getNeighbor(this.atoms[e]))}}for(var i=0,s=r.length;i<s;i++){for(var o=i+1;o<r.length;o++){var u=[];u[0]=new n(r[i]);u[1]=new n(r[o]);var a=[];a[0]=this.atoms[e];for(var f=0,l=r.length;f<l;f++){if(f!==i&&f!==o){a.push(r[f])}}var c=[];var h=u[0].check(this.bonds,u[1],this.atoms[e]);if(h){c[0]=h}while(c.length===0&&u.length>0&&u[0].atoms.length<this.fingerBreak){var p=[];for(var f=0,l=u.length;f<l;f++){var d=u[f].grow(this.bonds,a);for(var v=0,m=d.length;v<m;v++){p.push(d[v])}}u=p;for(var f=0,l=u.length;f<l;f++){for(var v=f+1;v<l;v++){var g=u[f].check(this.bonds,u[v],this.atoms[e]);if(g){c.push(g)}}}if(c.length===0){var y=[];for(var f=0,l=a.length;f<l;f++){for(var v=0,m=this.bonds.length;v<m;v++){if(this.bonds[v].contains(a[f])){var r=this.bonds[v].getNeighbor(a[f]);if(a.indexOf(r)===-1&&y.indexOf(r)===-1){y.push(r)}}}}for(var f=0,l=y.length;f<l;f++){a.push(y[f])}}}if(c.length>0){var b=undefined;for(var f=0,l=c.length;f<l;f++){if(!b||b.atoms.length>c[f].atoms.length){b=c[f]}}var w=false;for(var f=0,l=this.rings.length;f<l;f++){var E=true;for(var v=0,m=b.atoms.length;v<m;v++){if(this.rings[f].atoms.indexOf(b.atoms[v])===-1){E=false;break}}if(E){w=true;break}}if(!w){this.rings.push(b)}}}}}this.fuse()}})(ChemDoodle.informatics,ChemDoodle.structures);(function(e){"use strict";e.SSSRFinder=function(t){this.rings=[];if(t.atoms.length>0){var n=(new e.FrerejacqueNumberCounter(t)).value;var r=(new e.EulerFacetRingFinder(t)).rings;r.sort(function(e,t){return e.atoms.length-t.atoms.length});for(var i=0,s=t.bonds.length;i<s;i++){t.bonds[i].visited=false}for(var i=0,s=r.length;i<s;i++){var o=false;for(var u=0,a=r[i].bonds.length;u<a;u++){if(!r[i].bonds[u].visited){o=true;break}}if(o){for(var u=0,a=r[i].bonds.length;u<a;u++){r[i].bonds[u].visited=true}this.rings.push(r[i])}if(this.rings.length===n){break}}}}})(ChemDoodle.informatics);(function(e){"use strict";e._Interpreter=function(){};var t=e._Interpreter.prototype;t.fit=function(e,t,n){var r=e.length;var i=[];for(var s=0;s<t-r;s++){i.push(" ")}return n?e+i.join(""):i.join("")+e}})(ChemDoodle.io);(function(e,t,n,r,i,s,o){"use strict";var u=/\s+/g;var a=/\(|\)|\s+/g;var f=/\'|\s+/g;var l=/,|\'|\s+/g;var c=/^\s+/;var h=/[0-9]/g;var p=/[0-9]|\+|\-/g;var d=function(e){return e.length!==0};var v={P:[],A:[[0,.5,.5]],B:[[.5,0,.5]],C:[[.5,.5,0]],I:[[.5,.5,.5]],R:[[2/3,1/3,1/3],[1/3,2/3,2/3]],S:[[1/3,1/3,2/3],[2/3,2/3,1/3]],T:[[1/3,2/3,1/3],[2/3,1/3,2/3]],F:[[0,.5,.5],[.5,0,.5],[.5,.5,0]]};var m=function(e){var t=0;var n=0,r=0,i=0;var s=e.indexOf("x");var o=e.indexOf("y");var u=e.indexOf("z");if(s!==-1){n++;if(s>0&&e.charAt(s-1)!=="+"){n*=-1}}if(o!==-1){r++;if(o>0&&e.charAt(o-1)!=="+"){r*=-1}}if(u!==-1){i++;if(u>0&&e.charAt(u-1)!=="+"){i*=-1}}if(e.length>2){var a="+";for(var f=0,l=e.length;f<l;f++){var c=e.charAt(f);if((c==="-"||c==="/")&&(f===e.length-1||e.charAt(f+1).match(h))){a=c}if(c.match(h)){if(a==="+"){t+=parseInt(c)}else if(a==="-"){t-=parseInt(c)}else if(a==="/"){t/=parseInt(c)}}}}return[t,n,r,i]};var g=function(e,t,n,r,s,o){var u=(i.cos(r)-i.cos(o)*i.cos(s))/i.sin(o);return[e,0,0,0,t*i.cos(o),t*i.sin(o),0,0,n*i.cos(s),n*u,n*i.sqrt(1-i.pow(i.cos(s),2)-u*u),0,0,0,0,1]};n.CIFInterpreter=function(){};var y=n.CIFInterpreter.prototype=new n._Interpreter;y.read=function(n,o,h,y){o=o?o:1;h=h?h:1;y=y?y:1;var b=new r.Molecule;if(!n){return b}var w=n.split("\n");var E=0,S=0,x=0,T=0,N=0,C=0;var k="P";var L;var A;var O;var M;var _=true;while(w.length>0){if(_){M=w.shift()}else{_=true}if(M.length>0){if(t.stringStartsWith(M,"_cell_length_a")){E=parseFloat(M.split(a)[1])}else if(t.stringStartsWith(M,"_cell_length_b")){S=parseFloat(M.split(a)[1])}else if(t.stringStartsWith(M,"_cell_length_c")){x=parseFloat(M.split(a)[1])}else if(t.stringStartsWith(M,"_cell_angle_alpha")){T=i.PI*parseFloat(M.split(a)[1])/180}else if(t.stringStartsWith(M,"_cell_angle_beta")){N=i.PI*parseFloat(M.split(a)[1])/180}else if(t.stringStartsWith(M,"_cell_angle_gamma")){C=i.PI*parseFloat(M.split(a)[1])/180}else if(t.stringStartsWith(M,"_symmetry_space_group_name_H-M")){k=M.split(f)[1]}else if(t.stringStartsWith(M,"loop_")){var D={fields:[],lines:[]};var P=false;while((M=w.shift())!==undefined&&!t.stringStartsWith(M=M.replace(c,""),"loop_")&&M.length>0){if(t.stringStartsWith(M,"_")){if(P){break}D.fields=D.fields.concat(M.split(u).filter(d))}else{P=true;D.lines.push(M)}}if(w.length!==0&&(t.stringStartsWith(M,"loop_")||t.stringStartsWith(M,"_"))){_=false}if(D.fields.indexOf("_symmetry_equiv_pos_as_xyz")!==-1||D.fields.indexOf("_space_group_symop_operation_xyz")!==-1){L=D}else if(D.fields.indexOf("_atom_site_label")!==-1){A=D}else if(D.fields.indexOf("_geom_bond_atom_site_label_1")!==-1){O=D}}}}var H=g(E,S,x,T,N,C);if(A){var B=-1,j=-1,F=-1,I=-1,q=-1;for(var R=0,U=A.fields.length;R<U;R++){var z=A.fields[R];if(z==="_atom_site_type_symbol"){B=R}else if(z==="_atom_site_label"){j=R}else if(z==="_atom_site_fract_x"){F=R}else if(z==="_atom_site_fract_y"){I=R}else if(z==="_atom_site_fract_z"){q=R}}for(var R=0,U=A.lines.length;R<U;R++){M=A.lines[R];var W=M.split(u).filter(d);var X=new r.Atom(W[B===-1?j:B].split(p)[0],parseFloat(W[F]),parseFloat(W[I]),parseFloat(W[q]));b.atoms.push(X);if(j!==-1){X.cifId=W[j];X.cifPart=0}}}if(L&&!O){var V=0;for(var R=0,U=L.fields.length;R<U;R++){var z=L.fields[R];if(z==="_symmetry_equiv_pos_as_xyz"||z==="_space_group_symop_operation_xyz"){V=R}}var $=v[k];var J=[];for(var R=0,U=L.lines.length;R<U;R++){var K=L.lines[R].split(l).filter(d);var Q=m(K[V]);var G=m(K[V+1]);var Y=m(K[V+2]);for(var Z=0,et=b.atoms.length;Z<et;Z++){var X=b.atoms[Z];var tt=X.x*Q[1]+X.y*Q[2]+X.z*Q[3]+Q[0];var nt=X.x*G[1]+X.y*G[2]+X.z*G[3]+G[0];var rt=X.x*Y[1]+X.y*Y[2]+X.z*Y[3]+Y[0];var it=new r.Atom(X.label,tt,nt,rt);J.push(it);if(X.cifId!==undefined){it.cifId=X.cifId;it.cifPart=R+1}if($){for(var st=0,ot=$.length;st<ot;st++){var ut=$[st];var at=new r.Atom(X.label,tt+ut[0],nt+ut[1],rt+ut[2]);J.push(at);if(X.cifId!==undefined){at.cifId=X.cifId;at.cifPart=R+1}}}}}for(var R=0,U=J.length;R<U;R++){var X=J[R];while(X.x>=1){X.x--}while(X.x<0){X.x++}while(X.y>=1){X.y--}while(X.y<0){X.y++}while(X.z>=1){X.z--}while(X.z<0){X.z++}}var ft=[];for(var R=0,U=J.length;R<U;R++){var lt=false;var X=J[R];for(var Z=0,et=b.atoms.length;Z<et;Z++){if(b.atoms[Z].distance3D(X)<1e-4){lt=true;break}}if(!lt){for(var Z=0,et=ft.length;Z<et;Z++){if(ft[Z].distance3D(X)<1e-4){lt=true;break}}if(!lt){ft.push(X)}}}b.atoms=b.atoms.concat(ft)}var ct=[];for(var R=0;R<o;R++){for(var Z=0;Z<h;Z++){for(var st=0;st<y;st++){if(!(R===0&&Z===0&&st===0)){for(var ht=0,pt=b.atoms.length;ht<pt;ht++){var X=b.atoms[ht];var dt=new r.Atom(X.label,X.x+R,X.y+Z,X.z+st);ct.push(dt);if(X.cifId!==undefined){dt.cifId=X.cifId;dt.cifPart=X.cifPart+(L?L.lines.length:0)+R+Z*10+st*100}}}}}}b.atoms=b.atoms.concat(ct);for(var R=0,U=b.atoms.length;R<U;R++){var X=b.atoms[R];var vt=s.multiplyVec3(H,[X.x,X.y,X.z]);X.x=vt[0];X.y=vt[1];X.z=vt[2]}if(O){var mt=-1,gt=-1;for(var R=0,U=O.fields.length;R<U;R++){var z=O.fields[R];if(z==="_geom_bond_atom_site_label_1"){mt=R}else if(z==="_geom_bond_atom_site_label_2"){gt=R}}for(var st=0,ot=O.lines.length;st<ot;st++){var W=O.lines[st].split(u).filter(d);var yt=W[mt];var bt=W[gt];for(var R=0,U=b.atoms.length;R<U;R++){for(var Z=R+1;Z<U;Z++){var wt=b.atoms[R];var Et=b.atoms[Z];if(wt.cifPart!==Et.cifPart){break}if(wt.cifId===yt&&Et.cifId===bt||wt.cifId===bt&&Et.cifId===yt){b.bonds.push(new r.Bond(wt,Et))}}}}}else{(new e.informatics.BondDeducer).deduceCovalentBonds(b,1)}var St=[-o/2,-h/2,-y/2];b.unitCellVectors={o:s.multiplyVec3(H,St,[]),x:s.multiplyVec3(H,[St[0]+1,St[1],St[2]]),y:s.multiplyVec3(H,[St[0],St[1]+1,St[2]]),z:s.multiplyVec3(H,[St[0],St[1],St[2]+1]),xy:s.multiplyVec3(H,[St[0]+1,St[1]+1,St[2]]),xz:s.multiplyVec3(H,[St[0]+1,St[1],St[2]+1]),yz:s.multiplyVec3(H,[St[0],St[1]+1,St[2]+1]),xyz:s.multiplyVec3(H,[St[0]+1,St[1]+1,St[2]+1])};return b};var b=new n.CIFInterpreter;e.readCIF=function(e,t,n,r){return b.read(e,t,n,r)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,Math,mat4,vec3);(function(e,t,n,r){"use strict";n.MOLInterpreter=function(){};var i=n.MOLInterpreter.prototype=new n._Interpreter;i.read=function(n,i){if(!i){i=e.default_bondLength_2D}var s=new r.Molecule;if(!n){return s}var o=n.split("\n");var u=o[3];var a=parseInt(u.substring(0,3));var f=parseInt(u.substring(3,6));for(var l=0;l<a;l++){var h=o[4+l];s.atoms[l]=new r.Atom(h.substring(31,34),parseFloat(h.substring(0,10))*i,(i===1?1:-1)*parseFloat(h.substring(10,20))*i,parseFloat(h.substring(20,30))*i);var p=parseInt(h.substring(34,36));if(p!==0&&t[s.atoms[l].label]){s.atoms[l].mass=t[s.atoms[l].label].mass+p}switch(parseInt(h.substring(36,39))){case 1:s.atoms[l].charge=3;break;case 2:s.atoms[l].charge=2;break;case 3:s.atoms[l].charge=1;break;case 5:s.atoms[l].charge=-1;break;case 6:s.atoms[l].charge=-2;break;case 7:s.atoms[l].charge=-3;break}}for(var l=0;l<f;l++){var h=o[4+a+l];var d=parseInt(h.substring(6,9));var v=parseInt(h.substring(9,12));if(d>3){switch(d){case 4:d=1.5;break;default:d=1;break}}var m=new r.Bond(s.atoms[parseInt(h.substring(0,3))-1],s.atoms[parseInt(h.substring(3,6))-1],d);switch(v){case 3:m.stereo=r.Bond.STEREO_AMBIGUOUS;break;case 1:m.stereo=r.Bond.STEREO_PROTRUDING;break;case 6:m.stereo=r.Bond.STEREO_RECESSED;break}s.bonds[l]=m}return s};i.write=function(n){var i=[];i.push("Molecule from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n");i.push(this.fit(n.atoms.length.toString(),3));i.push(this.fit(n.bonds.length.toString(),3));i.push("  0  0  0  0            999 V2000\n");var s=n.getCenter();for(var o=0,u=n.atoms.length;o<u;o++){var a=n.atoms[o];var f=" 0";if(a.mass!==-1&&t[a.label]){var l=a.mass-t[a.label].mass;if(l<5&&l>-4){f=(l>-1?" ":"")+l}}var h="  0";if(a.charge!==0){switch(a.charge){case 3:h="  1";break;case 2:h="  2";break;case 1:h="  3";break;case-1:h="  5";break;case-2:h="  6";break;case-3:h="  7";break}}i.push(this.fit(((a.x-s.x)/e.default_bondLength_2D).toFixed(4),10));i.push(this.fit((-(a.y-s.y)/e.default_bondLength_2D).toFixed(4),10));i.push(this.fit((a.z/e.default_bondLength_2D).toFixed(4),10));i.push(" ");i.push(this.fit(a.label,3,true));i.push(f);i.push(h);i.push("  0  0  0  0\n")}for(var o=0,u=n.bonds.length;o<u;o++){var p=n.bonds[o];var d=0;if(p.stereo===r.Bond.STEREO_AMBIGUOUS){d=3}else if(p.stereo===r.Bond.STEREO_PROTRUDING){d=1}else if(p.stereo===r.Bond.STEREO_RECESSED){d=6}i.push(this.fit((n.atoms.indexOf(p.a1)+1).toString(),3));i.push(this.fit((n.atoms.indexOf(p.a2)+1).toString(),3));var v=p.bondOrder;if(v==1.5){v=4}else if(v>3||v%1!=0){v=1}i.push(this.fit(v,3));i.push("  ");i.push(d);i.push("     0  0\n")}i.push("M  END");return i.join("")};var s=new n.MOLInterpreter;e.readMOL=function(e,t){return s.read(e,t)};e.writeMOL=function(e){return s.write(e)}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.io,ChemDoodle.structures);(function(e,t,n,r,i,s,o){"use strict";function u(e,t,n,r,i){for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u.id===n&&r>=u.start&&r<=u.end){if(i){e.helix=true}else{e.sheet=true}if(r+1===u.end){e.arrow=true}return}}}n.PDBInterpreter=function(){};var a=n.PDBInterpreter.prototype=new n._Interpreter;a.calculateRibbonDistances=false;a.deduceResidueBonds=false;a.read=function(n,a){var f=new r.Molecule;f.chains=[];if(!n){return f}var l=n.split("\n");if(!a){a=1}var h=[];var p=[];var d;var v=[];var g=[];var y=[];for(var b=0,w=l.length;b<w;b++){var E=l[b];if(t.stringStartsWith(E,"HELIX")){h.push({id:E.substring(19,20),start:parseInt(E.substring(21,25)),end:parseInt(E.substring(33,37))})}else if(t.stringStartsWith(E,"SHEET")){p.push({id:E.substring(21,22),start:parseInt(E.substring(22,26)),end:parseInt(E.substring(33,37))})}else if(t.stringStartsWith(E,"ATOM")){var S=E.substring(16,17);if(S===" "||S==="A"){var x=s(E.substring(76,78));if(x.length===0){var T=s(E.substring(12,14));if(T==="HD"){x="H"}else if(T.length>0){if(T.length>1){x=T.charAt(0)+T.substring(1).toLowerCase()}else{x=T}}}var N=new r.Atom(x,parseFloat(E.substring(30,38))*a,parseFloat(E.substring(38,46))*a,parseFloat(E.substring(46,54))*a);N.hetatm=false;g.push(N);var C=parseInt(E.substring(22,26));if(v.length===0){for(var k=0;k<2;k++){var L=new r.Residue(-1);L.cp1=N;L.cp2=N;v.push(L)}}if(C!==Number.NaN&&v[v.length-1].resSeq!==C){var A=new r.Residue(C);A.name=s(E.substring(17,20));if(A.name.length===3){A.name=A.name.substring(0,1)+A.name.substring(1).toLowerCase()}else{if(A.name.length===2&&A.name.charAt(0)==="D"){A.name=A.name.substring(1)}}v.push(A);var O=E.substring(21,22);u(A,h,O,C,true);u(A,p,O,C,false)}var M=s(E.substring(12,16));var _=v[v.length-1];if(M==="CA"||M==="P"||M==="O5'"){if(!_.cp1){_.cp1=N}}else if(M==="N3"&&(_.name==="C"||_.name==="U"||_.name==="T")||M==="N1"&&(_.name==="A"||_.name==="G")){_.cp3=N}else if(M==="C2"){_.cp4=N}else if(M==="C4"&&(_.name==="C"||_.name==="U"||_.name==="T")||M==="C6"&&(_.name==="A"||_.name==="G")){_.cp5=N}else if(M==="O"||M==="C6"&&(_.name==="C"||_.name==="U"||_.name==="T")||M==="N9"){if(!v[v.length-1].cp2){if(M==="C6"||M==="N9"){d=N}_.cp2=N}}else if(M==="C"){d=N}}}else if(t.stringStartsWith(E,"HETATM")){var D=s(E.substring(76,78));if(D.length===0){D=s(E.substring(12,16))}if(D.length>1){D=D.substring(0,1)+D.substring(1).toLowerCase()}var P=new r.Atom(D,parseFloat(E.substring(30,38))*a,parseFloat(E.substring(38,46))*a,parseFloat(E.substring(46,54))*a);P.hetatm=true;var H=s(E.substring(17,20));if(H==="HOH"){P.isWater=true}f.atoms.push(P);y[parseInt(s(E.substring(6,11)))]=P}else if(t.stringStartsWith(E,"CONECT")){var B=parseInt(s(E.substring(6,11)));if(y[B]){var j=y[B];for(var F=0;F<4;F++){var I=s(E.substring(11+F*5,16+F*5));if(I.length!==0){var q=parseInt(I);if(y[q]){var R=y[q];var U=false;for(var k=0,z=f.bonds.length;k<z;k++){var W=f.bonds[k];if(W.a1===j&&W.a2===R||W.a1===R&&W.a2===j){U=true;break}}if(!U){f.bonds.push(new r.Bond(j,R))}}}}}}else if(t.stringStartsWith(E,"TER")){this.endChain(f,v,d,g);v=[]}else if(t.stringStartsWith(E,"ENDMDL")){break}}this.endChain(f,v,d,g);if(f.bonds.size===0){(new e.informatics.BondDeducer).deduceCovalentBonds(f,a)}if(this.deduceResidueBonds){for(var b=0,w=g.length;b<w;b++){var X=o.min(w,b+20);for(var k=b+1;k<X;k++){var V=g[b];var $=g[k];if(V.distance3D($)<(i[V.label].covalentRadius+i[$.label].covalentRadius)*1.1){f.bonds.push(new r.Bond(V,$,1))}}}}f.atoms=f.atoms.concat(g);if(this.calculateRibbonDistances){this.calculateDistances(f,g)}return f};a.endChain=function(e,t,n,i){if(t.length>0){var s=t[t.length-1];if(!s.cp1){s.cp1=i[i.length-2]}if(!s.cp2){s.cp2=i[i.length-1]}for(var o=0;o<4;o++){var u=new r.Residue(-1);u.cp1=n;u.cp2=t[t.length-1].cp2;t.push(u)}e.chains.push(t)}};a.calculateDistances=function(e,t){var n=[];for(var r=0,i=e.atoms.length;r<i;r++){var s=e.atoms[r];if(s.hetatm){if(!s.isWater){n.push(s)}}}for(var r=0,i=t.length;r<i;r++){var s=t[r];s.closestDistance=Number.POSITIVE_INFINITY;if(n.length===0){s.closestDistance=0}else{for(var o=0,u=n.length;o<u;o++){s.closestDistance=Math.min(s.closestDistance,s.distance3D(n[o]))}}}};var f=new n.PDBInterpreter;e.readPDB=function(e,t){return f.read(e,t)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.ELEMENT,jQuery.trim,Math);(function(e,t,n,r,i,s){"use strict";var o={"@":0,A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,a:-1,b:-2,c:-3,d:-4,e:-5,f:-6,g:-7,h:-8,i:-9},u={"%":0,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,j:-1,k:-2,l:-3,m:-4,n:-5,o:-6,p:-7,q:-8,r:-9},a={S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8,s:9};n.JCAMPInterpreter=function(){};var f=n.JCAMPInterpreter.prototype=new n._Interpreter;f.convertHZ2PPM=false;f.read=function(e){this.isBreak=function(e){return o[e]!==undefined||u[e]!==undefined||a[e]!==undefined||e===" "||e==="-"||e==="+"};this.getValue=function(e,t){var n=e.charAt(0);var r=e.substring(1);if(o[n]!==undefined){return parseFloat(o[n]+r)}else if(u[n]!==undefined){return parseFloat(u[n]+r)+t}return parseFloat(r)};var n=new r.Spectrum;if(e===undefined||e.length===0){return n}var i=e.split("\n");var f=[];var l,c,h,p,d=1,v=1,m=1,g=-1,y=-1,b=-1;var w=true,E=false;for(var S=0,x=i.length;S<x;S++){var T=s(i[S]);var N=T.indexOf("$$");if(N!==-1){T=T.substring(0,N)}if(f.length===0||!t.stringStartsWith(i[S],"##")){if(f.length!==0){f.push("\n")}f.push(s(T))}else{var C=f.join("");if(w&&C.length<100){n.metadata.push(C)}f=[T];if(t.stringStartsWith(C,"##TITLE=")){n.title=s(C.substring(8))}else if(t.stringStartsWith(C,"##XUNITS=")){n.xUnit=s(C.substring(9));if(this.convertHZ2PPM&&n.xUnit.toUpperCase()==="HZ"){n.xUnit="PPM";E=true}}else if(t.stringStartsWith(C,"##YUNITS=")){n.yUnit=s(C.substring(9))}else if(t.stringStartsWith(C,"##XYPAIRS=")){}else if(t.stringStartsWith(C,"##FIRSTX=")){c=parseFloat(s(C.substring(9)))}else if(t.stringStartsWith(C,"##LASTX=")){l=parseFloat(s(C.substring(8)))}else if(t.stringStartsWith(C,"##FIRSTY=")){h=parseFloat(s(C.substring(9)))}else if(t.stringStartsWith(C,"##NPOINTS=")){p=parseFloat(s(C.substring(10)))}else if(t.stringStartsWith(C,"##XFACTOR=")){d=parseFloat(s(C.substring(10)))}else if(t.stringStartsWith(C,"##YFACTOR=")){v=parseFloat(s(C.substring(10)))}else if(t.stringStartsWith(C,"##DELTAX=")){g=parseFloat(s(C.substring(9)))}else if(t.stringStartsWith(C,"##.OBSERVE FREQUENCY=")){if(this.convertHZ2PPM){m=parseFloat(s(C.substring(21)))}}else if(t.stringStartsWith(C,"##.SHIFT REFERENCE=")){if(this.convertHZ2PPM){var k=C.substring(19).split(",");y=parseInt(s(k[2]));b=parseFloat(s(k[3]))}}else if(t.stringStartsWith(C,"##XYDATA=")){if(!E){m=1}w=false;var L=false;var A=C.split("\n");var O=(l-c)/(p-1);if(g!==-1){for(var M=1,_=A.length;M<_;M++){if(A[M].charAt(0)==="|"){O=g;break}}}var D=c-O;var P=h;var H=0;var B;for(var M=1,_=A.length;M<_;M++){var j=[];var F=s(A[M]);var f=[];var I=false;for(var q=0,R=F.length;q<R;q++){if(this.isBreak(F.charAt(q))){if(f.length>0&&!(f.length===1&&f[0]===" ")){j.push(f.join(""))}f=[F.charAt(q)]}else{if(F.charAt(q)==="|"){I=true}else{f.push(F.charAt(q))}}}j.push(f.join(""));D=parseFloat(j[0])*d-O;for(var q=1,R=j.length;q<R;q++){var U=j[q];if(a[U.charAt(0)]!==undefined){var z=parseInt(a[U.charAt(0)]+U.substring(1))-1;for(var W=0;W<z;W++){D+=O;H=this.getValue(B,H);P=H*v;V++;n.data[n.data.length-1]=new r.Point(D/m,P)}}else{if(!(o[U.charAt(0)]!==undefined&&L)){L=u[U.charAt(0)]!==undefined;B=U;D+=O;H=this.getValue(U,H);P=H*v;V++;n.data.push(new r.Point(D/m,P))}else{P=this.getValue(U,H)*v;if(I){D+=O;n.data.push(new r.Point(D/m,P))}}}}}if(y!==-1){var X=b-n.data[y-1].x;for(var S=0,x=n.data.length;S<x;S++){n.data[S].x+=X}}}else if(t.stringStartsWith(C,"##PEAK TABLE=")){w=false;n.continuous=false;var A=C.split("\n");var V=0;for(var M=1,_=A.length;M<_;M++){var $=A[M].split(/[\s,]+/);V+=$.length/2;for(var q=0,R=$.length;q+1<R;q+=2){n.data.push(new r.Point(parseFloat(s($[q])),parseFloat(s($[q+1]))))}}}}}n.setup();return n};var l=new n.JCAMPInterpreter;l.convertHZ2PPM=true;e.readJCAMP=function(e){return l.read(e)}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.io,ChemDoodle.structures,jQuery,jQuery.trim);(function(e,t,n,r,i){"use strict";t.JSONInterpreter=function(){};var s=t.JSONInterpreter.prototype;s.contentTo=function(e,t){var n=0,r=0;for(var i=0,s=e.length;i<s;i++){var o=e[i];for(var u=0,a=o.atoms.length;u<a;u++){o.atoms[u].tmpid="a"+n++}for(var u=0,a=o.bonds.length;u<a;u++){o.bonds[u].tmpid="b"+r++}}n=0;for(var i=0,s=t.length;i<s;i++){t[i].tmpid="s"+n++}var f={};if(e&&e.length>0){f.m=[];for(var i=0,s=e.length;i<s;i++){f.m.push(this.molTo(e[i]))}}if(t&&t.length>0){f.s=[];for(var i=0,s=t.length;i<s;i++){f.s.push(this.shapeTo(t[i]))}}for(var i=0,s=e.length;i<s;i++){var o=e[i];for(var u=0,a=o.atoms.length;u<a;u++){o.atoms[u].tmpid=undefined}for(var u=0,a=o.bonds.length;u<a;u++){o.bonds[u].tmpid=undefined}}for(var i=0,s=t.length;i<s;i++){t[i].tmpid=undefined}return f};s.contentFrom=function(e){var t={molecules:[],shapes:[]};if(e.m){for(var n=0,r=e.m.length;n<r;n++){t.molecules.push(this.molFrom(e.m[n]))}}if(e.s){for(var n=0,r=e.s.length;n<r;n++){t.shapes.push(this.shapeFrom(e.s[n],t.molecules))}}for(var n=0,r=t.molecules.length;n<r;n++){var i=t.molecules[n];for(var s=0,o=i.atoms.length;s<o;s++){i.atoms[s].tmpid=undefined}for(var s=0,o=i.bonds.length;s<o;s++){i.bonds[s].tmpid=undefined}}for(var n=0,r=t.shapes.length;n<r;n++){t.shapes[n].tmpid=undefined}return t};s.molTo=function(e){var t={a:[]};for(var r=0,i=e.atoms.length;r<i;r++){var s=e.atoms[r];var o={x:s.x,y:s.y};if(s.tmpid){o.i=s.tmpid}if(s.label!=="C"){o.l=s.label}if(s.z!==0){o.z=s.z}if(s.charge!==0){o.c=s.charge}if(s.mass!==-1){o.m=s.mass}if(s.numRadical!==0){o.r=s.numRadical}if(s.numLonePair!==0){o.p=s.numLonePair}if(s.any){o.q=true}if(s.rgroup!==-1){o.rg=s.rgroup}t.a.push(o)}if(e.bonds.length>0){t.b=[];for(var r=0,i=e.bonds.length;r<i;r++){var u=e.bonds[r];var a={b:e.atoms.indexOf(u.a1),e:e.atoms.indexOf(u.a2)};if(u.tmpid){a.i=u.tmpid}if(u.bondOrder!==1){a.o=u.bondOrder}if(u.stereo!==n.Bond.STEREO_NONE){a.s=u.stereo}t.b.push(a)}}return t};s.molFrom=function(e){var t=new n.Molecule;for(var r=0,i=e.a.length;r<i;r++){var s=e.a[r];var o=new n.Atom(s.l?s.l:"C",s.x,s.y);if(s.i){o.tmpid=s.i}if(s.z){o.z=s.z}if(s.c){o.charge=s.c}if(s.m){o.mass=s.m}if(s.r){o.numRadical=s.r}if(s.p){o.numLonePair=s.p}if(s.q){o.any=true}if(s.rg){o.rgroup=s.rg}if(s.p_h!==undefined){o.hetatm=s.p_h}if(s.p_w!==undefined){o.isWater=s.p_w}if(s.p_d!==undefined){o.closestDistance=s.p_d}t.atoms.push(o)}if(e.b){for(var r=0,i=e.b.length;r<i;r++){var s=e.b[r];var u=new n.Bond(t.atoms[s.b],t.atoms[s.e],s.o===undefined?1:s.o);if(s.i){u.tmpid=s.i}if(s.s){u.stereo=s.s}t.bonds.push(u)}}return t};s.shapeTo=function(e){var t={};if(e.tmpid){t.i=e.tmpid}if(e instanceof r.Line){t.t="Line";t.x1=e.p1.x;t.y1=e.p1.y;t.x2=e.p2.x;t.y2=e.p2.y;t.a=e.arrowType}else if(e instanceof r.Pusher){t.t="Pusher";t.o1=e.o1.tmpid;t.o2=e.o2.tmpid;if(e.numElectron!==1){t.e=e.numElectron}}else if(e instanceof r.Bracket){t.t="Bracket";t.x1=e.p1.x;t.y1=e.p1.y;t.x2=e.p2.x;t.y2=e.p2.y;if(e.charge!==0){t.c=e.charge}if(e.mult!==0){t.m=e.mult}if(e.repeat!==0){t.r=e.repeat}}return t};s.shapeFrom=function(e,t){var i;if(e.t==="Line"){i=new r.Line(new n.Point(e.x1,e.y1),new n.Point(e.x2,e.y2));i.arrowType=e.a}else if(e.t==="Pusher"){var s;var o;for(var u=0,a=t.length;u<a;u++){var f=t[u];for(var l=0,c=f.atoms.length;l<c;l++){var h=f.atoms[l];if(h.tmpid===e.o1){s=h}else if(h.tmpid===e.o2){o=h}}for(var l=0,c=f.bonds.length;l<c;l++){var p=f.bonds[l];if(p.tmpid===e.o1){s=p}else if(p.tmpid===e.o2){o=p}}}i=new r.Pusher(s,o);if(e.e){i.numElectron=e.e}}else if(e.t==="Bracket"){i=new r.Bracket(new n.Point(e.x1,e.y1),new n.Point(e.x2,e.y2));if(e.c!==undefined){i.charge=e.c}if(e.m!==undefined){i.mult=e.m}if(e.r!==undefined){i.repeat=e.r}}return i};s.pdbFrom=function(e){var t=this.molFrom(e.mol);t.findRings=false;t.fromJSON=true;t.chains=this.chainsFrom(e.ribbons);return t};s.chainsFrom=function(e){var t=[];for(var r=0,i=e.cs.length;r<i;r++){var s=e.cs[r];var o=[];for(var u=0,a=s.length;u<a;u++){var f=s[u];var l=new n.Residue;l.name=f.n;l.cp1=new n.Atom("",f.x1,f.y1,f.z1);l.cp2=new n.Atom("",f.x2,f.y2,f.z2);if(f.x3){l.cp3=new n.Atom("",f.x3,f.y3,f.z3);l.cp4=new n.Atom("",f.x4,f.y4,f.z4);l.cp5=new n.Atom("",f.x5,f.y5,f.z5)}l.helix=f.h;l.sheet=f.s;l.arrow=f.a;o.push(l)}t.push(o)}return t};var o=new t.JSONInterpreter;e.readJSON=function(e){var t;try{t=i.parse(e)}catch(n){return undefined}if(t){if(t.m||t.s){return o.contentFrom(t)}else if(t.a){return t={molecules:[o.molFrom(t)],shapes:[]}}else{return t={molecules:[],shapes:[]}}}return undefined};e.writeJSON=function(e,t){return i.stringify(o.contentTo(e,t))}})(ChemDoodle,ChemDoodle.io,ChemDoodle.structures,ChemDoodle.structures.d2,JSON);(function(e,t,n){"use strict";t.RXNInterpreter=function(){};var r=t.RXNInterpreter.prototype=new t._Interpreter;r.read=function(t,r){if(!r){r=e.default_bondLength_2D}var i=[];var s;if(!t){i.push(new n.Molecule);s=new n.d2.Line(new n.Point(-20,0),new n.Point(20,0))}else{var o=t.split("$MOL\n");var u=o[0].split("\n");var a=u[4];var f=parseInt(a.substring(0,3));var l=parseInt(a.substring(3,6));var h=1;var p=0;for(var d=0,v=f+l;d<v;d++){i[d]=e.readMOL(o[h],r);var m=i[d].getBounds();var g=m.maxX-m.minX;p-=g+40;h++}for(var d=0,v=f;d<v;d++){var m=i[d].getBounds();var g=m.maxX-m.minX;var y=i[d].getCenter();for(var b=0,w=i[d].atoms.length;b<w;b++){var E=i[d].atoms[b];E.x+=p+g/2-y.x;E.y-=y.y}p+=g+40}s=new n.d2.Line(new n.Point(p,0),new n.Point(p+40,0));p+=80;for(var d=f,v=f+l;d<v;d++){var m=i[d].getBounds();var g=m.maxX-m.minX;var y=i[d].getCenter();for(var b=0;b<i[d].atoms.length;b++){var E=i[d].atoms[b];E.x+=p+g/2-y.x;E.y-=y.y}p+=g+40}}s.arrowType=n.d2.Line.ARROW_SYNTHETIC;return{molecules:i,shapes:[s]}};r.write=function(t,r){var i=[[],[]];var s=undefined;if(!t||!r){return}for(o=0,u=r.length;o<u;o++){if(r[o]instanceof n.d2.Line){s=r[o].getPoints();break}}if(!s){return""}for(var o=0,u=t.length;o<u;o++){var a=t[o].getCenter();if(a.x<s[1].x){i[0].push(t[o])}else{i[1].push(t[o])}}var f=[];f.push("$RXN\nReaction from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n");f.push(this.fit(i[0].length.toString(),3));f.push(this.fit(i[1].length.toString(),3));f.push("\n");for(var o=0;o<2;o++){for(var l=0,h=i[o].length;l<h;l++){f.push("$MOL\n");f.push(e.writeMOL(i[o][l]));f.push("\n")}}return f.join("")};var i=new t.RXNInterpreter;e.readRXN=function(e,t){return i.read(e,t)};e.writeRXN=function(e,t){return i.write(e,t)}})(ChemDoodle,ChemDoodle.io,ChemDoodle.structures);(function(e,t,n,r,i,s){"use strict";r.XYZInterpreter=function(){};var o=r.XYZInterpreter.prototype=new r._Interpreter;o.deduceCovalentBonds=true;o.read=function(t){var r=new i.Molecule;if(!t){return r}var o=t.split("\n");var u=parseInt(s(o[0]));for(var a=0;a<u;a++){var f=o[a+2];var l=f.split(/\s+/g);r.atoms[a]=new i.Atom(isNaN(l[0])?l[0]:n[parseInt(l[0])-1],parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]))}if(this.deduceCovalentBonds){(new e.informatics.BondDeducer).deduceCovalentBonds(r,1)}return r};var u=new r.XYZInterpreter;e.readXYZ=function(e){return u.read(e)}})(ChemDoodle,ChemDoodle.ELEMENT,ChemDoodle.SYMBOLS,ChemDoodle.io,ChemDoodle.structures,jQuery.trim);ChemDoodle.monitor=function(e,t,n){"use strict";var r={};r.CANVAS_DRAGGING=undefined;r.CANVAS_OVER=undefined;r.ALT=false;r.SHIFT=false;r.META=false;if(!e.supports_touch()){t(n).ready(function(){t(n).mousemove(function(e){if(r.CANVAS_DRAGGING){if(r.CANVAS_DRAGGING.drag){r.CANVAS_DRAGGING.prehandleEvent(e);r.CANVAS_DRAGGING.drag(e)}}});t(n).mouseup(function(e){if(r.CANVAS_DRAGGING&&r.CANVAS_DRAGGING!==r.CANVAS_OVER){if(r.CANVAS_DRAGGING.mouseup){r.CANVAS_DRAGGING.prehandleEvent(e);r.CANVAS_DRAGGING.mouseup(e)}}r.CANVAS_DRAGGING=undefined});t(n).keydown(function(e){r.SHIFT=e.shiftKey;r.ALT=e.altKey;r.META=e.metaKey||e.ctrlKey;var t=r.CANVAS_OVER;if(r.CANVAS_DRAGGING){t=r.CANVAS_DRAGGING}if(t){if(t.keydown){t.prehandleEvent(e);t.keydown(e)}}});t(n).keypress(function(e){var t=r.CANVAS_OVER;if(r.CANVAS_DRAGGING){t=r.CANVAS_DRAGGING}if(t){if(t.keypress){t.prehandleEvent(e);t.keypress(e)}}});t(n).keyup(function(e){r.SHIFT=e.shiftKey;r.ALT=e.altKey;r.META=e.metaKey||e.ctrlKey;var t=r.CANVAS_OVER;if(r.CANVAS_DRAGGING){t=r.CANVAS_DRAGGING}if(t){if(t.keyup){t.prehandleEvent(e);t.keyup(e)}}})})}return r}(ChemDoodle.featureDetection,jQuery,document);(function(e,t,n,r,i,s,o,u,a,f){"use strict";e._Canvas=function(){};var l=e._Canvas.prototype;l.molecules=undefined;l.shapes=undefined;l.emptyMessage=undefined;l.image=undefined;l.repaint=function(e){e=typeof e!=="undefined"?e:true;if(this.test){return}var t=a.getElementById(this.id);if(t.getContext){var n=t.getContext("2d");if(this.pixelRatio!==1&&t.width===this.width){t.width=this.width*this.pixelRatio;t.height=this.height*this.pixelRatio;n.scale(this.pixelRatio,this.pixelRatio)}if(!this.image){if(this.specs.backgroundColor&&this.bgCache!==t.style.backgroundColor){t.style.backgroundColor=this.specs.backgroundColor;this.bgCache=t.style.backgroundColor}n.fillStyle=this.specs.backgroundColor;n.fillRect(0,0,this.width,this.height)}else{n.drawImage(this.image,0,0)}if(this.innerRepaint){this.innerRepaint(n)}else{if(this.molecules.length!==0||this.shapes.length!==0){n.save();n.translate(this.width/2,this.height/2);n.rotate(this.specs.rotateAngle);n.scale(this.specs.scale,this.specs.scale);n.translate(-this.width/2,-this.height/2);for(var r=0,i=this.molecules.length;r<i;r++){this.molecules[r].check(true);this.molecules[r].draw(n,this.specs)}for(var r=0,i=this.shapes.length;r<i;r++){this.shapes[r].draw(n,this.specs)}n.restore()}else if(this.emptyMessage){n.fillStyle="#737683";n.textAlign="center";n.textBaseline="middle";n.font="18px Helvetica, Verdana, Arial, Sans-serif";n.fillText(this.emptyMessage,this.width/2,this.height/2)}}if(this.drawChildExtras&&e){this.drawChildExtras(n)}}};l.resize=function(t,n){var r=s("#"+this.id);r.attr({width:t,height:n});r.css("width",t);r.css("height",n);this.width=t;this.height=n;if(e._Canvas3D&&this instanceof e._Canvas3D){this.gl.viewport(0,0,t,n);this.setupScene()}else if(this.molecules.length>0){this.center();for(var i=0,o=this.molecules.length;i<o;i++){this.molecules[i].check()}}this.repaint()};l.setBackgroundImage=function(e){this.image=new Image;var t=this;this.image.onload=function(){t.repaint()};this.image.src=e};l.loadMolecule=function(t){this.clear();this.molecules.push(t);this.center();if(!(e._Canvas3D&&this instanceof e._Canvas3D)){t.check()}if(this.afterLoadContent){this.afterLoadContent()}this.repaint()};l.loadContent=function(t,n){this.molecules=t?t:[];this.shapes=n?n:[];this.center();if(!(e._Canvas3D&&this instanceof e._Canvas3D)){for(var r=0,i=this.molecules.length;r<i;r++){this.molecules[r].check()}}if(this.afterLoadContent){this.afterLoadContent()}this.repaint()};l.addMolecule=function(t){this.molecules.push(t);if(!(e._Canvas3D&&this instanceof e._Canvas3D)){t.check()}this.repaint()};l.removeMolecule=function(e){this.molecules=s.grep(this.molecules,function(t){return t!==e});this.repaint()};l.getMolecule=function(){return this.molecules.length>0?this.molecules[0]:undefined};l.getMolecules=function(){return this.molecules};l.addShape=function(e){this.shapes.push(e);this.repaint()};l.removeShape=function(e){this.shapes=s.grep(this.shapes,function(t){return t!==e});this.repaint()};l.getShapes=function(){return this.shapes};l.clear=function(){this.molecules=[];this.shapes=[];this.specs.scale=1;this.repaint()};l.center=function(){var e=this.getContentBounds();var t=new i.Point((this.width-e.minX-e.maxX)/2,(this.height-e.minY-e.maxY)/2);for(var n=0,r=this.molecules.length;n<r;n++){var s=this.molecules[n];for(var o=0,a=s.atoms.length;o<a;o++){s.atoms[o].add(t)}}for(var n=0,r=this.shapes.length;n<r;n++){var f=this.shapes[n].getPoints();for(var o=0,a=f.length;o<a;o++){f[o].add(t)}}this.specs.scale=1;var l=e.maxX-e.minX;var c=e.maxY-e.minY;if(l>this.width||c>this.height){this.specs.scale=u.min(this.width/l,this.height/c)*.85}};l.bondExists=function(e,t){for(var n=0,r=this.molecules.length;n<r;n++){var i=this.molecules[n];for(var s=0,o=i.bonds.length;s<o;s++){var u=i.bonds[s];if(u.contains(e)&&u.contains(t)){return true}}}return false};l.getBond=function(e,t){for(var n=0,r=this.molecules.length;n<r;n++){var i=this.molecules[n];for(var s=0,o=i.bonds.length;s<o;s++){var u=i.bonds[s];if(u.contains(e)&&u.contains(t)){return u}}}return undefined};l.getMoleculeByAtom=function(e){for(var t=0,n=this.molecules.length;t<n;t++){var r=this.molecules[t];if(r.atoms.indexOf(e)!==-1){return r}}return undefined};l.getAllAtoms=function(){var e=[];for(var t=0,n=this.molecules.length;t<n;t++){e=e.concat(this.molecules[t].atoms)}return e};l.getAllPoints=function(){var e=[];for(var t=0,n=this.molecules.length;t<n;t++){e=e.concat(this.molecules[t].atoms)}for(var t=0,n=this.shapes.length;t<n;t++){e=e.concat(this.shapes[t].getPoints())}return e};l.getContentBounds=function(){var e=new n.Bounds;for(var t=0,r=this.molecules.length;t<r;t++){e.expand(this.molecules[t].getBounds())}for(var t=0,r=this.shapes.length;t<r;t++){e.expand(this.shapes[t].getBounds())}return e};l.create=function(n,l,h){this.id=n;this.width=l;this.height=h;this.molecules=[];this.shapes=[];if(a.getElementById(n)){var p=s("#"+n);if(!l){this.width=p.attr("width")}else{p.attr("width",l)}if(!h){this.height=p.attr("height")}else{p.attr("height",h)}p.attr("class","ChemDoodleWebComponent")}else if(!e.featureDetection.supports_canvas_text()&&o.msie&&o.version>="6"){a.writeln('<div style="border: 1px solid black;" width="'+l+'" height="'+h+'">Please install <a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>, then restart Internet Explorer.</div>');return}else{a.writeln('<canvas class="ChemDoodleWebComponent" id="'+n+'" width="'+l+'" height="'+h+'" alt="ChemDoodle Web Component">This browser does not support HTML5/Canvas.</canvas>')}var d=s("#"+n);d.css("width",this.width);d.css("height",this.height);this.pixelRatio=f.devicePixelRatio?f.devicePixelRatio:1;this.specs=new i.VisualSpecifications;var v=this;if(t.supports_touch()){d.bind("touchstart",function(e){var n=(new Date).getTime();if(!t.supports_gesture()&&e.originalEvent.touches.length===2){var r=e.originalEvent.touches;var s=new i.Point(r[0].pageX,r[0].pageY);var o=new i.Point(r[1].pageX,r[1].pageY);v.implementedGestureDist=s.distance(o);v.implementedGestureAngle=s.angle(o);if(v.gesturestart){v.prehandleEvent(e);v.gesturestart(e)}}if(v.lastTouch&&e.originalEvent.touches.length===1&&n-v.lastTouch<500){if(v.dbltap){v.prehandleEvent(e);v.dbltap(e)}else if(v.dblclick){v.prehandleEvent(e);v.dblclick(e)}else if(v.touchstart){v.prehandleEvent(e);v.touchstart(e)}else if(v.mousedown){v.prehandleEvent(e);v.mousedown(e)}}else if(v.touchstart){v.prehandleEvent(e);v.touchstart(e);if(this.hold){clearTimeout(this.hold)}if(this.touchhold){this.hold=setTimeout(function(){v.touchhold(e)},1e3)}}else if(v.mousedown){v.prehandleEvent(e);v.mousedown(e)}v.lastTouch=n});d.bind("touchmove",function(e){if(this.hold){clearTimeout(this.hold);this.hold=undefined}if(!t.supports_gesture()&&e.originalEvent.touches.length===2){if(v.gesturechange){var n=e.originalEvent.touches;var r=new i.Point(n[0].pageX,n[0].pageY);var s=new i.Point(n[1].pageX,n[1].pageY);var o=r.distance(s);var a=r.angle(s);e.originalEvent.scale=o/v.implementedGestureDist;e.originalEvent.rotation=180*(v.implementedGestureAngle-a)/u.PI;v.prehandleEvent(e);v.gesturechange(e)}}if(e.originalEvent.touches.length>1&&v.multitouchmove){var f=e.originalEvent.touches.length;v.prehandleEvent(e);var l=new i.Point(-e.offset.left*f,-e.offset.top*f);for(var c=0;c<f;c++){l.x+=e.originalEvent.changedTouches[c].pageX;l.y+=e.originalEvent.changedTouches[c].pageY}l.x/=f;l.y/=f;e.p=l;v.multitouchmove(e,f)}else if(v.touchmove){v.prehandleEvent(e);v.touchmove(e)}else if(v.drag){v.prehandleEvent(e);v.drag(e)}});d.bind("touchend",function(e){if(this.hold){clearTimeout(this.hold);this.hold=undefined}if(!t.supports_gesture()&&v.implementedGestureDist){v.implementedGestureDist=undefined;v.implementedGestureAngle=undefined;if(v.gestureend){v.prehandleEvent(e);v.gestureend(e)}}if(v.touchend){v.prehandleEvent(e);v.touchend(e)}else if(v.mouseup){v.prehandleEvent(e);v.mouseup(e)}if((new Date).getTime()-v.lastTouch<250){if(v.tap){v.prehandleEvent(e);v.tap(e)}else if(v.click){v.prehandleEvent(e);v.click(e)}}});d.bind("gesturestart",function(e){if(v.gesturestart){v.prehandleEvent(e);v.gesturestart(e)}});d.bind("gesturechange",function(e){if(v.gesturechange){v.prehandleEvent(e);v.gesturechange(e)}});d.bind("gestureend",function(e){if(v.gestureend){v.prehandleEvent(e);v.gestureend(e)}})}else{d.click(function(e){switch(e.which){case 1:if(v.click){v.prehandleEvent(e);v.click(e)}break;case 2:if(v.middleclick){v.prehandleEvent(e);v.middleclick(e)}break;case 3:if(v.rightclick){v.prehandleEvent(e);v.rightclick(e)}break}});d.dblclick(function(e){if(v.dblclick){v.prehandleEvent(e);v.dblclick(e)}});d.mousedown(function(e){switch(e.which){case 1:r.CANVAS_DRAGGING=v;if(v.mousedown){v.prehandleEvent(e);v.mousedown(e)}break;case 2:if(v.middlemousedown){v.prehandleEvent(e);v.middlemousedown(e)}break;case 3:if(v.rightmousedown){v.prehandleEvent(e);v.rightmousedown(e)}break}});d.mousemove(function(e){if(!r.CANVAS_DRAGGING&&v.mousemove){v.prehandleEvent(e);v.mousemove(e)}});d.mouseout(function(e){r.CANVAS_OVER=undefined;if(v.mouseout){v.prehandleEvent(e);v.mouseout(e)}});d.mouseover(function(e){r.CANVAS_OVER=v;if(v.mouseover){v.prehandleEvent(e);v.mouseover(e)}});d.mouseup(function(e){switch(e.which){case 1:if(v.mouseup){v.prehandleEvent(e);v.mouseup(e)}break;case 2:if(v.middlemouseup){v.prehandleEvent(e);v.middlemouseup(e)}break;case 3:if(v.rightmouseup){v.prehandleEvent(e);v.rightmouseup(e)}break}});d.mousewheel(function(e,t){if(v.mousewheel){v.prehandleEvent(e);v.mousewheel(e,t)}})}if(this.subCreate){this.subCreate()}};l.prehandleEvent=function(e){if(e.originalEvent.changedTouches){e.pageX=e.originalEvent.changedTouches[0].pageX;e.pageY=e.originalEvent.changedTouches[0].pageY}e.preventDefault();e.offset=s("#"+this.id).offset();e.p=new i.Point(e.pageX-e.offset.left,e.pageY-e.offset.top)}})(ChemDoodle,ChemDoodle.featureDetection,ChemDoodle.math,ChemDoodle.monitor,ChemDoodle.structures,jQuery,jQuery.browser,Math,document,window);(function(e){"use strict";e._AnimatorCanvas=function(e,t,n){if(e){this.create(e,t,n)}};var t=e._AnimatorCanvas.prototype=new e._Canvas;t.timeout=33;t.startAnimation=function(){this.stopAnimation();this.lastTime=(new Date).getTime();var e=this;if(this.nextFrame){this.handle=setInterval(function(){var t=(new Date).getTime();e.nextFrame(t-e.lastTime);e.repaint();e.lastTime=t},this.timeout)}};t.stopAnimation=function(){if(this.handle){clearInterval(this.handle);this.handle=undefined}};t.isRunning=function(){return this.handle!==undefined}})(ChemDoodle);(function(e,t){"use strict";e.FileCanvas=function(e,n,r,i){if(e){this.create(e,n,r)}var s='<br><form name="FileForm" enctype="multipart/form-data" method="POST" action="'+i+'" target="HiddenFileFrame"><input type="file" name="f" /><input type="submit" name="submitbutton" value="Show File" /></form><iframe id="HFF-'+e+'" name="HiddenFileFrame" height="0" width="0" style="display:none;" onLoad="GetMolFromFrame(\'HFF-'+e+"', "+e+')"></iframe>';t.writeln(s);this.emptyMessage="Click below to load file";this.repaint()};e.FileCanvas.prototype=new e._Canvas})(ChemDoodle,document);(function(e){"use strict";e.HyperlinkCanvas=function(e,t,n,r,i,s){if(e){this.create(e,t,n)}this.urlOrFunction=r;this.color=i?i:"blue";this.size=s?s:2};var t=e.HyperlinkCanvas.prototype=new e._Canvas;t.openInNewWindow=true;t.hoverImage=undefined;t.drawChildExtras=function(e){if(this.e){if(this.hoverImage){e.drawImage(this.hoverImage,0,0)}else{e.strokeStyle=this.color;e.lineWidth=this.size*2;e.strokeRect(0,0,this.width,this.height)}}};t.setHoverImage=function(e){this.hoverImage=new Image;this.hoverImage.src=e};t.click=function(e){this.e=undefined;this.repaint();if(this.urlOrFunction instanceof Function){this.urlOrFunction()}else{if(this.openInNewWindow){window.open(this.urlOrFunction)}else{location.href=this.urlOrFunction}}};t.mouseout=function(e){this.e=undefined;this.repaint()};t.mouseover=function(e){this.e=e;this.repaint()}})(ChemDoodle);(function(e,t,n,r){"use strict";e.MolGrabberCanvas=function(e,t,i){if(e){this.create(e,t,i)}var s=[];s.push('<br><input type="text" id="');s.push(e);s.push('_query" size="32" value="" />');s.push("<br><nobr>");s.push('<select id="');s.push(e);s.push('_select">');s.push('<option value="chemexper">ChemExper');s.push('<option value="chemspider">ChemSpider');s.push('<option value="pubchem" selected>PubChem');s.push("</select>");s.push('<button id="');s.push(e);s.push('_submit">Show Molecule</button>');s.push("</nobr>");r.getElementById(e);var o=n("#"+e);o.after(s.join(""));var u=this;n("#"+e+"_submit").click(function(){u.search()});n("#"+e+"_query").keypress(function(e){if(e.which===13){u.search()}});this.emptyMessage="Enter search term below";this.repaint()};var i=e.MolGrabberCanvas.prototype=new e._Canvas;i.setSearchTerm=function(e){n("#"+this.id+"_query").val(e);this.search()};i.search=function(){this.emptyMessage="Searching...";this.clear();var e=this;t.getMoleculeFromDatabase(n("#"+this.id+"_query").val(),{database:n("#"+this.id+"_select").val()},function(t){e.loadMolecule(t)})}})(ChemDoodle,ChemDoodle.iChemLabs,jQuery,document);(function(e,t,n){"use strict";var r=[];var i=[1,0,0];var s=[0,1,0];var o=[0,0,1];e.RotatorCanvas=function(e,t,n,r){if(e){this.create(e,t,n)}this.rotate3D=r};var u=e.RotatorCanvas.prototype=new e._AnimatorCanvas;var a=t.PI/15;u.xIncrement=a;u.yIncrement=a;u.zIncrement=a;u.nextFrame=function(e){if(this.molecules.length===0&&this.shapes.length===0){this.stopAnimation();return}var t=e/1e3;if(this.rotate3D){n.identity(r);n.rotate(r,this.xIncrement*t,i);n.rotate(r,this.yIncrement*t,s);n.rotate(r,this.zIncrement*t,o);for(var u=0,a=this.molecules.length;u<a;u++){var f=this.molecules[u];for(var l=0,c=f.atoms.length;l<c;l++){var h=f.atoms[l];var p=[h.x-this.width/2,h.y-this.height/2,h.z];n.multiplyVec3(r,p);h.x=p[0]+this.width/2;h.y=p[1]+this.height/2;h.z=p[2]}for(var l=0,c=f.rings.length;l<c;l++){f.rings[l].center=f.rings[l].getCenter()}if(this.specs.atoms_display&&this.specs.atoms_circles_2D){f.sortAtomsByZ()}if(this.specs.bonds_display&&this.specs.bonds_clearOverlaps_2D){f.sortBondsByZ()}}for(var u=0,a=this.shapes.length;u<a;u++){var d=this.shapes[u].getPoints();for(var l=0,c=d.length;l<c;l++){var h=d[l];var p=[h.x-this.width/2,h.y-this.height/2,0];n.multiplyVec3(r,p);h.x=p[0]+this.width/2;h.y=p[1]+this.height/2}}}else{this.specs.rotateAngle+=this.zIncrement*t}};u.dblclick=function(e){if(this.isRunning()){this.stopAnimation()}else{this.startAnimation()}}})(ChemDoodle,Math,mat4);(function(e,t){"use strict";e.SlideshowCanvas=function(e,t,n){if(e){this.create(e,t,n)}};var n=e.SlideshowCanvas.prototype=new e._AnimatorCanvas;n.frames=[];n.curIndex=0;n.timeout=5e3;n.alpha=0;n.innerHandle=undefined;n.phase=0;n.drawChildExtras=function(e){var n=t.getRGB(this.specs.backgroundColor,255);e.fillStyle="rgba("+n[0]+", "+n[1]+", "+n[2]+", "+this.alpha+")";e.fillRect(0,0,this.width,this.height)};n.nextFrame=function(e){if(this.frames.length===0){this.stopAnimation();return}this.phase=0;var t=this;var n=1;this.innerHandle=setInterval(function(){t.alpha=n/15;t.repaint();if(n===15){t.breakInnerHandle()}n++},33)};n.breakInnerHandle=function(){if(this.innerHandle){clearInterval(this.innerHandle);this.innerHandle=undefined}if(this.phase===0){this.curIndex++;if(this.curIndex>this.frames.length-1){this.curIndex=0}this.alpha=1;var e=this.frames[this.curIndex];this.loadContent(e.mols,e.shapes);this.phase=1;var t=this;var n=1;this.innerHandle=setInterval(function(){t.alpha=(15-n)/15;t.repaint();if(n===15){t.breakInnerHandle()}n++},33)}else if(this.phase===1){this.alpha=0;this.repaint()}};n.addFrame=function(e,t){if(this.frames.length===0){this.loadContent(e,t)}this.frames.push({mols:e,shapes:t})}})(ChemDoodle,ChemDoodle.math);(function(e,t,n,r,i){"use strict";e.TransformCanvas=function(e,t,n,r){if(e){this.create(e,t,n)}this.rotate3D=r};var s=e.TransformCanvas.prototype=new e._Canvas;s.lastPoint=undefined;s.rotationMultMod=1.3;s.lastPinchScale=1;s.lastGestureRotate=0;s.mousedown=function(e){this.lastPoint=e.p};s.dblclick=function(e){this.center();this.repaint()};s.drag=function(e){if(!this.lastPoint.multi){if(t.ALT){var s=new n.Point(e.p.x,e.p.y);s.sub(this.lastPoint);for(var o=0,u=this.molecules.length;o<u;o++){var a=this.molecules[o];for(var f=0,l=a.atoms.length;f<l;f++){a.atoms[f].add(s)}a.check()}for(var o=0,u=this.shapes.length;o<u;o++){var c=this.shapes[o].getPoints();for(var f=0,l=c.length;f<l;f++){c[f].add(s)}}this.lastPoint=e.p;this.repaint()}else{if(this.rotate3D===true){var h=r.max(this.width/4,this.height/4);var p=e.p.x-this.lastPoint.x;var d=e.p.y-this.lastPoint.y;var v=p/h*this.rotationMultMod;var g=-d/h*this.rotationMultMod;var y=[];i.identity(y);i.rotate(y,g,[1,0,0]);i.rotate(y,v,[0,1,0]);for(var o=0,u=this.molecules.length;o<u;o++){var a=this.molecules[o];for(var f=0,l=a.atoms.length;f<l;f++){var b=a.atoms[f];var w=[b.x-this.width/2,b.y-this.height/2,b.z];i.multiplyVec3(y,w);b.x=w[0]+this.width/2;b.y=w[1]+this.height/2;b.z=w[2]}for(var o=0,u=a.rings.length;o<u;o++){a.rings[o].center=a.rings[o].getCenter()}this.lastPoint=e.p;if(this.specs.atoms_display&&this.specs.atoms_circles_2D){a.sortAtomsByZ()}if(this.specs.bonds_display&&this.specs.bonds_clearOverlaps_2D){a.sortBondsByZ()}}this.repaint()}else{var E=new n.Point(this.width/2,this.height/2);var S=E.angle(this.lastPoint);var x=E.angle(e.p);this.specs.rotateAngle-=x-S;this.lastPoint=e.p;this.repaint()}}}};s.mousewheel=function(e,t){this.specs.scale+=t/50;if(this.specs.scale<.01){this.specs.scale=.01}this.repaint()};s.multitouchmove=function(e,t){if(t===2){if(this.lastPoint.multi){var r=new n.Point(e.p.x,e.p.y);r.sub(this.lastPoint);for(var i=0,s=this.molecules.length;i<s;i++){var o=this.molecules[i];for(var u=0,a=o.atoms.length;u<a;u++){o.atoms[u].add(r)}o.check()}for(var i=0,s=this.shapes.length;i<s;i++){var f=this.shapes[i].getPoints();for(var u=0,a=f.length;u<a;u++){f[u].add(r)}}this.lastPoint=e.p;this.lastPoint.multi=true;this.repaint()}else{this.lastPoint=e.p;this.lastPoint.multi=true}}};s.gesturechange=function(e){if(e.originalEvent.scale-this.lastPinchScale!==0){this.specs.scale*=e.originalEvent.scale/this.lastPinchScale;if(this.specs.scale<.01){this.specs.scale=.01}this.lastPinchScale=e.originalEvent.scale}if(this.lastGestureRotate-e.originalEvent.rotation!==0){var t=(this.lastGestureRotate-e.originalEvent.rotation)/180*o.PI;var r=new n.Point(this.width/2,this.height/2);for(var i=0,s=this.molecules.length;i<s;i++){var o=this.molecules[i];for(var u=0,a=o.atoms.length;u<a;u++){var f=o.atoms[u];var l=r.distance(f);var c=r.angle(f)+t;f.x=r.x+l*o.cos(c);f.y=r.y-l*o.sin(c)}o.check()}this.lastGestureRotate=e.originalEvent.rotation}this.repaint()};s.gestureend=function(e){this.lastPinchScale=1;this.lastGestureRotate=0}})(ChemDoodle,ChemDoodle.monitor,ChemDoodle.structures,Math,mat4);(function(e){"use strict";e.ViewerCanvas=function(e,t,n){if(e){this.create(e,t,n)}};e.ViewerCanvas.prototype=new e._Canvas})(ChemDoodle);(function(e,t){"use strict";e._SpectrumCanvas=function(e,t,n){if(e){this.create(e,t,n)}};var n=e._SpectrumCanvas.prototype=new e._Canvas;n.spectrum=undefined;n.emptyMessage="No Spectrum Loaded or Recognized";n.loadMolecule=undefined;n.getMolecule=undefined;n.innerRepaint=function(e){if(this.spectrum&&this.spectrum.data.length>0){this.spectrum.draw(e,this.specs,this.width,this.height)}else if(this.emptyMessage){e.fillStyle="#737683";e.textAlign="center";e.textBaseline="middle";e.font="18px Helvetica, Verdana, Arial, Sans-serif";e.fillText(this.emptyMessage,this.width/2,this.height/2)}};n.loadSpectrum=function(e){this.spectrum=e;this.repaint()};n.getSpectrum=function(){return this.spectrum};n.getSpectrumCoordinates=function(e,t){return spectrum.getInternalCoordinates(e,t,this.width,this.height)}})(ChemDoodle,document);(function(e){"use strict";e.ObserverCanvas=function(e,t,n){if(e){this.create(e,t,n)}};e.ObserverCanvas.prototype=new e._SpectrumCanvas})(ChemDoodle);(function(e){"use strict";e.OverlayCanvas=function(e,t,n){if(e){this.create(e,t,n)}};var t=e.OverlayCanvas.prototype=new e._SpectrumCanvas;t.overlaySpectra=[];t.superRepaint=t.innerRepaint;t.innerRepaint=function(e){this.superRepaint(e);if(this.spectrum&&this.spectrum.data.length>0){for(var t=0,n=this.overlaySpectra.length;t<n;t++){var r=this.overlaySpectra[t];if(r&&r.data.length>0){r.minX=this.spectrum.minX;r.maxX=this.spectrum.maxX;r.drawPlot(e,this.specs,this.width,this.height,this.spectrum.memory.offsetTop,this.spectrum.memory.offsetLeft,this.spectrum.memory.offsetBottom)}}}};t.addSpectrum=function(e){if(!this.spectrum){this.spectrum=e}else{this.overlaySpectra.push(e)}}})(ChemDoodle);(function(e,t,n){"use strict";e.PerspectiveCanvas=function(e,t,n){if(e){this.create(e,t,n)}};var r=e.PerspectiveCanvas.prototype=new e._SpectrumCanvas;r.dragRange=undefined;r.rescaleYAxisOnZoom=true;r.lastPinchScale=1;r.mousedown=function(t){this.dragRange=new e.structures.Point(t.p.x,t.p.x)};r.mouseup=function(e){if(this.dragRange&&this.dragRange.x!==this.dragRange.y){if(!this.dragRange.multi){var t=this.spectrum.zoom(this.dragRange.x,e.p.x,this.width,this.rescaleYAxisOnZoom);if(this.rescaleYAxisOnZoom){this.specs.scale=t}}this.dragRange=undefined;this.repaint()}};r.drag=function(e){if(this.dragRange){if(this.dragRange.multi){this.dragRange=undefined}else if(t.SHIFT){this.spectrum.translate(e.p.x-this.dragRange.x,this.width);this.dragRange.x=e.p.x;this.dragRange.y=e.p.x}else{this.dragRange.y=e.p.x}this.repaint()}};r.drawChildExtras=function(e){if(this.dragRange){var t=n.min(this.dragRange.x,this.dragRange.y);var r=n.max(this.dragRange.x,this.dragRange.y);e.strokeStyle="gray";e.lineStyle=1;e.beginPath();e.moveTo(t,this.height/2);for(var i=t;i<=r;i++){if(i%10<5){e.lineTo(i,n.round(this.height/2))}else{e.moveTo(i,n.round(this.height/2))}}e.stroke()}};r.mousewheel=function(e,t){this.specs.scale+=t/10;if(this.specs.scale<.01){this.specs.scale=.01}this.repaint()};r.dblclick=function(e){this.spectrum.setup();this.specs.scale=1;this.repaint()};r.multitouchmove=function(t,n){if(n===2){if(!this.dragRange||!this.dragRange.multi){this.dragRange=new e.structures.Point(t.p.x,t.p.x);this.dragRange.multi=true}else{this.spectrum.translate(t.p.x-this.dragRange.x,this.width);this.dragRange.x=t.p.x;this.dragRange.y=t.p.x;this.repaint()}}};r.gesturechange=function(e){this.specs.scale*=e.originalEvent.scale/this.lastPinchScale;if(this.specs.scale<.01){this.specs.scale=.01}this.lastPinchScale=e.originalEvent.scale;this.repaint()};r.gestureend=function(e){this.lastPinchScale=1}})(ChemDoodle,ChemDoodle.monitor,Math);(function(e,t,n){"use strict";e.SeekerCanvas=function(e,t,n,r){if(e){this.create(e,t,n)}this.seekType=r};var r=e.SeekerCanvas.prototype=new e._SpectrumCanvas;r.superRepaint=r.innerRepaint;r.innerRepaint=function(r){this.superRepaint(r);if(this.spectrum&&this.spectrum.data.length>0&&this.p){var i;var s;if(this.seekType===e.SeekerCanvas.SEEK_POINTER){i=this.p;s=this.spectrum.getInternalCoordinates(i.x,i.y)}else if(this.seekType===e.SeekerCanvas.SEEK_PLOT||this.seekType===e.SeekerCanvas.SEEK_PEAK){s=this.seekType===e.SeekerCanvas.SEEK_PLOT?this.spectrum.getClosestPlotInternalCoordinates(this.p.x):this.spectrum.getClosestPeakInternalCoordinates(this.p.x);if(!s){return}i={x:this.spectrum.getTransformedX(s.x,this.specs,this.width,this.spectrum.memory.offsetLeft),y:this.spectrum.getTransformedY(s.y/100,this.specs,this.height,this.spectrum.memory.offsetBottom,this.spectrum.memory.offsetTop)}}r.fillStyle="white";r.strokeStyle=this.specs.plots_color;r.lineWidth=this.specs.plots_width;r.beginPath();r.arc(i.x,i.y,3,0,n.PI*2,false);r.fill();r.stroke();r.font=t.getFontString(this.specs.text_font_size,this.specs.text_font_families);r.textAlign="left";r.textBaseline="bottom";var o="x:"+s.x.toFixed(3)+", y:"+s.y.toFixed(3);var u=i.x+3;var a=r.measureText(o).width;if(u+a>this.width-2){u-=6+a}var f=i.y;if(f-this.specs.text_font_size-2<0){f+=this.specs.text_font_size}r.fillRect(u,f-this.specs.text_font_size,a,this.specs.text_font_size);r.fillStyle="black";r.fillText(o,u,f)}};r.mouseout=function(e){this.p=undefined;this.repaint()};r.mousemove=function(e){this.p={x:e.p.x-2,y:e.p.y-3};this.repaint()};r.touchstart=function(e){this.mousemove(e)};r.touchmove=function(e){this.mousemove(e)};r.touchend=function(e){this.mouseout(e)};e.SeekerCanvas.SEEK_POINTER="pointer";e.SeekerCanvas.SEEK_PLOT="plot";e.SeekerCanvas.SEEK_PEAK="peak"})(ChemDoodle,ChemDoodle.extensions,Math);(function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";e._Canvas3D=function(e,t,n){if(e){this.create(e,t,n)}};var h=e._Canvas3D.prototype=new e._Canvas;h.rotationMatrix=undefined;h.translationMatrix=undefined;h.lastPoint=undefined;h.emptyMessage="WebGL is Unavailable!";h.afterLoadContent=function(){var e=new n.Bounds;for(var t=0,r=this.molecules.length;t<r;t++){e.expand(this.molecules[t].getBounds3D())}var i=l.dist([e.maxX,e.maxY,e.maxZ],[e.minX,e.minY,e.minZ])/2+1.5;var s=45;var u=s/360*Math.PI;var f=Math.tan(u)/.8;var c=i;this.depth=c/f;var h=o.max(this.depth-c,.1);var p=this.depth+c;var d=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight;if(d<1){s/=d}this.specs.projectionOrthoWidth_3D=Math.tan(s/360*Math.PI)*this.depth*2*d;this.specs.projectionPerspectiveVerticalFieldOfView_3D=s;this.specs.projectionFrontCulling_3D=h;this.specs.projectionBackCulling_3D=p;this.specs.projectionWidthHeightRatio_3D=d;this.translationMatrix=a.translate(a.identity([]),[0,0,-this.depth]);this.maxDimension=o.max(e.maxX-e.minX,e.maxY-e.minY);this.setupScene()};h.setViewDistance=function(e){var t=.1;var r=179.9;this.specs.projectionPerspectiveVerticalFieldOfView_3D=n.clamp(this.specs.projectionPerspectiveVerticalFieldOfView_3D/e,t,r);this.specs.projectionOrthoWidth_3D=o.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*Math.PI)*this.depth*2*this.specs.projectionWidthHeightRatio_3D;this.updateScene()};h.repaint=function(){if(this.gl){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.modelViewMatrix=a.multiply(this.translationMatrix,this.rotationMatrix,[]);this.gl.rotationMatrix=this.rotationMatrix;var e=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(e,false,this.gl.projectionMatrix);this.gl.fogging.setMode(this.specs.fog_mode_3D);for(var t=0,n=this.molecules.length;t<n;t++){this.molecules[t].render(this.gl,this.specs)}for(var t=0,n=this.shapes.length;t<n;t++){this.shapes[t].render(this.gl,this.specs)}if(this.specs.compass_display){this.gl.uniformMatrix4fv(e,false,this.compass.projectionMatrix);this.compass.render(this.gl,this.specs)}var r=this.gl.shaderText;this.gl.useProgram(this.gl.programLabel);this.gl.enable(this.gl.BLEND);this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.depthMask(false);this.gl.enableVertexAttribArray(r.vertexPositionAttribute);this.gl.enableVertexAttribArray(r.vertexTexCoordAttribute);this.gl.enableVertexAttribArray(r.vertexTranslationAttribute);this.gl.enableVertexAttribArray(r.vertexZDepthAttribute);if(this.specs.atoms_displayLabels_3D){this.label3D.render(this.gl,this.specs,this.getMolecules())}if(this.specs.compass_display&&this.specs.compass_displayText_3D){this.compass.renderText(this.gl)}this.gl.disableVertexAttribArray(r.vertexPositionAttribute);this.gl.disableVertexAttribArray(r.vertexTexCoordAttribute);this.gl.disableVertexAttribArray(r.vertexTranslationAttribute);this.gl.disableVertexAttribArray(r.vertexZDepthAttribute);this.gl.disable(this.gl.BLEND);this.gl.depthMask(true);this.gl.useProgram(this.gl.program);this.gl.enableVertexAttribArray(this.gl.shader.vertexPositionAttribute);this.gl.enableVertexAttribArray(this.gl.shader.vertexNormalAttribute);this.gl.flush()}};h.pick=function(e,t){if(this.gl){var n=this.gl;a.multiply(this.translationMatrix,this.rotationMatrix,this.gl.modelViewMatrix);this.gl.rotationMatrix=this.rotationMatrix;var r=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(r,false,this.gl.projectionMatrix);return this.picker.pick(n,this.molecules,this.specs,e,this.height-t)}return undefined};h.center=function(){var e=u.getElementById(this.id);var t=new r.Atom;for(var n=0,i=this.molecules.length;n<i;n++){var s=this.molecules[n];t.add3D(s.getCenter3D())}t.x/=this.molecules.length;t.y/=this.molecules.length;for(var n=0,i=this.molecules.length;n<i;n++){var s=this.molecules[n];for(var o=0,a=s.atoms.length;o<a;o++){s.atoms[o].sub3D(t)}if(s.chains&&s.fromJSON){for(var o=0,a=s.chains.length;o<a;o++){var f=s.chains[o];for(var l=0,c=f.length;l<c;l++){var h=f[l];h.cp1.sub3D(t);h.cp2.sub3D(t);if(h.cp3){h.cp3.sub3D(t);h.cp4.sub3D(t);h.cp5.sub3D(t)}}}}}};h.subCreate=function(){try{var e=u.getElementById(this.id);this.gl=e.getContext("webgl");if(!this.gl){this.gl=e.getContext("experimental-webgl")}}catch(t){}if(this.gl){this.rotationMatrix=a.identity([]);this.translationMatrix=a.identity([]);this.gl.viewport(0,0,this.width,this.height);this.gl.program=this.gl.createProgram();this.gl.shader=new i.Shader;this.gl.shader.init(this.gl);this.gl.programLabel=this.gl.createProgram();this.gl.shaderText=new i.TextShader;this.gl.shaderText.init(this.gl);this.setupScene()}else{this.displayMessage()}};e._Canvas.prototype.displayMessage=function(){var e=u.getElementById(this.id);if(e.getContext){var t=e.getContext("2d");if(this.specs.backgroundColor){t.fillStyle=this.specs.backgroundColor;t.fillRect(0,0,this.width,this.height)}if(this.emptyMessage){t.fillStyle="#737683";t.textAlign="center";t.textBaseline="middle";t.font="18px Helvetica, Verdana, Arial, Sans-serif";t.fillText(this.emptyMessage,this.width/2,this.height/2)}}};h.setupScene=function(){if(this.gl){var u=n.getRGB(this.specs.backgroundColor,1);this.gl.clearColor(u[0],u[1],u[2],1);this.gl.clearDepth(1);this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LEQUAL);if(this.specs.cullBackFace_3D){this.gl.enable(this.gl.CULL_FACE)}this.gl.sphereBuffer=new i.Sphere(1,this.specs.atoms_resolution_3D,this.specs.atoms_resolution_3D);this.gl.starBuffer=new i.Star;this.gl.cylinderBuffer=new i.Cylinder(1,1,this.specs.bonds_resolution_3D);this.gl.pillBuffer=new i.Pill(this.specs.bonds_pillDiameter_3D/2,this.specs.bonds_pillHeight_3D,this.specs.bonds_pillLatitudeResolution_3D,this.specs.bonds_pillLongitudeResolution_3D);this.gl.lineBuffer=new i.Line;this.gl.arrowBuffer=new i.Arrow(.3,this.specs.compass_resolution_3D);this.label3D=new i.Label;this.label3D.init(this.gl,this.specs);for(var c=0,h=this.molecules.length;c<h;c++){var p=this.molecules[c];if(!(p.labelMesh instanceof i.TextMesh)){p.labelMesh=new i.TextMesh;p.labelMesh.init(this.gl)}if(p.unitCellVectors){p.unitCell=new i.UnitCell(p.unitCellVectors)}if(p.chains){p.ribbons=[];p.cartoons=[];p.tubes=[];for(var d=0,v=p.chains.length;d<v;d++){var g=p.chains[d];var y=g.length>2&&s[g[2].name]&&s[g[2].name].aminoColor==="#BEA06E";if(g.length>0&&!g[0].lineSegments){for(var b=0,w=g.length-1;b<w;b++){g[b].setup(g[b+1].cp1,y?1:this.specs.proteins_horizontalResolution)}if(!y){for(var b=1,w=g.length-1;b<w;b++){if(t.vec3AngleFrom(g[b-1].D,g[b].D)>o.PI/2){g[b].guidePointsSmall.reverse();g[b].guidePointsLarge.reverse();l.scale(g[b].D,-1)}}}for(var b=1,w=g.length-3;b<w;b++){g[b].computeLineSegments(g[b-1],g[b+1],g[b+2],!y,y?this.specs.nucleics_verticalResolution:this.specs.proteins_verticalResolution)}g.pop();g.pop();g.pop();g.shift()}var E=n.hsl2rgb(v===1?.5:d/v,1,.5);var S="rgb("+E[0]+","+E[1]+","+E[2]+")";g.chainColor=S;if(y){var x=new i.Tube(g,this.specs.nucleics_tubeThickness,this.specs.nucleics_tubeResolution_3D);x.chainColor=S;p.tubes.push(x)}else{var T={front:new i.Ribbon(g,this.specs.proteins_ribbonThickness,false),back:new i.Ribbon(g,-this.specs.proteins_ribbonThickness,false)};T.front.chainColor=S;T.back.chainColor=S;for(var b=0,w=T.front.segments.length;b<w;b++){T.front.segments[b].chainColor=S}for(var b=0,w=T.back.segments.length;b<w;b++){T.back.segments[b].chainColor=S}p.ribbons.push(T);var N={front:new i.Ribbon(g,this.specs.proteins_ribbonThickness,true),back:new i.Ribbon(g,-this.specs.proteins_ribbonThickness,true)};N.front.chainColor=S;N.back.chainColor=S;for(var b=0,w=N.front.segments.length;b<w;b++){N.front.segments[b].chainColor=S}for(var b=0,w=N.back.segments.length;b<w;b++){N.back.segments[b].chainColor=S}for(var b=0,w=N.front.cartoonSegments.length;b<w;b++){N.front.cartoonSegments[b].chainColor=S}for(var b=0,w=N.back.cartoonSegments.length;b<w;b++){N.back.cartoonSegments[b].chainColor=S}p.cartoons.push(N)}}}}this.label3D.updateVerticesBuffer(this.gl,this.getMolecules(),this.specs);if(this instanceof e.MovieCanvas3D&&this.frames){for(var b=0,w=this.frames.length;b<w;b++){var C=this.frames[b];for(var d=0,v=C.mols.length;d<v;d++){var p=C.mols[d];if(!(p.labelMesh instanceof r.d3.TextMesh)){p.labelMesh=new r.d3.TextMesh;p.labelMesh.init(this.gl)}}this.label3D.updateVerticesBuffer(this.gl,C.mols,this.specs)}}this.gl.lighting=new i.Light(this.specs.lightDiffuseColor_3D,this.specs.lightSpecularColor_3D,this.specs.lightDirection_3D);this.gl.lighting.lightScene(this.gl);this.gl.material=new i.Material(this.gl);this.gl.fogging=new i.Fog(this.gl);this.gl.fogging.setTempParameter(this.specs.fog_color_3D||this.specs.backgroundColor,this.specs.fog_start_3D,this.specs.fog_end_3D,this.specs.fog_density_3D);this.compass=new i.Compass(this.gl,this.specs);var k=this.width/this.height;if(this.specs.projectionWidthHeightRatio_3D){k=this.specs.projectionWidthHeightRatio_3D}this.gl.projectionMatrix=this.specs.projectionPerspective_3D?a.perspective(this.specs.projectionPerspectiveVerticalFieldOfView_3D,k,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D):a.ortho(-this.specs.projectionOrthoWidth_3D/2,this.specs.projectionOrthoWidth_3D/2,-this.specs.projectionOrthoWidth_3D/2/k,this.specs.projectionOrthoWidth_3D/2/k,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D);var L=this.gl.getUniformLocation(this.gl.program,"u_projection_matrix");this.gl.uniformMatrix4fv(L,false,this.gl.projectionMatrix);var A=this.gl.getUniformLocation(this.gl.program,"u_model_view_matrix");var O=this.gl.getUniformLocation(this.gl.program,"u_normal_matrix");this.gl.setMatrixUniforms=function(e){this.uniformMatrix4fv(A,false,e);var t=f.transpose(a.toInverseMat3(e,[]));this.uniformMatrix3fv(O,false,t)};this.picker=new i.Picker;this.picker.init(this.gl);this.picker.setDimension(this.gl,this.width,this.height)}};h.mousedown=function(e){this.lastPoint=e.p};h.rightmousedown=function(e){this.lastPoint=e.p};h.drag=function(t){if(e.monitor.ALT){var n=new r.Point(t.p.x,t.p.y);n.sub(this.lastPoint);var i=this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*o.PI;var s=o.tan(i);var u=this.height/2;var f=u/s;var l=this.depth/f;a.translate(this.translationMatrix,[n.x*l,-n.y*l,0]);this.lastPoint=t.p;this.repaint()}else{var c=t.p.x-this.lastPoint.x;var h=t.p.y-this.lastPoint.y;var p=a.rotate(a.identity([]),c*o.PI/180,[0,1,0]);a.rotate(p,h*o.PI/180,[1,0,0]);this.rotationMatrix=a.multiply(p,this.rotationMatrix);this.lastPoint=t.p;this.repaint()}};h.mousewheel=function(e,t){var n=.1;var r=179.9;var i=t;var s=this.specs.projectionPerspectiveVerticalFieldOfView_3D+i;this.specs.projectionPerspectiveVerticalFieldOfView_3D=s<n?n:s>r?r:s;this.specs.projectionOrthoWidth_3D=Math.tan(this.specs.projectionPerspectiveVerticalFieldOfView_3D/360*Math.PI)*this.depth*2*this.specs.projectionWidthHeightRatio_3D;this.updateScene()};h.updateScene=function(){this.gl.fogging.setTempParameter(this.specs.fog_color_3D||this.specs.backgroundColor,this.specs.fog_start_3D,this.specs.fog_end_3D,this.specs.fog_density_3D);var e=this.width/this.height;if(this.specs.projectionWidthHeightRatio_3D){e=this.specs.projectionWidthHeightRatio_3D}this.gl.projectionMatrix=this.specs.projectionPerspective_3D?a.perspective(this.specs.projectionPerspectiveVerticalFieldOfView_3D,e,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D):a.ortho(-this.specs.projectionOrthoWidth_3D/2,this.specs.projectionOrthoWidth_3D/2,-this.specs.projectionOrthoWidth_3D/2/e,this.specs.projectionOrthoWidth_3D/2/e,this.specs.projectionFrontCulling_3D,this.specs.projectionBackCulling_3D);this.repaint()}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.math,ChemDoodle.structures,ChemDoodle.structures.d3,ChemDoodle.RESIDUE,Math,document,mat4,mat3,vec3,window);(function(e,t,n,r){"use strict";e.MolGrabberCanvas3D=function(e,t,i){if(e){this.create(e,t,i)}var s=[];s.push('<br><input type="text" id="');s.push(e);s.push('_query" size="32" value="" />');s.push("<br><nobr>");s.push('<select id="');s.push(e);s.push('_select">');s.push('<option value="pubchem" selected>PubChem');s.push("</select>");s.push('<button id="');s.push(e);s.push('_submit">Show Molecule</button>');s.push("</nobr>");r.writeln(s.join(""));var o=this;n("#"+e+"_submit").click(function(){o.search()});n("#"+e+"_query").keypress(function(e){if(e.which===13){o.search()}})};var i=e.MolGrabberCanvas3D.prototype=new e._Canvas3D;i.setSearchTerm=function(e){n("#"+this.id+"_query").val(e);this.search()};i.search=function(){var e=this;t.getMoleculeFromDatabase(n("#"+this.id+"_query").val(),{database:n("#"+this.id+"_select").val(),dimension:3},function(t){e.loadMolecule(t)})}})(ChemDoodle,ChemDoodle.iChemLabs,jQuery,document);(function(e,t){"use strict";e.MovieCanvas3D=function(e,t,n){if(e){this.create(e,t,n)}this.frames=[]};e.MovieCanvas3D.PLAY_ONCE=0;e.MovieCanvas3D.PLAY_LOOP=1;e.MovieCanvas3D.PLAY_SPRING=2;var n=e.MovieCanvas3D.prototype=new e._Canvas3D;n.timeout=50;n.frameNumber=0;n.playMode=2;n.reverse=false;n.startAnimation=e._AnimatorCanvas.prototype.startAnimation;n.stopAnimation=e._AnimatorCanvas.prototype.stopAnimation;n.isRunning=e._AnimatorCanvas.prototype.isRunning;n.dblclick=e.RotatorCanvas.prototype.dblclick;n.nextFrame=function(e){var t=this.frames[this.frameNumber];this.molecules=t.mols;this.shapes=t.shapes;if(this.playMode===2&&this.reverse){this.frameNumber--;if(this.frameNumber<0){this.frameNumber=1;this.reverse=false}}else{this.frameNumber++;if(this.frameNumber>=this.frames.length){if(this.playMode===2){this.frameNumber-=2;this.reverse=true}else{this.frameNumber=0;if(this.playMode===0){this.stopAnimation()}}}}};n.center=function(){var e=new t.Atom;var n=this.frames[0];for(var r=0,i=n.mols.length;r<i;r++){e.add3D(n.mols[r].getCenter3D())}e.x/=n.mols.length;e.y/=n.mols.length;var s=new t.Atom;s.sub3D(e);for(var o=0,u=this.frames.length;o<u;o++){var a=this.frames[o];for(var r=0,i=a.mols.length;r<i;r++){var f=a.mols[r];for(var l=0,c=f.atoms.length;l<c;l++){f.atoms[l].add3D(s)}}}};n.addFrame=function(e,t){this.frames.push({mols:e,shapes:t})}})(ChemDoodle,ChemDoodle.structures);(function(e,t,n){"use strict";var r=[];var i=[1,0,0];var s=[0,1,0];var o=[0,0,1];e.RotatorCanvas3D=function(e,t,n){if(e){this.create(e,t,n)}};var u=e.RotatorCanvas3D.prototype=new e._Canvas3D;u.timeout=33;var a=t.PI/15;u.xIncrement=a;u.yIncrement=a;u.zIncrement=a;u.startAnimation=e._AnimatorCanvas.prototype.startAnimation;u.stopAnimation=e._AnimatorCanvas.prototype.stopAnimation;u.isRunning=e._AnimatorCanvas.prototype.isRunning;u.dblclick=e.RotatorCanvas.prototype.dblclick;u.mousedown=undefined;u.rightmousedown=undefined;u.drag=undefined;u.mousewheel=undefined;u.nextFrame=function(e){if(this.molecules.length===0&&this.shapes.length===0){this.stopAnimation();return}n.identity(r);var t=e/1e3;n.rotate(r,this.xIncrement*t,i);n.rotate(r,this.yIncrement*t,s);n.rotate(r,this.zIncrement*t,o);n.multiply(this.rotationMatrix,r)}})(ChemDoodle,Math,mat4);(function(e){"use strict";e.TransformCanvas3D=function(e,t,n){if(e){this.create(e,t,n)}};e.TransformCanvas3D.prototype=new e._Canvas3D})(ChemDoodle);(function(e){"use strict";e.ViewerCanvas3D=function(e,t,n){if(e){this.create(e,t,n)}};var t=e.ViewerCanvas3D.prototype=new e._Canvas3D;t.mousedown=undefined;t.rightmousedown=undefined;t.drag=undefined;t.mousewheel=undefined})(ChemDoodle);(function(e,t,n,r){"use strict";function i(e,t,n,r){this.element=e;this.x=t;this.y=n;this.dimension=r}e.PeriodicTableCanvas=function(e,t){this.padding=5;if(e){this.create(e,t*18+this.padding*2,t*10+this.padding*2)}this.cellDimension=t?t:20;this.setupTable();this.repaint()};var s=e.PeriodicTableCanvas.prototype=new e._Canvas;s.loadMolecule=undefined;s.getMolecule=undefined;s.getHoveredElement=function(){if(this.hovered){return this.hovered.element}return undefined};s.innerRepaint=function(e){for(var t=0,n=this.cells.length;t<n;t++){this.drawCell(e,this.specs,this.cells[t])}if(this.hovered){this.drawCell(e,this.specs,this.hovered)}if(this.selected){this.drawCell(e,this.specs,this.selected)}};s.setupTable=function(){this.cells=[];var t=this.padding;var n=this.padding;var r=0;for(var s=0,o=e.SYMBOLS.length;s<o;s++){if(r===18){r=0;n+=this.cellDimension;t=this.padding}var u=e.ELEMENT[e.SYMBOLS[s]];if(u.atomicNumber===2){t+=16*this.cellDimension;r+=16}else if(u.atomicNumber===5||u.atomicNumber===13){t+=10*this.cellDimension;r+=10}if((u.atomicNumber<58||u.atomicNumber>71&&u.atomicNumber<90||u.atomicNumber>103)&&u.atomicNumber<113){this.cells.push(new i(u,t,n,this.cellDimension));t+=this.cellDimension;r++}}n+=2*this.cellDimension;t=3*this.cellDimension+this.padding;for(var s=57;s<104;s++){var u=e.ELEMENT[e.SYMBOLS[s]];if(u.atomicNumber===90){n+=this.cellDimension;t=3*this.cellDimension+this.padding}if(u.atomicNumber>=58&&u.atomicNumber<=71||u.atomicNumber>=90&&u.atomicNumber<=103){this.cells.push(new i(u,t,n,this.cellDimension));t+=this.cellDimension}}};s.drawCell=function(e,n,r){var i=e.createRadialGradient(r.x+r.dimension/3,r.y+r.dimension/3,r.dimension*1.5,r.x+r.dimension/3,r.y+r.dimension/3,r.dimension/10);i.addColorStop(0,"#000000");i.addColorStop(.7,r.element.jmolColor);i.addColorStop(1,"#FFFFFF");e.fillStyle=i;t.contextRoundRect(e,r.x,r.y,r.dimension,r.dimension,r.dimension/8);if(r===this.hovered||r===this.selected){e.lineWidth=2;e.strokeStyle="#c10000";e.stroke();e.fillStyle="white"}e.fill();e.font=t.getFontString(n.text_font_size,n.text_font_families);e.fillStyle=n.text_color;e.textAlign="center";e.textBaseline="middle";e.fillText(r.element.symbol,r.x+r.dimension/2,r.y+r.dimension/2)};s.click=function(e){if(this.hovered){this.selected=this.hovered;this.repaint()}};s.mousemove=function(e){var t=e.p.x;var r=e.p.y;this.hovered=undefined;for(var i=0,s=this.cells.length;i<s;i++){var o=this.cells[i];if(n.isBetween(t,o.x,o.x+o.dimension)&&n.isBetween(r,o.y,o.y+o.dimension)){this.hovered=o;break}}this.repaint()};s.mouseout=function(e){this.hovered=undefined;this.repaint()}})(ChemDoodle,ChemDoodle.extensions,ChemDoodle.math,document);(function(e,t,n){"use strict";e.png={};e.png.create=function(e){n.open(t.getElementById(e.id).toDataURL("image/png"))}})(ChemDoodle.io,document,window);(function(e,t){"use strict";e.file={};e.file.content=function(e,n){t.get(e,"",n)}})(ChemDoodle.io,jQuery);(function(e,t,n,r,i){"use strict";t.SERVER_URL="http://ichemlabs.cloud.chemdoodle.com/icl_cdc_v050000/WebHQ";t.inRelay=false;t.asynchronous=true;t.INFO={userAgent:navigator.userAgent,v_cwc:e.getVersion(),v_jQuery:i.version,v_jQuery_ui:i.ui?i.ui.version:"N/A"};var s=new n.JSONInterpreter;t._contactServer=function(e,n,r,s,o){if(this.inRelay){alert("Already connecting to the server, please wait for the first request to finish.")}else{t.inRelay=true;i.ajax({dataType:"text",type:"POST",data:JSON.stringify({call:e,content:n,options:r,info:t.INFO}),url:this.SERVER_URL,success:function(e){t.inRelay=false;var n=JSON.parse(e);if(n.message){alert(n.message)}if(s&&n.content&&!n.stop){s(n.content)}if(n.stop&&o){o()}},error:function(e,n,r){t.inRelay=false;alert("Call failed. Please try again. If you continue to see this message, please contact iChemLabs customer support.");if(o){o()}},xhrFields:{withCredentials:true},async:t.asynchronous})}};t.authenticate=function(e,t,n,r){this._contactServer("authenticate",{credential:e},t,function(e){n(e)},r)};t.calculate=function(e,t,n,r){this._contactServer("calculate",{mol:s.molTo(e)},t,function(e){n(e)},r)};t.generateImage=function(e,t,n,r){this._contactServer("generateImage",{mol:s.molTo(e)},t,function(e){n(e.link)},r)};t.generateIUPACName=function(e,t,n,r){this._contactServer("generateIUPACName",{mol:s.molTo(e)},t,function(e){n(e.iupac)},r)};t.getAd=function(e,t){this._contactServer("getAd",{},{},function(t){e(t.image_url,t.target_url)},t)};t.getMoleculeFromContent=function(e,t,n,r){this._contactServer("getMoleculeFromContent",{content:e},t,function(e){var t=false;for(var r=0,i=e.mol.a.length;r<i;r++){if(e.mol.a[r].z!==0){t=true;break}}if(t){for(var r=0,i=e.mol.a.length;r<i;r++){e.mol.a[r].x/=20;e.mol.a[r].y/=20;e.mol.a[r].z/=20}}n(s.molFrom(e.mol))},r)};t.getMoleculeFromDatabase=function(e,t,n,r){this._contactServer("getMoleculeFromDatabase",{query:e},t,function(e){if(t.dimension===3){for(var r=0,i=e.mol.a.length;r<i;r++){e.mol.a[r].x/=20;e.mol.a[r].y/=-20;e.mol.a[r].z/=20}}n(s.molFrom(e.mol))},r)};t.getOptimizedPDBStructure=function(e,t,n,i){this._contactServer("getOptimizedPDBStructure",{id:e},t,function(e){var t;if(e.mol){t=s.molFrom(e.mol)}else{var t=new r.Molecule}t.chains=s.chainsFrom(e.ribbons);t.fromJSON=true;n(t)},i)};t.getZeoliteFromIZA=function(e,t,n,r){this._contactServer("getZeoliteFromIZA",{query:e},t,function(e){n(ChemDoodle.readCIF(e.cif,t.xSuper,t.ySuper,t.zSuper))},r)};t.isGraphIsomorphism=function(e,t,n,r,i){this._contactServer("isGraphIsomorphism",{arrow:s.molTo(e),target:s.molTo(t)},n,function(e){r(e.value)},i)};t.isSubgraphIsomorphism=function(e,t,n,r,i){this._contactServer("isSubgraphIsomorphism",{arrow:s.molTo(e),target:s.molTo(t)},n,function(e){r(e.value)},i)};t.kekulize=function(e,t,n,r){this._contactServer("kekulize",{mol:s.molTo(e)},t,function(e){n(s.molFrom(e.mol))},r)};t.optimize=function(e,t,n,r){this._contactServer("optimize",{mol:s.molTo(e)},t,function(r){var i=s.molFrom(r.mol);if(t.dimension===2){for(var o=0,u=i.atoms.length;o<u;o++){e.atoms[o].x=i.atoms[o].x;e.atoms[o].y=i.atoms[o].y}n()}else if(t.dimension===3){for(var o=0,u=i.atoms.length;o<u;o++){i.atoms[o].x/=20;i.atoms[o].y/=-20;i.atoms[o].z/=20}n(i)}},r)};t.readIUPACName=function(e,t,n,r){this._contactServer("readIUPACName",{iupac:e},t,function(e){n(s.molFrom(e.mol))},r)};t.readSMILES=function(e,t,n,r){this._contactServer("readSMILES",{smiles:e},t,function(e){n(s.molFrom(e.mol))},r)};t.saveFile=function(e,t,n,r){this._contactServer("saveFile",{mol:s.molTo(e)},t,function(e){n(e.link)},r)};t.simulate13CNMR=function(t,n,r,i){n.nucleus="C";n.isotope=13;this._contactServer("simulateNMR",{mol:s.molTo(t)},n,function(t){r(e.readJCAMP(t.jcamp))},i)};t.simulate1HNMR=function(t,n,r,i){n.nucleus="H";n.isotope=1;this._contactServer("simulateNMR",{mol:s.molTo(t)},n,function(t){r(e.readJCAMP(t.jcamp))},i)};t.simulateMassParentPeak=function(t,n,r,i){this._contactServer("simulateMassParentPeak",{mol:s.molTo(t)},n,function(t){r(e.readJCAMP(t.jcamp))},i)};t.writeSMILES=function(e,t,n,r){this._contactServer("writeSMILES",{mol:s.molTo(e)},t,function(e){n(e.smiles)},r)};t.version=function(e,t,n){this._contactServer("version",{},e,function(e){t(e.value)},n)}})(ChemDoodle,ChemDoodle.iChemLabs,ChemDoodle.io,ChemDoodle.structures,jQuery)
