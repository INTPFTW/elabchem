(function(b){b.fn.inlineEdit=function(a){return this.each(function(){b.inlineEdit.getInstance(this,a).initValue()}).live("click.inlineedit mouseenter.inlineedit mouseleave",function(c){var d=b.inlineEdit.getInstance(this,a),e=d.element.find(d.options.control),f=!!e.length;d.element.removeClass(d.options.hover);if(c.target!==e[0])switch(c.type){case "click":d[f?"mutate":"init"]();break;case "mouseover":case "mouseout":case "mouseenter":case "mouseleave":f||d.hoverClassChange(c)}})};b.inlineEdit=function(a,
c){this.options=b.extend(!0,{},b.inlineEdit.defaults,c);this.element=b(a)};b.inlineEdit.getInstance=function(a,c){return b.inlineEdit.initialised(a)?b(a).data("widget.inlineedit"):new b.inlineEdit(a,c)};b.inlineEdit.initialised=function(a){a=b(a).data("init.inlineedit");return void 0!==a&&null!==a?!0:!1};b.inlineEdit.defaults={hover:"ui-state-hover",value:"",save:"",buttons:'<button class="save">save</button> <button class="cancel">cancel</button>',placeholder:"Click to edit",control:"input",cancelOnBlur:!1,
saveOnBlur:!1};b.inlineEdit.prototype={init:function(){this.element.data("init.inlineedit",!0);this.initValue();this.mutate();this.element.data("widget.inlineedit",this)},initValue:function(){this.value(b.trim(this.element.text())||this.options.value);this.value()?this.options.value&&this.element.html(this.options.value):this.element.html(b(this.placeholderHtml()))},mutate:function(){var a=this;return a.element.html(a.mutatedHtml(a.value())).find("button.save").bind("click",function(c){a.save(a.element,
c);a.change(a.element,c);return!1}).end().find("button.cancel").bind("click",function(c){a.change(a.element,c);return!1}).end().find(a.options.control).bind("blur",function(c){!0===a.options.cancelOnBlur?a.change(a.element,c):!0==a.options.saveOnBlur&&(a.save(a.element,c),a.change(a.element,c))}).bind("keyup",function(c){switch(c.keyCode){case 13:"textarea"!==a.options.control&&(a.save(a.element,c),a.change(a.element,c));break;case 27:a.change(a.element,c)}}).focus().end()},value:function(a){if(arguments.length){var c=
a===this.options.placeholder?"":a;this.element.data("value.inlineedit",b(".inlineEdit-placeholder",this).length?"":c&&this.encodeHtml(c.replace(/\n/g,"<br />")))}return this.element.data("value.inlineedit")},mutatedHtml:function(a){return this.controls[this.options.control].call(this,a)},placeholderHtml:function(){return'<span class="inlineEdit-placeholder">'+this.options.placeholder+"</span>"},buttonHtml:function(a){a=b.extend({},{before:" ",buttons:this.options.buttons,after:""},a);return a.before+
a.buttons+a.after},save:function(a,c){var d=this.element.find(this.options.control),e={value:this.encodeHtml(d.val())};d.val(e.value);!1===(b.isFunction(this.options.save)&&this.options.save.call(this.element[0],c,e))&&this.options.save||this.value(e.value)},change:function(a,c){var b=this;this.timer&&window.clearTimeout(this.timer);this.timer=window.setTimeout(function(){b.element.html(b.value()||b.placeholderHtml());b.element.removeClass(b.options.hover)},200)},controls:{textarea:function(a){return"<textarea>"+
a.replace(/<br\s?\/?>/g,"\n")+"</textarea>"+this.buttonHtml({before:"<br />"})},input:function(a){return'<input type="text" value="'+a.replace(/(\u0022)+/g,"")+'">'+this.buttonHtml()}},hoverClassChange:function(a){b(a.target)[/mouseover|mouseenter/.test(a.type)?"addClass":"removeClass"](this.options.hover)},encodeHtml:function(a){var c=a;b.each([{key:/</g,value:"&lt;"},{key:/>/g,value:"&gt;"},{key:/"/g,value:"&quot;"}],function(a,b){c=c.replace(b.key,b.value)});return c}}})(jQuery);