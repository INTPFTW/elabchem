function bigUpload(){this.settings={inputField:"bigUploadFile",formId:"bigUploadForm",progressBarField:"bigUploadProgressBarFilled",timeRemainingField:"bigUploadTimeRemaining",responseField:"bigUploadResponse",submitButton:"bigUploadSubmit",progressBarColor:"#5bb75b",progressBarColorError:"#da4f49",scriptPath:"inc/bigUpload.php",scriptPathParams:"",chunkSize:1E6,maxFileSize:214748364800};this.uploadData={uploadStarted:!1,file:!1,numberOfChunks:0,aborted:!1,paused:!1,pauseChunk:0,key:0,timeStart:0,
totalTime:0};this.success=function(a){};parent=this;this.$=function(a){return document.getElementById(a)};this.resetKey=function(){this.uploadData={uploadStarted:!1,file:!1,numberOfChunks:0,aborted:!1,paused:!1,pauseChunk:0,key:0,timeStart:0,totalTime:0}};this.fire=function(){!0===this.uploadData.uploadStarted&&!1===this.uploadData.paused?this.pauseUpload():!0===this.uploadData.uploadStarted&&!0===this.uploadData.paused?this.resumeUpload():this.processFiles()};this.processFiles=function(){if(window.File&&
window.FileReader&&window.FileList&&window.Blob){this.resetKey();this.uploadData.uploadStarted=!0;this.$(this.settings.progressBarField).style.backgroundColor=this.settings.progressBarColor;this.$(this.settings.responseField).textContent="Uploading...";this.$(this.settings.submitButton).value="Pause";this.uploadData.file=this.$(this.settings.inputField).files[0];var a=this.uploadData.file.size;a>this.settings.maxFileSize?this.printResponse("The file you have chosen is too large.",!0):(this.uploadData.numberOfChunks=
Math.ceil(a/this.settings.chunkSize),this.sendFile(0))}else this.$(this.settings.formId).submit()};this.sendFile=function(a){this.uploadData.timeStart=(new Date).getTime();if(!0!==this.uploadData.aborted)if(!0===this.uploadData.paused)this.uploadData.pauseChunk=a,this.printResponse("Upload paused.",!1);else{var b=a*this.settings.chunkSize,d=b+this.settings.chunkSize,c=new FileReader;c.onloadend=function(b){xhr=new XMLHttpRequest;xhr.open("POST",parent.settings.scriptPath+"?action=upload&key="+parent.uploadData.key+
parent.settings.scriptPathParams,!0);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(){if(4==xhr.readyState){var b=JSON.parse(xhr.response);if(0!==b.errorStatus||200!=xhr.status)parent.printResponse(b.errorText,!0);else{if(0===a||0===parent.uploadData.key)parent.uploadData.key=b.key;a<parent.uploadData.numberOfChunks?(parent.progressUpdate(a+1),parent.sendFile(a+1)):parent.sendFileData()}}};xhr.send(e)};var e=this.uploadData.file.slice(b,d);
c.readAsBinaryString(e)}};this.sendFileData=function(){var a=decodeURI((/id=(.+?)(&|$)/.exec(location.search)||[,null])[1]),b=document.URL.match(/experiments/);"experiments"!=b&&(b="database");var d="key="+this.uploadData.key+"&realname="+this.uploadData.file.name+"&type="+b+"&item_id="+a;xhr=new XMLHttpRequest;xhr.open("POST",parent.settings.scriptPath+"?action=finish",!0);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(){if(4==xhr.readyState){var c=
JSON.parse(xhr.response);0!==c.errorStatus||200!=xhr.status?parent.printResponse(c.errorText,!0):(parent.resetKey(),parent.$(parent.settings.submitButton).value="Start Upload",parent.printResponse("File uploaded successfully.",!1),$("#filesdiv").load(b+".php?mode=edit&id="+a+" #filesdiv"),parent.success(c))}};xhr.send(d)};this.abortFileUpload=function(){this.uploadData.aborted=!0;var a="key="+this.uploadData.key;xhr=new XMLHttpRequest;xhr.open("POST",this.settings.scriptPath+"?action=abort",!0);xhr.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");xhr.onreadystatechange=function(){if(4==xhr.readyState){var a=JSON.parse(xhr.response);0!==a.errorStatus||200!=xhr.status?parent.printResponse(a.errorText,!0):parent.printResponse("File upload was cancelled.",!0)}};xhr.send(a)};this.pauseUpload=function(){this.uploadData.paused=!0;this.printResponse("",!1);this.$(this.settings.submitButton).value="Resume"};this.resumeUpload=function(){this.uploadData.paused=!1;this.$(this.settings.submitButton).value="Pause";this.sendFile(this.uploadData.pauseChunk)};
this.progressUpdate=function(a){var b=Math.ceil(100*(a/this.uploadData.numberOfChunks));this.$(this.settings.progressBarField).style.width=b+"%";this.$(this.settings.progressBarField).textContent=b+"%";0===a%5&&(this.uploadData.totalTime+=(new Date).getTime()-this.uploadData.timeStart,console.log(this.uploadData.totalTime),b=Math.ceil(this.uploadData.totalTime/a*(this.uploadData.numberOfChunks-a)/100),console.log(Math.ceil(this.uploadData.totalTime/a*this.settings.chunkSize/1024)+"kb/s"),this.$(this.settings.timeRemainingField).textContent=
b+" seconds remaining")};this.printResponse=function(a,b){this.$(this.settings.responseField).textContent=a;this.$(this.settings.timeRemainingField).textContent="";!0===b&&(this.$(this.settings.progressBarField).style.backgroundColor=this.settings.progressBarColorError)}};